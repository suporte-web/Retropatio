{"file_contents":{"client/src/components/app-sidebar.tsx":{"content":"import { \n  Building2, \n  Users, \n  Truck, \n  UserCheck, \n  Bell, \n  FileText, \n  Settings, \n  LogOut,\n  LayoutDashboard,\n  Shield,\n  MapPin,\n  PhoneCall\n} from \"lucide-react\";\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarGroup,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarFooter,\n  SidebarHeader,\n} from \"@/components/ui/sidebar\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { RoleBadge } from \"./role-badge\";\nimport { Badge } from \"./ui/badge\";\n\nexport function AppSidebar() {\n  const [location, setLocation] = useLocation();\n  const { user, logoutMutation } = useAuth();\n\n  const handleLogout = () => {\n    logoutMutation.mutate();\n  };\n\n  // Define menu items based on role\n  const getMenuItemsByRole = () => {\n    if (!user) return [];\n\n    const baseItems = [\n      {\n        title: \"Seleção de Filial\",\n        url: \"/filial\",\n        icon: Building2,\n        roles: [\"porteiro\", \"cliente\", \"gestor\"],\n      },\n    ];\n\n    const porteiroItems = [\n      {\n        title: \"Portaria\",\n        url: \"/portaria\",\n        icon: Truck,\n        roles: [\"porteiro\"],\n      },\n      {\n        title: \"Mapa de Vagas\",\n        url: \"/vagas\",\n        icon: MapPin,\n        roles: [\"porteiro\"],\n      },\n      {\n        title: \"Visitantes\",\n        url: \"/visitantes\",\n        icon: UserCheck,\n        roles: [\"porteiro\"],\n      },\n      {\n        title: \"Chamadas\",\n        url: \"/chamadas\",\n        icon: Bell,\n        roles: [\"porteiro\"],\n      },\n    ];\n\n    const clienteItems = [\n      {\n        title: \"Dashboard\",\n        url: \"/cliente\",\n        icon: LayoutDashboard,\n        roles: [\"cliente\"],\n      },\n      {\n        title: \"Mapa de Vagas\",\n        url: \"/vagas\",\n        icon: MapPin,\n        roles: [\"cliente\"],\n      },\n      {\n        title: \"Chamadas\",\n        url: \"/cliente-chamadas\",\n        icon: PhoneCall,\n        roles: [\"cliente\"],\n      },\n      {\n        title: \"Relatórios\",\n        url: \"/relatorios\",\n        icon: FileText,\n        roles: [\"cliente\"],\n      },\n    ];\n\n    const gestorItems = [\n      {\n        title: \"Gestão\",\n        url: \"/gestao\",\n        icon: Shield,\n        roles: [\"gestor\"],\n      },\n      {\n        title: \"Usuários\",\n        url: \"/usuarios\",\n        icon: Users,\n        roles: [\"gestor\"],\n      },\n      {\n        title: \"Filiais\",\n        url: \"/filiais\",\n        icon: Building2,\n        roles: [\"gestor\"],\n      },\n      {\n        title: \"Auditoria\",\n        url: \"/auditoria\",\n        icon: FileText,\n        roles: [\"gestor\"],\n      },\n    ];\n\n    const allItems = [...baseItems, ...porteiroItems, ...clienteItems, ...gestorItems];\n    return allItems.filter(item => item.roles.includes(user.role));\n  };\n\n  const menuItems = getMenuItemsByRole();\n\n  return (\n    <Sidebar>\n      <SidebarHeader className=\"border-b border-sidebar-border p-4\">\n        <div className=\"flex items-center gap-2\">\n          <div className=\"flex h-10 w-10 items-center justify-center rounded-md bg-sidebar-primary\">\n            <Truck className=\"h-6 w-6 text-sidebar-primary-foreground\" />\n          </div>\n          <div className=\"flex flex-col\">\n            <span className=\"text-sm font-semibold text-sidebar-foreground\">RETROPATIO</span>\n            <span className=\"text-xs text-sidebar-foreground/60\">Controle de Pátio</span>\n          </div>\n        </div>\n      </SidebarHeader>\n\n      <SidebarContent>\n        <SidebarGroup>\n          <SidebarGroupLabel className=\"text-xs uppercase tracking-wide text-sidebar-foreground/60\">\n            Menu\n          </SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              {menuItems.map((item) => (\n                <SidebarMenuItem key={item.title}>\n                  <SidebarMenuButton\n                    onClick={() => setLocation(item.url)}\n                    isActive={location === item.url}\n                    className=\"hover-elevate\"\n                    data-testid={`nav-${item.url.substring(1)}`}\n                  >\n                    <item.icon className=\"h-4 w-4\" />\n                    <span>{item.title}</span>\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n              ))}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n      </SidebarContent>\n\n      <SidebarFooter className=\"border-t border-sidebar-border p-4\">\n        {user && (\n          <div className=\"space-y-3\">\n            <div className=\"flex flex-col gap-1 rounded-md bg-sidebar-accent p-3\">\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-sm font-medium text-sidebar-accent-foreground\">{user.nome}</span>\n                <RoleBadge role={user.role} />\n              </div>\n              <span className=\"text-xs text-sidebar-accent-foreground/60\">{user.email}</span>\n            </div>\n            \n            <SidebarMenu>\n              <SidebarMenuItem>\n                <SidebarMenuButton\n                  onClick={handleLogout}\n                  className=\"w-full hover-elevate text-destructive\"\n                  data-testid=\"button-logout\"\n                >\n                  <LogOut className=\"h-4 w-4\" />\n                  <span>Sair</span>\n                </SidebarMenuButton>\n              </SidebarMenuItem>\n            </SidebarMenu>\n          </div>\n        )}\n      </SidebarFooter>\n    </Sidebar>\n  );\n}\n","size_bytes":5464},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"server/storage.ts":{"content":"// Reference: blueprint:javascript_database\nimport {\n  users,\n  filiais,\n  userPermissions,\n  veiculos,\n  vagas,\n  visitantes,\n  chamadas,\n  motoristas,\n  veiculosCadastro,\n  fornecedores,\n  statusCaminhao,\n  auditLogs,\n  refreshTokens,\n  notifications,\n  type User,\n  type InsertUser,\n  type Filial,\n  type InsertFilial,\n  type UserPermission,\n  type InsertUserPermission,\n  type Veiculo,\n  type InsertVeiculo,\n  type Vaga,\n  type InsertVaga,\n  type Visitante,\n  type InsertVisitante,\n  type Chamada,\n  type InsertChamada,\n  type Motorista,\n  type InsertMotorista,\n  type VeiculoCadastro,\n  type InsertVeiculoCadastro,\n  type Fornecedor,\n  type InsertFornecedor,\n  type StatusCaminhao,\n  type InsertStatusCaminhao,\n  type AuditLog,\n  type InsertAuditLog,\n  type RefreshToken,\n  type InsertRefreshToken,\n  type Notification,\n  type InsertNotification,\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, and, desc, gte, lt } from \"drizzle-orm\";\n\nexport interface IStorage {\n  // Refresh Token methods\n  createRefreshToken(token: InsertRefreshToken): Promise<RefreshToken>;\n  getRefreshToken(token: string): Promise<RefreshToken | undefined>;\n  deleteRefreshToken(token: string): Promise<void>;\n  deleteExpiredTokens(): Promise<void>;\n\n  // User methods\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  updateUser(id: string, data: Partial<User>): Promise<User>;\n  getAllUsers(): Promise<User[]>;\n  incrementLoginAttempts(id: string): Promise<void>;\n  resetLoginAttempts(id: string): Promise<void>;\n\n  // Filial methods\n  getFilial(id: string): Promise<Filial | undefined>;\n  getFilialByCode(codigo: string): Promise<Filial | undefined>;\n  createFilial(filial: InsertFilial): Promise<Filial>;\n  updateFilial(id: string, data: Partial<Filial>): Promise<Filial>;\n  getAllFiliais(): Promise<Filial[]>;\n\n  // User Permission methods\n  getUserPermission(id: string): Promise<UserPermission | undefined>;\n  getUserPermissions(userId: string): Promise<(UserPermission & { filial: Filial })[]>;\n  createUserPermission(permission: InsertUserPermission): Promise<UserPermission>;\n  deleteUserPermission(id: string): Promise<void>;\n  getUserFilialIds(userId: string): Promise<string[]>;\n\n  // Veiculo methods\n  getVeiculo(id: string): Promise<Veiculo | undefined>;\n  getVeiculosByFilial(filialId: string): Promise<Veiculo[]>;\n  getAllVeiculos(): Promise<Veiculo[]>;\n  createVeiculo(veiculo: InsertVeiculo & { registradoPor: string }): Promise<Veiculo>;\n  updateVeiculo(id: string, data: Partial<Veiculo>): Promise<Veiculo>;\n  registrarSaida(id: string, dadosAdicionais?: { cte?: string; nf?: string; lacre?: string }): Promise<Veiculo>;\n\n  // Vaga methods\n  getVaga(id: string): Promise<Vaga | undefined>;\n  getVagasByFilial(filialId: string): Promise<Vaga[]>;\n  getAllVagas(): Promise<Vaga[]>;\n  createVaga(vaga: InsertVaga): Promise<Vaga>;\n  updateVaga(id: string, data: Partial<Vaga>): Promise<Vaga>;\n  deleteVaga(id: string): Promise<void>;\n\n  // Visitante methods\n  getVisitante(id: string): Promise<Visitante | undefined>;\n  getVisitantesByFilial(filialId: string): Promise<Visitante[]>;\n  createVisitante(visitante: InsertVisitante): Promise<Visitante>;\n  updateVisitante(id: string, data: Partial<Visitante>): Promise<Visitante>;\n\n  // Chamada methods\n  getChamada(id: string): Promise<Chamada | undefined>;\n  getChamadasByFilial(filialId: string): Promise<Chamada[]>;\n  createChamada(chamada: InsertChamada): Promise<Chamada>;\n  updateChamada(id: string, data: Partial<Chamada>): Promise<Chamada>;\n\n  // Motorista methods\n  getMotorista(id: string): Promise<Motorista | undefined>;\n  getMotoristasByFilial(filialId: string): Promise<Motorista[]>;\n  createMotorista(motorista: InsertMotorista): Promise<Motorista>;\n  updateMotorista(id: string, data: Partial<Motorista>): Promise<Motorista>;\n  deleteMotorista(id: string): Promise<void>;\n\n  // VeiculoCadastro methods\n  getVeiculoCadastro(id: string): Promise<VeiculoCadastro | undefined>;\n  getVeiculosCadastroByFilial(filialId: string): Promise<VeiculoCadastro[]>;\n  createVeiculoCadastro(veiculo: InsertVeiculoCadastro): Promise<VeiculoCadastro>;\n  updateVeiculoCadastro(id: string, data: Partial<VeiculoCadastro>): Promise<VeiculoCadastro>;\n  deleteVeiculoCadastro(id: string): Promise<void>;\n\n  // Fornecedor methods\n  getFornecedor(id: string): Promise<Fornecedor | undefined>;\n  getFornecedoresByFilial(filialId: string): Promise<Fornecedor[]>;\n  createFornecedor(fornecedor: InsertFornecedor): Promise<Fornecedor>;\n  updateFornecedor(id: string, data: Partial<Fornecedor>): Promise<Fornecedor>;\n  deleteFornecedor(id: string): Promise<void>;\n\n  // StatusCaminhao methods\n  getStatusCaminhao(id: string): Promise<StatusCaminhao | undefined>;\n  getStatusCaminhaoByFilial(filialId: string): Promise<StatusCaminhao[]>;\n  createStatusCaminhao(status: InsertStatusCaminhao): Promise<StatusCaminhao>;\n  updateStatusCaminhao(id: string, data: Partial<StatusCaminhao>): Promise<StatusCaminhao>;\n  deleteStatusCaminhao(id: string): Promise<void>;\n\n  // Notification methods\n  getNotification(id: string): Promise<Notification | undefined>;\n  getNotificationsByUser(userId: string): Promise<Notification[]>;\n  getUnreadNotificationsByUser(userId: string): Promise<Notification[]>;\n  getUnreadCountByUser(userId: string): Promise<number>;\n  createNotification(notification: InsertNotification): Promise<Notification>;\n  markAsRead(id: string): Promise<Notification>;\n  markAllAsRead(userId: string): Promise<void>;\n  deleteNotification(id: string): Promise<void>;\n\n  // Audit Log methods\n  createAuditLog(log: InsertAuditLog): Promise<AuditLog>;\n  getAllAuditLogs(): Promise<AuditLog[]>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  // Refresh Token methods\n  async createRefreshToken(token: InsertRefreshToken): Promise<RefreshToken> {\n    const [t] = await db.insert(refreshTokens).values(token).returning();\n    return t;\n  }\n\n  async getRefreshToken(token: string): Promise<RefreshToken | undefined> {\n    const [t] = await db.select().from(refreshTokens).where(eq(refreshTokens.token, token));\n    return t || undefined;\n  }\n\n  async deleteRefreshToken(token: string): Promise<void> {\n    await db.delete(refreshTokens).where(eq(refreshTokens.token, token));\n  }\n\n  async deleteExpiredTokens(): Promise<void> {\n    await db.delete(refreshTokens).where(lt(refreshTokens.expiresAt, new Date()));\n  }\n\n  // User methods\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user || undefined;\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.username, username));\n    return user || undefined;\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.email, email));\n    return user || undefined;\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const [user] = await db.insert(users).values(insertUser).returning();\n    return user;\n  }\n\n  async updateUser(id: string, data: Partial<User>): Promise<User> {\n    const [user] = await db.update(users).set({ ...data, updatedAt: new Date() }).where(eq(users.id, id)).returning();\n    return user;\n  }\n\n  async getAllUsers(): Promise<User[]> {\n    return await db.select().from(users);\n  }\n\n  async incrementLoginAttempts(id: string): Promise<void> {\n    const user = await this.getUser(id);\n    if (!user) return;\n\n    const attempts = (user.loginAttempts || 0) + 1;\n    const updates: Partial<User> = { loginAttempts: attempts };\n\n    // Lock account after 5 failed attempts for 15 minutes\n    if (attempts >= 5) {\n      const lockUntil = new Date();\n      lockUntil.setMinutes(lockUntil.getMinutes() + 15);\n      updates.lockedUntil = lockUntil;\n    }\n\n    await this.updateUser(id, updates);\n  }\n\n  async resetLoginAttempts(id: string): Promise<void> {\n    await this.updateUser(id, { loginAttempts: 0, lockedUntil: null });\n  }\n\n  // Filial methods\n  async getFilial(id: string): Promise<Filial | undefined> {\n    const [filial] = await db.select().from(filiais).where(eq(filiais.id, id));\n    return filial || undefined;\n  }\n\n  async getFilialByCode(codigo: string): Promise<Filial | undefined> {\n    const [filial] = await db.select().from(filiais).where(eq(filiais.codigo, codigo));\n    return filial || undefined;\n  }\n\n  async createFilial(insertFilial: InsertFilial): Promise<Filial> {\n    const [filial] = await db.insert(filiais).values(insertFilial).returning();\n    return filial;\n  }\n\n  async updateFilial(id: string, data: Partial<Filial>): Promise<Filial> {\n    const [filial] = await db.update(filiais).set(data).where(eq(filiais.id, id)).returning();\n    return filial;\n  }\n\n  async getAllFiliais(): Promise<Filial[]> {\n    return await db.select().from(filiais);\n  }\n\n  // User Permission methods\n  async getUserPermission(id: string): Promise<UserPermission | undefined> {\n    const [perm] = await db.select().from(userPermissions).where(eq(userPermissions.id, id));\n    return perm || undefined;\n  }\n\n  async getUserPermissions(userId: string): Promise<(UserPermission & { filial: Filial })[]> {\n    const results = await db\n      .select({\n        permission: userPermissions,\n        filial: filiais,\n      })\n      .from(userPermissions)\n      .leftJoin(filiais, eq(userPermissions.filialId, filiais.id))\n      .where(eq(userPermissions.userId, userId));\n    \n    return results.map(r => ({\n      ...r.permission,\n      filial: r.filial!,\n    }));\n  }\n\n  async createUserPermission(permission: InsertUserPermission): Promise<UserPermission> {\n    const [perm] = await db.insert(userPermissions).values(permission).returning();\n    return perm;\n  }\n\n  async deleteUserPermission(id: string): Promise<void> {\n    await db.delete(userPermissions).where(eq(userPermissions.id, id));\n  }\n\n  async getUserFilialIds(userId: string): Promise<string[]> {\n    const perms = await db.select({ filialId: userPermissions.filialId })\n      .from(userPermissions)\n      .where(eq(userPermissions.userId, userId));\n    return perms.map(p => p.filialId);\n  }\n\n  // Veiculo methods\n  async getVeiculo(id: string): Promise<Veiculo | undefined> {\n    const [veiculo] = await db.select().from(veiculos).where(eq(veiculos.id, id));\n    return veiculo || undefined;\n  }\n\n  async getVeiculosByFilial(filialId: string): Promise<Veiculo[]> {\n    return await db.select().from(veiculos)\n      .where(eq(veiculos.filialId, filialId))\n      .orderBy(desc(veiculos.dataEntrada));\n  }\n\n  async getAllVeiculos(): Promise<Veiculo[]> {\n    return await db.select().from(veiculos).orderBy(desc(veiculos.dataEntrada));\n  }\n\n  async createVeiculo(veiculo: InsertVeiculo & { registradoPor: string }): Promise<Veiculo> {\n    const [v] = await db.insert(veiculos).values(veiculo).returning();\n    \n    // Update vaga status if vaga is assigned\n    if (v.vagaId) {\n      await this.updateVaga(v.vagaId, { status: \"ocupada\" });\n    }\n    \n    return v;\n  }\n\n  async updateVeiculo(id: string, data: Partial<Veiculo>): Promise<Veiculo> {\n    const [v] = await db.update(veiculos)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(veiculos.id, id))\n      .returning();\n    return v;\n  }\n\n  async registrarSaida(id: string, dadosAdicionais?: { cte?: string; nf?: string; lacre?: string }): Promise<Veiculo> {\n    const veiculo = await this.getVeiculo(id);\n    if (!veiculo) throw new Error(\"Veículo não encontrado\");\n\n    // Free up the vaga\n    if (veiculo.vagaId) {\n      await this.updateVaga(veiculo.vagaId, { status: \"livre\" });\n    }\n\n    // Atualizar com dados adicionais se fornecidos\n    const updateData: Partial<Veiculo> = { dataSaida: new Date() };\n    if (dadosAdicionais) {\n      if (dadosAdicionais.cte) updateData.cte = dadosAdicionais.cte;\n      if (dadosAdicionais.nf) updateData.nf = dadosAdicionais.nf;\n      if (dadosAdicionais.lacre) updateData.lacre = dadosAdicionais.lacre;\n    }\n\n    return await this.updateVeiculo(id, updateData);\n  }\n\n  // Vaga methods\n  async getVaga(id: string): Promise<Vaga | undefined> {\n    const [vaga] = await db.select().from(vagas).where(eq(vagas.id, id));\n    return vaga || undefined;\n  }\n\n  async getVagasByFilial(filialId: string): Promise<Vaga[]> {\n    return await db.select().from(vagas).where(eq(vagas.filialId, filialId));\n  }\n\n  async getAllVagas(): Promise<Vaga[]> {\n    return await db.select().from(vagas);\n  }\n\n  async createVaga(vaga: InsertVaga): Promise<Vaga> {\n    const [v] = await db.insert(vagas).values(vaga).returning();\n    return v;\n  }\n\n  async updateVaga(id: string, data: Partial<Vaga>): Promise<Vaga> {\n    const [v] = await db.update(vagas)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(vagas.id, id))\n      .returning();\n    return v;\n  }\n\n  async deleteVaga(id: string): Promise<void> {\n    await db.delete(vagas).where(eq(vagas.id, id));\n  }\n\n  // Visitante methods\n  async getVisitante(id: string): Promise<Visitante | undefined> {\n    const [visitante] = await db.select().from(visitantes).where(eq(visitantes.id, id));\n    return visitante || undefined;\n  }\n\n  async getVisitantesByFilial(filialId: string): Promise<Visitante[]> {\n    return await db.select().from(visitantes)\n      .where(eq(visitantes.filialId, filialId))\n      .orderBy(desc(visitantes.createdAt));\n  }\n\n  async createVisitante(visitante: InsertVisitante): Promise<Visitante> {\n    const [v] = await db.insert(visitantes).values(visitante).returning();\n    return v;\n  }\n\n  async updateVisitante(id: string, data: Partial<Visitante>): Promise<Visitante> {\n    const [v] = await db.update(visitantes)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(visitantes.id, id))\n      .returning();\n    return v;\n  }\n\n  // Chamada methods\n  async getChamada(id: string): Promise<Chamada | undefined> {\n    const [chamada] = await db.select().from(chamadas).where(eq(chamadas.id, id));\n    return chamada || undefined;\n  }\n\n  async getChamadasByFilial(filialId: string): Promise<Chamada[]> {\n    return await db.select().from(chamadas)\n      .where(eq(chamadas.filialId, filialId))\n      .orderBy(desc(chamadas.createdAt));\n  }\n\n  async createChamada(chamada: InsertChamada): Promise<Chamada> {\n    const [c] = await db.insert(chamadas).values(chamada).returning();\n    return c;\n  }\n\n  async updateChamada(id: string, data: Partial<Chamada>): Promise<Chamada> {\n    const [c] = await db.update(chamadas)\n      .set(data)\n      .where(eq(chamadas.id, id))\n      .returning();\n    return c;\n  }\n\n  // Motorista methods\n  async getMotorista(id: string): Promise<Motorista | undefined> {\n    const [motorista] = await db.select().from(motoristas).where(eq(motoristas.id, id));\n    return motorista || undefined;\n  }\n\n  async getMotoristasByFilial(filialId: string): Promise<Motorista[]> {\n    return await db.select().from(motoristas)\n      .where(eq(motoristas.filialId, filialId))\n      .orderBy(desc(motoristas.createdAt));\n  }\n\n  async createMotorista(motorista: InsertMotorista): Promise<Motorista> {\n    const [m] = await db.insert(motoristas).values(motorista).returning();\n    return m;\n  }\n\n  async updateMotorista(id: string, data: Partial<Motorista>): Promise<Motorista> {\n    const [m] = await db.update(motoristas)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(motoristas.id, id))\n      .returning();\n    return m;\n  }\n\n  async deleteMotorista(id: string): Promise<void> {\n    await db.delete(motoristas).where(eq(motoristas.id, id));\n  }\n\n  // VeiculoCadastro methods\n  async getVeiculoCadastro(id: string): Promise<VeiculoCadastro | undefined> {\n    const [veiculo] = await db.select().from(veiculosCadastro).where(eq(veiculosCadastro.id, id));\n    return veiculo || undefined;\n  }\n\n  async getVeiculosCadastroByFilial(filialId: string): Promise<VeiculoCadastro[]> {\n    return await db.select().from(veiculosCadastro)\n      .where(eq(veiculosCadastro.filialId, filialId))\n      .orderBy(desc(veiculosCadastro.createdAt));\n  }\n\n  async createVeiculoCadastro(veiculo: InsertVeiculoCadastro): Promise<VeiculoCadastro> {\n    const [v] = await db.insert(veiculosCadastro).values(veiculo).returning();\n    return v;\n  }\n\n  async updateVeiculoCadastro(id: string, data: Partial<VeiculoCadastro>): Promise<VeiculoCadastro> {\n    const [v] = await db.update(veiculosCadastro)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(veiculosCadastro.id, id))\n      .returning();\n    return v;\n  }\n\n  async deleteVeiculoCadastro(id: string): Promise<void> {\n    await db.delete(veiculosCadastro).where(eq(veiculosCadastro.id, id));\n  }\n\n  // Fornecedor methods\n  async getFornecedor(id: string): Promise<Fornecedor | undefined> {\n    const [fornecedor] = await db.select().from(fornecedores).where(eq(fornecedores.id, id));\n    return fornecedor || undefined;\n  }\n\n  async getFornecedoresByFilial(filialId: string): Promise<Fornecedor[]> {\n    return await db.select().from(fornecedores)\n      .where(eq(fornecedores.filialId, filialId))\n      .orderBy(desc(fornecedores.createdAt));\n  }\n\n  async createFornecedor(fornecedor: InsertFornecedor): Promise<Fornecedor> {\n    const [f] = await db.insert(fornecedores).values(fornecedor).returning();\n    return f;\n  }\n\n  async updateFornecedor(id: string, data: Partial<Fornecedor>): Promise<Fornecedor> {\n    const [f] = await db.update(fornecedores)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(fornecedores.id, id))\n      .returning();\n    return f;\n  }\n\n  async deleteFornecedor(id: string): Promise<void> {\n    await db.delete(fornecedores).where(eq(fornecedores.id, id));\n  }\n\n  // StatusCaminhao methods\n  async getStatusCaminhao(id: string): Promise<StatusCaminhao | undefined> {\n    const [status] = await db.select().from(statusCaminhao).where(eq(statusCaminhao.id, id));\n    return status || undefined;\n  }\n\n  async getStatusCaminhaoByFilial(filialId: string): Promise<StatusCaminhao[]> {\n    return await db.select().from(statusCaminhao)\n      .where(eq(statusCaminhao.filialId, filialId))\n      .orderBy(statusCaminhao.ordem, desc(statusCaminhao.createdAt));\n  }\n\n  async createStatusCaminhao(status: InsertStatusCaminhao): Promise<StatusCaminhao> {\n    const [s] = await db.insert(statusCaminhao).values(status).returning();\n    return s;\n  }\n\n  async updateStatusCaminhao(id: string, data: Partial<StatusCaminhao>): Promise<StatusCaminhao> {\n    const [s] = await db.update(statusCaminhao)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(statusCaminhao.id, id))\n      .returning();\n    return s;\n  }\n\n  async deleteStatusCaminhao(id: string): Promise<void> {\n    await db.delete(statusCaminhao).where(eq(statusCaminhao.id, id));\n  }\n\n  // Notification methods\n  async getNotification(id: string): Promise<Notification | undefined> {\n    const [notification] = await db.select().from(notifications).where(eq(notifications.id, id));\n    return notification || undefined;\n  }\n\n  async getNotificationsByUser(userId: string): Promise<Notification[]> {\n    return await db.select().from(notifications)\n      .where(eq(notifications.userId, userId))\n      .orderBy(desc(notifications.createdAt))\n      .limit(50);\n  }\n\n  async getUnreadNotificationsByUser(userId: string): Promise<Notification[]> {\n    return await db.select().from(notifications)\n      .where(and(\n        eq(notifications.userId, userId),\n        eq(notifications.status, \"nao_lida\")\n      ))\n      .orderBy(desc(notifications.createdAt));\n  }\n\n  async getUnreadCountByUser(userId: string): Promise<number> {\n    const results = await db.select().from(notifications)\n      .where(and(\n        eq(notifications.userId, userId),\n        eq(notifications.status, \"nao_lida\")\n      ));\n    return results.length;\n  }\n\n  async createNotification(notification: InsertNotification): Promise<Notification> {\n    const [n] = await db.insert(notifications).values(notification).returning();\n    return n;\n  }\n\n  async markAsRead(id: string): Promise<Notification> {\n    const [n] = await db.update(notifications)\n      .set({ status: \"lida\", readAt: new Date() })\n      .where(eq(notifications.id, id))\n      .returning();\n    return n;\n  }\n\n  async markAllAsRead(userId: string): Promise<void> {\n    await db.update(notifications)\n      .set({ status: \"lida\", readAt: new Date() })\n      .where(and(\n        eq(notifications.userId, userId),\n        eq(notifications.status, \"nao_lida\")\n      ));\n  }\n\n  async deleteNotification(id: string): Promise<void> {\n    await db.delete(notifications).where(eq(notifications.id, id));\n  }\n\n  // Audit Log methods\n  async createAuditLog(log: InsertAuditLog): Promise<AuditLog> {\n    const [l] = await db.insert(auditLogs).values(log).returning();\n    return l;\n  }\n\n  async getAllAuditLogs(): Promise<AuditLog[]> {\n    return await db.select().from(auditLogs).orderBy(desc(auditLogs.createdAt)).limit(1000);\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","size_bytes":21118},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, timestamp, integer, boolean, pgEnum, numeric } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\nimport { relations } from \"drizzle-orm\";\n\n// Enums\nexport const roleEnum = pgEnum(\"role\", [\"porteiro\", \"cliente\", \"gestor\"]);\nexport const visitanteStatusEnum = pgEnum(\"visitante_status\", [\"aguardando\", \"aprovado\", \"dentro\", \"saiu\"]);\nexport const vagaStatusEnum = pgEnum(\"vaga_status\", [\"livre\", \"ocupada\"]);\nexport const veiculoSituacaoEnum = pgEnum(\"veiculo_situacao\", [\"aguardando\", \"docado\", \"carregando\", \"descarregando\", \"finalizado\"]);\nexport const tipoVeiculoCategoriaEnum = pgEnum(\"tipo_veiculo_categoria\", [\"carro\", \"moto\", \"cavalo\", \"cavalo_carreta\"]);\nexport const tipoProprietarioEnum = pgEnum(\"tipo_proprietario\", [\"terceiro\", \"agregado\", \"frota\"]);\nexport const statusCargaEnum = pgEnum(\"status_carga\", [\"carregado\", \"descarregado\", \"pernoite\", \"manutencao\"]);\nexport const checklistTipoEnum = pgEnum(\"checklist_tipo\", [\"inspecao_entrada\", \"inspecao_saida\", \"vistoria_carga\", \"conferencia_documentos\"]);\nexport const checklistStatusEnum = pgEnum(\"checklist_status\", [\"pendente\", \"em_andamento\", \"concluido\"]);\nexport const checklistItemTipoEnum = pgEnum(\"checklist_item_tipo\", [\"checkbox\", \"texto\", \"foto\", \"numero\"]);\nexport const notificationTipoEnum = pgEnum(\"notification_tipo\", [\"visitante_aprovacao\", \"chamada_motorista\", \"veiculo_alerta\", \"sistema\"]);\nexport const notificationStatusEnum = pgEnum(\"notification_status\", [\"nao_lida\", \"lida\", \"arquivada\"]);\n\n// Filiais (branches) - Master table\nexport const filiais = pgTable(\"filiais\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  nome: text(\"nome\").notNull(),\n  codigo: text(\"codigo\").notNull().unique(), // guarulhos, araraquara, costeira\n  endereco: text(\"endereco\").notNull(),\n  ativo: boolean(\"ativo\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const filiaisRelations = relations(filiais, ({ many }) => ({\n  userPermissions: many(userPermissions),\n  vagas: many(vagas),\n}));\n\n// Users\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  username: text(\"username\").notNull().unique(),\n  email: text(\"email\").notNull().unique(),\n  password: text(\"password\").notNull(),\n  nome: text(\"nome\").notNull(),\n  role: roleEnum(\"role\").notNull().default(\"porteiro\"),\n  ativo: boolean(\"ativo\").notNull().default(true),\n  loginAttempts: integer(\"login_attempts\").notNull().default(0),\n  lockedUntil: timestamp(\"locked_until\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport const usersRelations = relations(users, ({ many }) => ({\n  permissions: many(userPermissions),\n  auditLogs: many(auditLogs),\n  veiculosRegistrados: many(veiculos),\n}));\n\n// User Permissions per Branch\nexport const userPermissions = pgTable(\"user_permissions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  filialId: varchar(\"filial_id\").notNull().references(() => filiais.id, { onDelete: \"cascade\" }),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const userPermissionsRelations = relations(userPermissions, ({ one }) => ({\n  user: one(users, {\n    fields: [userPermissions.userId],\n    references: [users.id],\n  }),\n  filial: one(filiais, {\n    fields: [userPermissions.filialId],\n    references: [filiais.id],\n  }),\n}));\n\n// Veículos (Vehicles)\nexport const veiculos = pgTable(\"veiculos\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  filialId: varchar(\"filial_id\").notNull().references(() => filiais.id),\n  tipoVeiculoCategoria: tipoVeiculoCategoriaEnum(\"tipo_veiculo_categoria\").notNull().default(\"cavalo_carreta\"),\n  tipoProprietario: tipoProprietarioEnum(\"tipo_proprietario\").notNull().default(\"terceiro\"),\n  statusCarga: statusCargaEnum(\"status_carga\"),\n  placaCavalo: text(\"placa_cavalo\").notNull(),\n  placaCarreta: text(\"placa_carreta\"),\n  motorista: text(\"motorista\").notNull(),\n  cpfMotorista: text(\"cpf_motorista\"),\n  transportadora: text(\"transportadora\"),\n  cliente: text(\"cliente\"),\n  doca: text(\"doca\"),\n  vagaId: varchar(\"vaga_id\").references(() => vagas.id),\n  situacao: veiculoSituacaoEnum(\"situacao\").notNull().default(\"aguardando\"),\n  multi: boolean(\"multi\").notNull().default(false),\n  valor: numeric(\"valor\", { precision: 10, scale: 2 }),\n  cte: text(\"cte\"),\n  nf: text(\"nf\"),\n  lacre: text(\"lacre\"),\n  observacoes: text(\"observacoes\"),\n  dataEntrada: timestamp(\"data_entrada\").notNull().defaultNow(),\n  dataSaida: timestamp(\"data_saida\"),\n  registradoPor: varchar(\"registrado_por\").notNull().references(() => users.id),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport const veiculosRelations = relations(veiculos, ({ one }) => ({\n  filial: one(filiais, {\n    fields: [veiculos.filialId],\n    references: [filiais.id],\n  }),\n  vaga: one(vagas, {\n    fields: [veiculos.vagaId],\n    references: [vagas.id],\n  }),\n  registrador: one(users, {\n    fields: [veiculos.registradoPor],\n    references: [users.id],\n  }),\n}));\n\n// Vagas (Parking Spots)\nexport const vagas = pgTable(\"vagas\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  filialId: varchar(\"filial_id\").notNull().references(() => filiais.id),\n  numero: text(\"numero\").notNull(),\n  status: vagaStatusEnum(\"status\").notNull().default(\"livre\"),\n  descricao: text(\"descricao\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport const vagasRelations = relations(vagas, ({ one, many }) => ({\n  filial: one(filiais, {\n    fields: [vagas.filialId],\n    references: [filiais.id],\n  }),\n  veiculos: many(veiculos),\n}));\n\n// Visitantes (Visitors)\nexport const visitantes = pgTable(\"visitantes\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  filialId: varchar(\"filial_id\").notNull().references(() => filiais.id),\n  nome: text(\"nome\").notNull(),\n  cpf: text(\"cpf\").notNull(),\n  empresa: text(\"empresa\"),\n  tipoVisita: text(\"tipo_visita\").notNull(), // visitante, prestador_servico\n  motivoVisita: text(\"motivo_visita\"),\n  status: visitanteStatusEnum(\"status\").notNull().default(\"aguardando\"),\n  dataEntrada: timestamp(\"data_entrada\"),\n  dataSaida: timestamp(\"data_saida\"),\n  aprovadoPor: varchar(\"aprovado_por\").references(() => users.id),\n  dataAprovacao: timestamp(\"data_aprovacao\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport const visitantesRelations = relations(visitantes, ({ one }) => ({\n  filial: one(filiais, {\n    fields: [visitantes.filialId],\n    references: [filiais.id],\n  }),\n  aprovador: one(users, {\n    fields: [visitantes.aprovadoPor],\n    references: [users.id],\n  }),\n}));\n\n// Chamadas de Motorista (Driver Calls)\nexport const chamadas = pgTable(\"chamadas\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  filialId: varchar(\"filial_id\").notNull().references(() => filiais.id),\n  veiculoId: varchar(\"veiculo_id\").notNull().references(() => veiculos.id),\n  motivo: text(\"motivo\").notNull(),\n  status: text(\"status\").notNull().default(\"pendente\"), // pendente, atendida, cancelada\n  criadoPor: varchar(\"criado_por\").notNull().references(() => users.id),\n  atendidoPor: varchar(\"atendido_por\").references(() => users.id),\n  dataAtendimento: timestamp(\"data_atendimento\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const chamadasRelations = relations(chamadas, ({ one }) => ({\n  filial: one(filiais, {\n    fields: [chamadas.filialId],\n    references: [filiais.id],\n  }),\n  veiculo: one(veiculos, {\n    fields: [chamadas.veiculoId],\n    references: [veiculos.id],\n  }),\n  criador: one(users, {\n    fields: [chamadas.criadoPor],\n    references: [users.id],\n  }),\n  atendente: one(users, {\n    fields: [chamadas.atendidoPor],\n    references: [users.id],\n  }),\n}));\n\n// Checklists (defined first)\nexport const checklists = pgTable(\"checklists\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  filialId: varchar(\"filial_id\").notNull().references(() => filiais.id),\n  veiculoId: varchar(\"veiculo_id\").notNull().references(() => veiculos.id),\n  tipo: checklistTipoEnum(\"tipo\").notNull(),\n  status: checklistStatusEnum(\"status\").notNull().default(\"pendente\"),\n  criadoPor: varchar(\"criado_por\").notNull().references(() => users.id),\n  concluidoPor: varchar(\"concluido_por\").references(() => users.id),\n  dataConclusao: timestamp(\"data_conclusao\"),\n  observacoes: text(\"observacoes\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\n// Checklist Items\nexport const checklistItems = pgTable(\"checklist_items\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  checklistId: varchar(\"checklist_id\").notNull().references(() => checklists.id, { onDelete: \"cascade\" }),\n  descricao: text(\"descricao\").notNull(),\n  ordem: integer(\"ordem\").notNull(),\n  tipo: checklistItemTipoEnum(\"tipo\").notNull().default(\"checkbox\"),\n  valor: text(\"valor\"),\n  obrigatorio: boolean(\"obrigatorio\").notNull().default(false),\n  fotos: text(\"fotos\").array(),\n  observacoes: text(\"observacoes\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport const checklistsRelations = relations(checklists, ({ one, many }) => ({\n  filial: one(filiais, {\n    fields: [checklists.filialId],\n    references: [filiais.id],\n  }),\n  veiculo: one(veiculos, {\n    fields: [checklists.veiculoId],\n    references: [veiculos.id],\n  }),\n  criador: one(users, {\n    fields: [checklists.criadoPor],\n    references: [users.id],\n  }),\n  responsavel: one(users, {\n    fields: [checklists.concluidoPor],\n    references: [users.id],\n  }),\n  items: many(checklistItems),\n}));\n\nexport const checklistItemsRelations = relations(checklistItems, ({ one }) => ({\n  checklist: one(checklists, {\n    fields: [checklistItems.checklistId],\n    references: [checklists.id],\n  }),\n}));\n\n// Notifications\nexport const notifications = pgTable(\"notifications\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  filialId: varchar(\"filial_id\").notNull().references(() => filiais.id),\n  tipo: notificationTipoEnum(\"tipo\").notNull(),\n  titulo: text(\"titulo\").notNull(),\n  mensagem: text(\"mensagem\").notNull(),\n  status: notificationStatusEnum(\"status\").notNull().default(\"nao_lida\"),\n  entidadeId: varchar(\"entidade_id\"), // ID do visitante, chamada, etc\n  entidadeTipo: text(\"entidade_tipo\"), // visitante, chamada, veiculo\n  actionUrl: text(\"action_url\"), // URL para ação rápida\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  readAt: timestamp(\"read_at\"),\n});\n\nexport const notificationsRelations = relations(notifications, ({ one }) => ({\n  user: one(users, {\n    fields: [notifications.userId],\n    references: [users.id],\n  }),\n  filial: one(filiais, {\n    fields: [notifications.filialId],\n    references: [filiais.id],\n  }),\n}));\n\n// Motoristas (Drivers)\nexport const motoristas = pgTable(\"motoristas\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  filialId: varchar(\"filial_id\").notNull().references(() => filiais.id),\n  nome: text(\"nome\").notNull(),\n  cpf: text(\"cpf\").notNull(),\n  tipo: tipoProprietarioEnum(\"tipo\").notNull().default(\"terceiro\"), // terceiro, agregado, frota\n  ativo: boolean(\"ativo\").notNull().default(true),\n  telefone: text(\"telefone\"),\n  observacoes: text(\"observacoes\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport const motoristasRelations = relations(motoristas, ({ one }) => ({\n  filial: one(filiais, {\n    fields: [motoristas.filialId],\n    references: [filiais.id],\n  }),\n}));\n\n// Veículos Cadastrados (Pre-registered Vehicles)\nexport const veiculosCadastro = pgTable(\"veiculos_cadastro\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  filialId: varchar(\"filial_id\").notNull().references(() => filiais.id),\n  tipo: tipoVeiculoCategoriaEnum(\"tipo\").notNull().default(\"cavalo_carreta\"),\n  placa: text(\"placa\").notNull(),\n  statusCarga: statusCargaEnum(\"status_carga\"),\n  ativo: boolean(\"ativo\").notNull().default(true),\n  modelo: text(\"modelo\"),\n  marca: text(\"marca\"),\n  ano: integer(\"ano\"),\n  observacoes: text(\"observacoes\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport const veiculosCadastroRelations = relations(veiculosCadastro, ({ one }) => ({\n  filial: one(filiais, {\n    fields: [veiculosCadastro.filialId],\n    references: [filiais.id],\n  }),\n}));\n\n// Fornecedores (Suppliers)\nexport const fornecedores = pgTable(\"fornecedores\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  filialId: varchar(\"filial_id\").notNull().references(() => filiais.id),\n  nome: text(\"nome\").notNull(),\n  cnpj: text(\"cnpj\").notNull(),\n  ativo: boolean(\"ativo\").notNull().default(true),\n  contato: text(\"contato\"),\n  telefone: text(\"telefone\"),\n  email: text(\"email\"),\n  endereco: text(\"endereco\"),\n  observacoes: text(\"observacoes\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport const fornecedoresRelations = relations(fornecedores, ({ one }) => ({\n  filial: one(filiais, {\n    fields: [fornecedores.filialId],\n    references: [filiais.id],\n  }),\n}));\n\n// Status de Caminhão (Truck Status)\nexport const statusCaminhao = pgTable(\"status_caminhao\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  filialId: varchar(\"filial_id\").notNull().references(() => filiais.id),\n  descricao: text(\"descricao\").notNull(),\n  cor: text(\"cor\").notNull().default(\"#3B82F6\"), // Hex color for visual differentiation\n  ativo: boolean(\"ativo\").notNull().default(true),\n  ordem: integer(\"ordem\").notNull().default(0), // For sorting\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport const statusCaminhaoRelations = relations(statusCaminhao, ({ one }) => ({\n  filial: one(filiais, {\n    fields: [statusCaminhao.filialId],\n    references: [filiais.id],\n  }),\n}));\n\n// Refresh Tokens\nexport const refreshTokens = pgTable(\"refresh_tokens\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  token: text(\"token\").notNull().unique(),\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const refreshTokensRelations = relations(refreshTokens, ({ one }) => ({\n  user: one(users, {\n    fields: [refreshTokens.userId],\n    references: [users.id],\n  }),\n}));\n\n// Audit Logs\nexport const auditLogs = pgTable(\"audit_logs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  filialId: varchar(\"filial_id\").references(() => filiais.id),\n  acao: text(\"acao\").notNull(), // LOGIN, CRIAR_VEICULO, APROVAR_VISITANTE, etc\n  entidade: text(\"entidade\").notNull(), // users, veiculos, visitantes, etc\n  entidadeId: varchar(\"entidade_id\"),\n  dadosAntes: text(\"dados_antes\"), // JSON string\n  dadosDepois: text(\"dados_depois\"), // JSON string\n  ipAddress: text(\"ip_address\"),\n  userAgent: text(\"user_agent\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const auditLogsRelations = relations(auditLogs, ({ one }) => ({\n  user: one(users, {\n    fields: [auditLogs.userId],\n    references: [users.id],\n  }),\n  filial: one(filiais, {\n    fields: [auditLogs.filialId],\n    references: [filiais.id],\n  }),\n}));\n\n// Zod Schemas for Insert\nexport const insertFilialSchema = createInsertSchema(filiais).omit({ id: true, createdAt: true });\nexport const insertUserSchema = createInsertSchema(users).omit({ \n  id: true, \n  createdAt: true, \n  updatedAt: true,\n  loginAttempts: true,\n  lockedUntil: true,\n});\nexport const insertUserPermissionSchema = createInsertSchema(userPermissions).omit({ id: true, createdAt: true });\nexport const insertVeiculoSchema = createInsertSchema(veiculos).omit({ \n  id: true, \n  createdAt: true, \n  updatedAt: true,\n  dataEntrada: true,\n  registradoPor: true, // Backend adds this from session\n});\nexport const insertVagaSchema = createInsertSchema(vagas).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertVisitanteSchema = createInsertSchema(visitantes).omit({ \n  id: true, \n  createdAt: true, \n  updatedAt: true,\n  dataAprovacao: true,\n});\nexport const insertChamadaSchema = createInsertSchema(chamadas).omit({ id: true, createdAt: true });\nexport const insertChecklistSchema = createInsertSchema(checklists).omit({ \n  id: true, \n  createdAt: true, \n  updatedAt: true,\n  dataConclusao: true,\n});\nexport const insertChecklistItemSchema = createInsertSchema(checklistItems).omit({ \n  id: true, \n  createdAt: true, \n  updatedAt: true,\n});\nexport const insertNotificationSchema = createInsertSchema(notifications).omit({ \n  id: true, \n  createdAt: true,\n  readAt: true,\n});\nexport const insertMotoristaSchema = createInsertSchema(motoristas).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertVeiculoCadastroSchema = createInsertSchema(veiculosCadastro).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertFornecedorSchema = createInsertSchema(fornecedores).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertStatusCaminhaoSchema = createInsertSchema(statusCaminhao).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertAuditLogSchema = createInsertSchema(auditLogs).omit({ id: true, createdAt: true });\nexport const insertRefreshTokenSchema = createInsertSchema(refreshTokens).omit({ id: true, createdAt: true });\n\n// Auth schemas\nexport const loginSchema = z.object({\n  username: z.string().min(1, \"Username é obrigatório\"),\n  password: z.string().min(1, \"Password é obrigatório\"),\n});\n\nexport const registerSchema = insertUserSchema.extend({\n  password: z.string().min(6, \"Password deve ter no mínimo 6 caracteres\"),\n}).omit({ role: true }); // Remove role from registration - will be set by admin\n\nexport const refreshTokenRequestSchema = z.object({\n  refreshToken: z.string().min(1, \"Refresh token é obrigatório\"),\n});\n\n// Types for Select\nexport type Filial = typeof filiais.$inferSelect;\nexport type User = typeof users.$inferSelect;\nexport type UserPermission = typeof userPermissions.$inferSelect;\nexport type Veiculo = typeof veiculos.$inferSelect;\nexport type Vaga = typeof vagas.$inferSelect;\nexport type Visitante = typeof visitantes.$inferSelect;\nexport type Chamada = typeof chamadas.$inferSelect;\nexport type Checklist = typeof checklists.$inferSelect;\nexport type ChecklistItem = typeof checklistItems.$inferSelect;\nexport type Notification = typeof notifications.$inferSelect;\nexport type Motorista = typeof motoristas.$inferSelect;\nexport type VeiculoCadastro = typeof veiculosCadastro.$inferSelect;\nexport type Fornecedor = typeof fornecedores.$inferSelect;\nexport type StatusCaminhao = typeof statusCaminhao.$inferSelect;\nexport type AuditLog = typeof auditLogs.$inferSelect;\nexport type RefreshToken = typeof refreshTokens.$inferSelect;\n\n// Types for Insert\nexport type InsertFilial = z.infer<typeof insertFilialSchema>;\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type InsertUserPermission = z.infer<typeof insertUserPermissionSchema>;\nexport type InsertVeiculo = z.infer<typeof insertVeiculoSchema>;\nexport type InsertVaga = z.infer<typeof insertVagaSchema>;\nexport type InsertVisitante = z.infer<typeof insertVisitanteSchema>;\nexport type InsertChamada = z.infer<typeof insertChamadaSchema>;\nexport type InsertChecklist = z.infer<typeof insertChecklistSchema>;\nexport type InsertChecklistItem = z.infer<typeof insertChecklistItemSchema>;\nexport type InsertNotification = z.infer<typeof insertNotificationSchema>;\nexport type InsertMotorista = z.infer<typeof insertMotoristaSchema>;\nexport type InsertVeiculoCadastro = z.infer<typeof insertVeiculoCadastroSchema>;\nexport type InsertFornecedor = z.infer<typeof insertFornecedorSchema>;\nexport type InsertStatusCaminhao = z.infer<typeof insertStatusCaminhaoSchema>;\nexport type InsertAuditLog = z.infer<typeof insertAuditLogSchema>;\nexport type InsertRefreshToken = z.infer<typeof insertRefreshTokenSchema>;\n","size_bytes":20990},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/App.tsx":{"content":"import { Switch, Route, Redirect } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { SidebarProvider, SidebarTrigger } from \"@/components/ui/sidebar\";\nimport { AppSidebar } from \"@/components/app-sidebar\";\nimport { AuthProvider, useAuth } from \"@/hooks/use-auth\";\nimport { useWebSocket } from \"@/hooks/use-websocket\";\nimport { ThemeProvider } from \"@/components/theme-provider\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport { NotificationCenter } from \"@/components/notification-center\";\nimport NotFound from \"@/pages/not-found\";\nimport AuthPage from \"@/pages/auth-page\";\nimport FilialSelectionPage from \"@/pages/filial-selection-page\";\nimport PortariaPage from \"@/pages/portaria-page\";\nimport VagasPage from \"@/pages/vagas-page\";\nimport VagasAdminPage from \"@/pages/vagas-admin-page\";\nimport VisitantesPage from \"@/pages/visitantes-page\";\nimport ChamadasPage from \"@/pages/chamadas-page\";\nimport ClienteDashboardPage from \"@/pages/cliente-dashboard-page\";\nimport ClienteChamadasPage from \"@/pages/cliente-chamadas-page\";\nimport RelatoriosPage from \"@/pages/relatorios-page\";\nimport GestaoPage from \"@/pages/gestao-page\";\nimport UsuariosPage from \"@/pages/usuarios-page\";\nimport FiliaisPage from \"@/pages/filiais-page\";\nimport AuditoriaPage from \"@/pages/auditoria-page\";\nimport MotoristasPage from \"@/pages/motoristas-page\";\nimport VeiculosCadastroPage from \"@/pages/veiculos-cadastro-page\";\nimport FornecedoresPage from \"@/pages/fornecedores-page\";\nimport StatusCaminhaoPage from \"@/pages/status-caminhao-page\";\nimport TVDisplayPage from \"@/pages/tv-display-page\";\nimport { Loader2 } from \"lucide-react\";\n\nfunction ProtectedLayout({ children }: { children: React.ReactNode }) {\n  const { user, isLoading } = useAuth();\n  \n  // Initialize WebSocket connection for real-time updates\n  useWebSocket();\n  \n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen bg-background\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  if (!user) {\n    return <Redirect to=\"/auth\" />;\n  }\n\n  const style = {\n    \"--sidebar-width\": \"16rem\",\n    \"--sidebar-width-icon\": \"3rem\",\n  };\n\n  return (\n    <SidebarProvider style={style as React.CSSProperties}>\n      <div className=\"flex h-screen w-full\">\n        <AppSidebar />\n        <div className=\"flex flex-col flex-1 overflow-hidden\">\n          <header className=\"flex items-center justify-between gap-2 border-b border-border px-4 h-16 flex-shrink-0\">\n            <SidebarTrigger data-testid=\"button-sidebar-toggle\" />\n            <div className=\"flex items-center gap-2\">\n              <NotificationCenter />\n              <ThemeToggle />\n            </div>\n          </header>\n          <main className=\"flex-1 overflow-auto\">\n            {children}\n          </main>\n        </div>\n      </div>\n    </SidebarProvider>\n  );\n}\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/auth\" component={AuthPage} />\n      \n      <Route path=\"/filial\">\n        {() => (\n          <ProtectedLayout>\n            <FilialSelectionPage />\n          </ProtectedLayout>\n        )}\n      </Route>\n      \n      <Route path=\"/portaria\">\n        {() => (\n          <ProtectedLayout>\n            <PortariaPage />\n          </ProtectedLayout>\n        )}\n      </Route>\n      \n      <Route path=\"/vagas\">\n        {() => (\n          <ProtectedLayout>\n            <VagasPage />\n          </ProtectedLayout>\n        )}\n      </Route>\n      \n      <Route path=\"/visitantes\">\n        {() => (\n          <ProtectedLayout>\n            <VisitantesPage />\n          </ProtectedLayout>\n        )}\n      </Route>\n      \n      <Route path=\"/chamadas\">\n        {() => (\n          <ProtectedLayout>\n            <ChamadasPage />\n          </ProtectedLayout>\n        )}\n      </Route>\n      \n      <Route path=\"/cliente\">\n        {() => (\n          <ProtectedLayout>\n            <ClienteDashboardPage />\n          </ProtectedLayout>\n        )}\n      </Route>\n      \n      <Route path=\"/cliente-chamadas\">\n        {() => (\n          <ProtectedLayout>\n            <ClienteChamadasPage />\n          </ProtectedLayout>\n        )}\n      </Route>\n      \n      <Route path=\"/relatorios\">\n        {() => (\n          <ProtectedLayout>\n            <RelatoriosPage />\n          </ProtectedLayout>\n        )}\n      </Route>\n      \n      <Route path=\"/gestao\">\n        {() => (\n          <ProtectedLayout>\n            <GestaoPage />\n          </ProtectedLayout>\n        )}\n      </Route>\n      \n      <Route path=\"/usuarios\">\n        {() => (\n          <ProtectedLayout>\n            <UsuariosPage />\n          </ProtectedLayout>\n        )}\n      </Route>\n      \n      <Route path=\"/filiais\">\n        {() => (\n          <ProtectedLayout>\n            <FiliaisPage />\n          </ProtectedLayout>\n        )}\n      </Route>\n      \n      <Route path=\"/auditoria\">\n        {() => (\n          <ProtectedLayout>\n            <AuditoriaPage />\n          </ProtectedLayout>\n        )}\n      </Route>\n      \n      <Route path=\"/vagas-admin\">\n        {() => (\n          <ProtectedLayout>\n            <VagasAdminPage />\n          </ProtectedLayout>\n        )}\n      </Route>\n      \n      <Route path=\"/motoristas\">\n        {() => (\n          <ProtectedLayout>\n            <MotoristasPage />\n          </ProtectedLayout>\n        )}\n      </Route>\n      \n      <Route path=\"/veiculos-cadastro\">\n        {() => (\n          <ProtectedLayout>\n            <VeiculosCadastroPage />\n          </ProtectedLayout>\n        )}\n      </Route>\n      \n      <Route path=\"/fornecedores\">\n        {() => (\n          <ProtectedLayout>\n            <FornecedoresPage />\n          </ProtectedLayout>\n        )}\n      </Route>\n      \n      <Route path=\"/status-caminhao\">\n        {() => (\n          <ProtectedLayout>\n            <StatusCaminhaoPage />\n          </ProtectedLayout>\n        )}\n      </Route>\n      \n      <Route path=\"/tv-display\">\n        {() => <TVDisplayPage />}\n      </Route>\n      \n      <Route path=\"/\">\n        {() => <Redirect to=\"/filial\" />}\n      </Route>\n      \n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <ThemeProvider>\n        <AuthProvider>\n          <TooltipProvider>\n            <div className=\"min-h-screen bg-background\">\n              <Router />\n            </div>\n            <Toaster />\n          </TooltipProvider>\n        </AuthProvider>\n      </ThemeProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":6719},"client/src/pages/chamadas-page.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Bell, Loader2, Check, Plus } from \"lucide-react\";\nimport { StatusBadge } from \"@/components/status-badge\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { format } from \"date-fns\";\nimport { ptBR } from \"date-fns/locale\";\nimport type { Chamada, Veiculo } from \"@shared/schema\";\nimport { Badge } from \"@/components/ui/badge\";\n\nexport default function ChamadasPage() {\n  const { toast } = useToast();\n  const filialId = localStorage.getItem(\"selected_filial\");\n  const [showNewDialog, setShowNewDialog] = useState(false);\n  const [formData, setFormData] = useState({\n    veiculoId: \"\",\n    motivo: \"\",\n  });\n\n  const { data: chamadas, isLoading } = useQuery<Chamada[]>({\n    queryKey: [\"/api/chamadas\", filialId],\n    enabled: !!filialId,\n  });\n\n  const { data: veiculos } = useQuery<Veiculo[]>({\n    queryKey: [\"/api/veiculos\", filialId],\n    enabled: !!filialId,\n  });\n\n  const createChamadaMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const res = await apiRequest(\"POST\", \"/api/chamadas\", {\n        ...data,\n        filialId,\n      });\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/chamadas\"] });\n      toast({\n        title: \"Chamada criada\",\n        description: \"Motorista será notificado\",\n      });\n      setFormData({ veiculoId: \"\", motivo: \"\" });\n      setShowNewDialog(false);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro ao criar chamada\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const atenderChamadaMutation = useMutation({\n    mutationFn: async (chamadaId: string) => {\n      const res = await apiRequest(\"PATCH\", `/api/chamadas/${chamadaId}/atender`, {});\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/chamadas\"] });\n      toast({\n        title: \"Chamada atendida\",\n        description: \"Motorista foi notificado\",\n      });\n    },\n  });\n\n  const getVeiculoById = (veiculoId: string) => {\n    return veiculos?.find((v) => v.id === veiculoId);\n  };\n\n  const chamadasPendentes = chamadas?.filter((c) => c.status === \"pendente\");\n  const chamadasAtendidas = chamadas?.filter((c) => c.status === \"atendida\");\n  const veiculosAtivos = veiculos?.filter((v) => v.situacao !== \"finalizado\");\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[60vh]\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">Chamadas de Motorista</h1>\n          <p className=\"text-muted-foreground\">Gerencie as notificações e chamadas dos motoristas</p>\n        </div>\n        <Dialog open={showNewDialog} onOpenChange={setShowNewDialog}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-nova-chamada\">\n              <Plus className=\"mr-2 h-4 w-4\" />\n              Nova Chamada\n            </Button>\n          </DialogTrigger>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Criar Nova Chamada</DialogTitle>\n              <DialogDescription>\n                Solicite um motorista para atendimento\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"veiculo\">Veículo *</Label>\n                <Select\n                  value={formData.veiculoId}\n                  onValueChange={(value) => setFormData({ ...formData, veiculoId: value })}\n                >\n                  <SelectTrigger id=\"veiculo\" data-testid=\"select-veiculo\">\n                    <SelectValue placeholder=\"Selecione o veículo\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {veiculosAtivos?.map((veiculo) => (\n                      <SelectItem key={veiculo.id} value={veiculo.id}>\n                        {veiculo.placaCavalo} - {veiculo.motorista}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"motivo\">Motivo *</Label>\n                <Input\n                  id=\"motivo\"\n                  data-testid=\"input-motivo\"\n                  placeholder=\"Ex: Movimentar veículo para doca 5\"\n                  value={formData.motivo}\n                  onChange={(e) => setFormData({ ...formData, motivo: e.target.value })}\n                />\n              </div>\n              <div className=\"flex gap-2 justify-end\">\n                <Button\n                  variant=\"outline\"\n                  onClick={() => {\n                    setShowNewDialog(false);\n                    setFormData({ veiculoId: \"\", motivo: \"\" });\n                  }}\n                >\n                  Cancelar\n                </Button>\n                <Button\n                  onClick={() => createChamadaMutation.mutate(formData)}\n                  disabled={!formData.veiculoId || !formData.motivo || createChamadaMutation.isPending}\n                  data-testid=\"button-criar-chamada\"\n                >\n                  {createChamadaMutation.isPending ? (\n                    <>\n                      <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                      Criando...\n                    </>\n                  ) : (\n                    \"Criar Chamada\"\n                  )}\n                </Button>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Stats */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Chamadas Pendentes</CardDescription>\n            <CardTitle className=\"text-3xl text-amber-600\">{chamadasPendentes?.length || 0}</CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Atendidas Hoje</CardDescription>\n            <CardTitle className=\"text-3xl text-emerald-600\">{chamadasAtendidas?.length || 0}</CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Total Hoje</CardDescription>\n            <CardTitle className=\"text-3xl\">{chamadas?.length || 0}</CardTitle>\n          </CardHeader>\n        </Card>\n      </div>\n\n      {/* Chamadas Pendentes */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Chamadas Pendentes</CardTitle>\n          <CardDescription>Atenda as chamadas dos motoristas</CardDescription>\n        </CardHeader>\n        <CardContent>\n          {chamadasPendentes && chamadasPendentes.length > 0 ? (\n            <div className=\"space-y-2\">\n              {chamadasPendentes.map((chamada) => {\n                const veiculo = getVeiculoById(chamada.veiculoId);\n                return (\n                  <div\n                    key={chamada.id}\n                    className=\"flex items-center justify-between p-4 border rounded-lg hover-elevate animate-pulse\"\n                    data-testid={`chamada-${chamada.id}`}\n                  >\n                    <div className=\"flex-1 space-y-1\">\n                      <div className=\"flex items-center gap-2\">\n                        <Bell className=\"h-4 w-4 text-amber-600\" />\n                        <span className=\"font-medium\">{chamada.motivo}</span>\n                        <StatusBadge status={chamada.status} type=\"chamada\" />\n                      </div>\n                      {veiculo && (\n                        <>\n                          <div className=\"text-sm text-muted-foreground\">\n                            Veículo: {veiculo.placaCavalo} - {veiculo.motorista}\n                          </div>\n                        </>\n                      )}\n                      <div className=\"text-xs text-muted-foreground\">\n                        Criada em: {format(new Date(chamada.createdAt), \"dd/MM/yyyy HH:mm\", { locale: ptBR })}\n                      </div>\n                    </div>\n                    <Button\n                      onClick={() => atenderChamadaMutation.mutate(chamada.id)}\n                      disabled={atenderChamadaMutation.isPending}\n                      data-testid={`button-atender-${chamada.id}`}\n                    >\n                      <Check className=\"mr-2 h-4 w-4\" />\n                      Atender\n                    </Button>\n                  </div>\n                );\n              })}\n            </div>\n          ) : (\n            <div className=\"text-center py-8\">\n              <Bell className=\"h-12 w-12 text-muted-foreground mx-auto mb-4 opacity-50\" />\n              <p className=\"text-muted-foreground\">Nenhuma chamada pendente</p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Histórico */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Histórico de Chamadas</CardTitle>\n          <CardDescription>Chamadas atendidas e canceladas</CardDescription>\n        </CardHeader>\n        <CardContent>\n          {chamadasAtendidas && chamadasAtendidas.length > 0 ? (\n            <div className=\"space-y-2\">\n              {chamadasAtendidas.map((chamada) => {\n                const veiculo = getVeiculoById(chamada.veiculoId);\n                return (\n                  <div key={chamada.id} className=\"p-4 border rounded-lg\">\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"space-y-1\">\n                        <div className=\"flex items-center gap-2\">\n                          <Bell className=\"h-4 w-4 text-muted-foreground\" />\n                          <span className=\"font-medium\">{chamada.motivo}</span>\n                          <StatusBadge status={chamada.status} type=\"chamada\" />\n                        </div>\n                        {veiculo && (\n                          <div className=\"text-sm text-muted-foreground\">\n                            Veículo: {veiculo.placaCavalo} - {veiculo.motorista}\n                          </div>\n                        )}\n                      </div>\n                      <div className=\"text-right text-sm text-muted-foreground\">\n                        {chamada.dataAtendimento && (\n                          <div>Atendida: {format(new Date(chamada.dataAtendimento), \"dd/MM HH:mm\", { locale: ptBR })}</div>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          ) : (\n            <div className=\"text-center py-8\">\n              <Bell className=\"h-12 w-12 text-muted-foreground mx-auto mb-4 opacity-50\" />\n              <p className=\"text-muted-foreground\">Nenhuma chamada atendida hoje</p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":11767},"client/src/pages/usuarios-page.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Users, Plus, Loader2, Edit, Trash2, Building2, X } from \"lucide-react\";\nimport { RoleBadge } from \"@/components/role-badge\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { User, Filial } from \"@shared/schema\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\n\ntype UserPermission = {\n  id: string;\n  userId: string;\n  filialId: string;\n  createdAt: Date;\n  filial: Filial;\n};\n\nexport default function UsuariosPage() {\n  const { toast } = useToast();\n  const [showNewDialog, setShowNewDialog] = useState(false);\n  const [showPermissionsDialog, setShowPermissionsDialog] = useState(false);\n  const [selectedUserId, setSelectedUserId] = useState<string | null>(null);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [selectedFilialId, setSelectedFilialId] = useState<string>(\"\");\n\n  const [formData, setFormData] = useState({\n    username: \"\",\n    email: \"\",\n    password: \"\",\n    nome: \"\",\n    role: \"porteiro\" as \"porteiro\" | \"cliente\" | \"gestor\",\n  });\n\n  const { data: users, isLoading } = useQuery<User[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  const { data: allFiliais } = useQuery<Filial[]>({\n    queryKey: [\"/api/filiais\"],\n  });\n\n  const { data: currentUserFilialIds } = useQuery<string[]>({\n    queryKey: [\"/api/user-filiais\"],\n  });\n\n  // Only show filiais that the current gestor has access to\n  const filiais = allFiliais?.filter(f => currentUserFilialIds?.includes(f.id));\n\n  const { data: userPermissions, isLoading: isLoadingPermissions } = useQuery<UserPermission[]>({\n    queryKey: [\"/api/users\", selectedUserId, \"permissions\"],\n    enabled: !!selectedUserId,\n  });\n\n  const createUserMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const res = await apiRequest(\"POST\", \"/api/users\", data);\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      toast({\n        title: \"Usuário criado\",\n        description: \"Novo usuário adicionado com sucesso\",\n      });\n      setFormData({\n        username: \"\",\n        email: \"\",\n        password: \"\",\n        nome: \"\",\n        role: \"porteiro\",\n      });\n      setShowNewDialog(false);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro ao criar usuário\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const toggleUserStatusMutation = useMutation({\n    mutationFn: async ({ userId, ativo }: { userId: string; ativo: boolean }) => {\n      const res = await apiRequest(\"PATCH\", `/api/users/${userId}`, { ativo });\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      toast({\n        title: \"Status atualizado\",\n        description: \"Status do usuário alterado\",\n      });\n    },\n  });\n\n  const addPermissionMutation = useMutation({\n    mutationFn: async ({ userId, filialId }: { userId: string; filialId: string }) => {\n      const res = await apiRequest(\"POST\", `/api/users/${userId}/permissions`, { filialId });\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\", selectedUserId, \"permissions\"] });\n      toast({\n        title: \"Permissão adicionada\",\n        description: \"Filial adicionada ao usuário com sucesso\",\n      });\n      setSelectedFilialId(\"\");\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro ao adicionar permissão\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const removePermissionMutation = useMutation({\n    mutationFn: async (permissionId: string) => {\n      await apiRequest(\"DELETE\", `/api/user-permissions/${permissionId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\", selectedUserId, \"permissions\"] });\n      toast({\n        title: \"Permissão removida\",\n        description: \"Filial removida do usuário\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    createUserMutation.mutate(formData);\n  };\n\n  const filteredUsers = users?.filter((user) =>\n    user.nome.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    user.email.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    user.username.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  const usuariosAtivos = users?.filter((u) => u.ativo).length || 0;\n  const usuariosInativos = users?.filter((u) => !u.ativo).length || 0;\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">Usuários</h1>\n          <p className=\"text-muted-foreground\">Gerencie os usuários do sistema</p>\n        </div>\n        <Button onClick={() => setShowNewDialog(true)} data-testid=\"button-novo-usuario\">\n          <Plus className=\"mr-2 h-4 w-4\" />\n          Novo Usuário\n        </Button>\n      </div>\n\n      {/* Stats */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Total de Usuários</CardDescription>\n            <CardTitle className=\"text-3xl\">{users?.length || 0}</CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Usuários Ativos</CardDescription>\n            <CardTitle className=\"text-3xl text-emerald-600\">{usuariosAtivos}</CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Usuários Inativos</CardDescription>\n            <CardTitle className=\"text-3xl text-gray-500\">{usuariosInativos}</CardTitle>\n          </CardHeader>\n        </Card>\n      </div>\n\n      {/* Search */}\n      <div className=\"flex gap-4\">\n        <div className=\"flex-1\">\n          <Input\n            placeholder=\"Buscar usuários...\"\n            data-testid=\"input-search-usuarios\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n          />\n        </div>\n      </div>\n\n      {/* Users List */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Lista de Usuários</CardTitle>\n          <CardDescription>{filteredUsers?.length || 0} usuários encontrados</CardDescription>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"flex justify-center py-8\">\n              <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n            </div>\n          ) : filteredUsers && filteredUsers.length > 0 ? (\n            <div className=\"space-y-2\">\n              {filteredUsers.map((user) => (\n                <div\n                  key={user.id}\n                  className=\"flex items-center justify-between p-4 border rounded-lg hover-elevate\"\n                  data-testid={`user-${user.username}`}\n                >\n                  <div className=\"flex-1 space-y-1\">\n                    <div className=\"flex items-center gap-2\">\n                      <Users className=\"h-4 w-4 text-muted-foreground\" />\n                      <span className=\"font-medium\">{user.nome}</span>\n                      <RoleBadge role={user.role} />\n                      {user.ativo ? (\n                        <Badge variant=\"outline\" className=\"bg-emerald-100 text-emerald-800 border-emerald-200 dark:bg-emerald-950 dark:text-emerald-200 dark:border-emerald-800\">\n                          Ativo\n                        </Badge>\n                      ) : (\n                        <Badge variant=\"outline\" className=\"bg-gray-100 text-gray-800 border-gray-200 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700\">\n                          Inativo\n                        </Badge>\n                      )}\n                    </div>\n                    <div className=\"text-sm text-muted-foreground\">\n                      {user.email} • @{user.username}\n                    </div>\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => {\n                        setSelectedUserId(user.id);\n                        setShowPermissionsDialog(true);\n                      }}\n                      data-testid={`button-permissions-${user.username}`}\n                    >\n                      <Building2 className=\"mr-2 h-4 w-4\" />\n                      Filiais\n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => toggleUserStatusMutation.mutate({ userId: user.id, ativo: !user.ativo })}\n                      disabled={toggleUserStatusMutation.isPending}\n                      data-testid={`button-toggle-${user.username}`}\n                    >\n                      {user.ativo ? \"Desativar\" : \"Ativar\"}\n                    </Button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <div className=\"text-center py-8\">\n              <Users className=\"h-12 w-12 text-muted-foreground mx-auto mb-4 opacity-50\" />\n              <p className=\"text-muted-foreground\">Nenhum usuário encontrado</p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Dialog Novo Usuário */}\n      <Dialog open={showNewDialog} onOpenChange={setShowNewDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Criar Novo Usuário</DialogTitle>\n            <DialogDescription>\n              Preencha os dados do novo usuário\n            </DialogDescription>\n          </DialogHeader>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"nome\">Nome Completo *</Label>\n              <Input\n                id=\"nome\"\n                data-testid=\"input-nome\"\n                placeholder=\"João Silva\"\n                value={formData.nome}\n                onChange={(e) => setFormData({ ...formData, nome: e.target.value })}\n                required\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\">E-mail *</Label>\n              <Input\n                id=\"email\"\n                data-testid=\"input-email\"\n                type=\"email\"\n                placeholder=\"joao@empresa.com\"\n                value={formData.email}\n                onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n                required\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"username\">Usuário *</Label>\n              <Input\n                id=\"username\"\n                data-testid=\"input-username\"\n                placeholder=\"joao.silva\"\n                value={formData.username}\n                onChange={(e) => setFormData({ ...formData, username: e.target.value })}\n                required\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"password\">Senha *</Label>\n              <Input\n                id=\"password\"\n                data-testid=\"input-password\"\n                type=\"password\"\n                placeholder=\"••••••••\"\n                value={formData.password}\n                onChange={(e) => setFormData({ ...formData, password: e.target.value })}\n                required\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"role\">Perfil *</Label>\n              <Select\n                value={formData.role}\n                onValueChange={(value) => setFormData({ ...formData, role: value as typeof formData.role })}\n              >\n                <SelectTrigger id=\"role\" data-testid=\"select-role\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"porteiro\">Porteiro</SelectItem>\n                  <SelectItem value=\"cliente\">Cliente</SelectItem>\n                  <SelectItem value=\"gestor\">Gestor</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <DialogFooter>\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => setShowNewDialog(false)}\n              >\n                Cancelar\n              </Button>\n              <Button\n                type=\"submit\"\n                disabled={createUserMutation.isPending}\n                data-testid=\"button-criar-usuario\"\n              >\n                {createUserMutation.isPending ? (\n                  <>\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                    Criando...\n                  </>\n                ) : (\n                  \"Criar Usuário\"\n                )}\n              </Button>\n            </DialogFooter>\n          </form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Dialog Gerenciar Permissões */}\n      <Dialog open={showPermissionsDialog} onOpenChange={setShowPermissionsDialog}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>Gerenciar Filiais do Usuário</DialogTitle>\n            <DialogDescription>\n              Adicione ou remova filiais às quais o usuário tem acesso\n            </DialogDescription>\n          </DialogHeader>\n\n          <div className=\"space-y-6\">\n            {/* Adicionar Nova Permissão */}\n            <div className=\"space-y-2\">\n              <Label>Adicionar Filial</Label>\n              <div className=\"flex gap-2\">\n                <Select\n                  value={selectedFilialId}\n                  onValueChange={setSelectedFilialId}\n                >\n                  <SelectTrigger data-testid=\"select-filial\">\n                    <SelectValue placeholder=\"Selecione uma filial\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {filiais\n                      ?.filter(f => !userPermissions?.some(p => p.filialId === f.id))\n                      ?.map((filial) => (\n                        <SelectItem key={filial.id} value={filial.id}>\n                          {filial.nome} ({filial.codigo})\n                        </SelectItem>\n                      ))}\n                  </SelectContent>\n                </Select>\n                <Button\n                  onClick={() => selectedUserId && selectedFilialId && addPermissionMutation.mutate({ userId: selectedUserId, filialId: selectedFilialId })}\n                  disabled={!selectedFilialId || addPermissionMutation.isPending}\n                  data-testid=\"button-add-permission\"\n                >\n                  {addPermissionMutation.isPending ? (\n                    <Loader2 className=\"h-4 w-4 animate-spin\" />\n                  ) : (\n                    <>\n                      <Plus className=\"mr-2 h-4 w-4\" />\n                      Adicionar\n                    </>\n                  )}\n                </Button>\n              </div>\n            </div>\n\n            {/* Lista de Permissões Atuais */}\n            <div className=\"space-y-2\">\n              <Label>Filiais com Acesso</Label>\n              {isLoadingPermissions ? (\n                <div className=\"flex justify-center py-8\">\n                  <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n                </div>\n              ) : userPermissions && userPermissions.length > 0 ? (\n                <div className=\"space-y-2\">\n                  {userPermissions.map((permission) => (\n                    <div\n                      key={permission.id}\n                      className=\"flex items-center justify-between p-3 border rounded-lg\"\n                      data-testid={`permission-${permission.filial.codigo}`}\n                    >\n                      <div className=\"flex items-center gap-2\">\n                        <Building2 className=\"h-4 w-4 text-muted-foreground\" />\n                        <div>\n                          <div className=\"font-medium\">{permission.filial.nome}</div>\n                          <div className=\"text-sm text-muted-foreground\">\n                            Código: {permission.filial.codigo}\n                          </div>\n                        </div>\n                      </div>\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        onClick={() => removePermissionMutation.mutate(permission.id)}\n                        disabled={removePermissionMutation.isPending}\n                        data-testid={`button-remove-permission-${permission.filial.codigo}`}\n                      >\n                        <X className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  ))}\n                </div>\n              ) : (\n                <div className=\"text-center py-8 border rounded-lg\">\n                  <Building2 className=\"h-12 w-12 text-muted-foreground mx-auto mb-4 opacity-50\" />\n                  <p className=\"text-muted-foreground\">Nenhuma filial atribuída</p>\n                </div>\n              )}\n            </div>\n          </div>\n\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setShowPermissionsDialog(false);\n                setSelectedUserId(null);\n                setSelectedFilialId(\"\");\n              }}\n            >\n              Fechar\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":18433},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":1080},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/pages/filiais-page.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Building2, Plus, Loader2, MapPin, Edit } from \"lucide-react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Filial } from \"@shared/schema\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\n\nexport default function FiliaisPage() {\n  const { toast } = useToast();\n  const [showNewDialog, setShowNewDialog] = useState(false);\n  const [showEditDialog, setShowEditDialog] = useState(false);\n  const [editingFilial, setEditingFilial] = useState<Filial | null>(null);\n\n  const [formData, setFormData] = useState({\n    nome: \"\",\n    codigo: \"\",\n    endereco: \"\",\n  });\n\n  const [editFormData, setEditFormData] = useState({\n    endereco: \"\",\n  });\n\n  const { data: filiais, isLoading } = useQuery<Filial[]>({\n    queryKey: [\"/api/filiais\"],\n  });\n\n  const createFilialMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const res = await apiRequest(\"POST\", \"/api/filiais\", data);\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/filiais\"] });\n      toast({\n        title: \"Filial criada\",\n        description: \"Nova filial adicionada com sucesso\",\n      });\n      setFormData({\n        nome: \"\",\n        codigo: \"\",\n        endereco: \"\",\n      });\n      setShowNewDialog(false);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro ao criar filial\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const toggleFilialStatusMutation = useMutation({\n    mutationFn: async ({ filialId, ativo }: { filialId: string; ativo: boolean }) => {\n      const res = await apiRequest(\"PATCH\", `/api/filiais/${filialId}`, { ativo });\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/filiais\"] });\n      toast({\n        title: \"Status atualizado\",\n        description: \"Status da filial alterado\",\n      });\n    },\n  });\n\n  const updateFilialMutation = useMutation({\n    mutationFn: async ({ filialId, endereco }: { filialId: string; endereco: string }) => {\n      const res = await apiRequest(\"PATCH\", `/api/filiais/${filialId}`, { endereco });\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/filiais\"] });\n      toast({\n        title: \"Endereço atualizado\",\n        description: \"Endereço da filial atualizado com sucesso\",\n      });\n      setShowEditDialog(false);\n      setEditingFilial(null);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro ao atualizar endereço\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    createFilialMutation.mutate(formData);\n  };\n\n  const handleEditSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (editingFilial) {\n      updateFilialMutation.mutate({\n        filialId: editingFilial.id,\n        endereco: editFormData.endereco,\n      });\n    }\n  };\n\n  const openEditDialog = (filial: Filial) => {\n    setEditingFilial(filial);\n    setEditFormData({ endereco: filial.endereco });\n    setShowEditDialog(true);\n  };\n\n  const filiaisAtivas = filiais?.filter((f) => f.ativo).length || 0;\n  const filiaisInativas = filiais?.filter((f) => !f.ativo).length || 0;\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">Filiais</h1>\n          <p className=\"text-muted-foreground\">Gerencie as filiais do sistema</p>\n        </div>\n        <Button onClick={() => setShowNewDialog(true)} data-testid=\"button-nova-filial\">\n          <Plus className=\"mr-2 h-4 w-4\" />\n          Nova Filial\n        </Button>\n      </div>\n\n      {/* Stats */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Total de Filiais</CardDescription>\n            <CardTitle className=\"text-3xl\">{filiais?.length || 0}</CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Filiais Ativas</CardDescription>\n            <CardTitle className=\"text-3xl text-emerald-600\">{filiaisAtivas}</CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Filiais Inativas</CardDescription>\n            <CardTitle className=\"text-3xl text-gray-500\">{filiaisInativas}</CardTitle>\n          </CardHeader>\n        </Card>\n      </div>\n\n      {/* Filiais List */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Lista de Filiais</CardTitle>\n          <CardDescription>Todas as filiais cadastradas</CardDescription>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"flex justify-center py-8\">\n              <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n            </div>\n          ) : filiais && filiais.length > 0 ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              {filiais.map((filial) => (\n                <Card\n                  key={filial.id}\n                  className=\"hover-elevate\"\n                  data-testid={`filial-${filial.codigo}`}\n                >\n                  <CardHeader>\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"space-y-1\">\n                        <CardTitle className=\"flex items-center gap-2\">\n                          {filial.nome}\n                        </CardTitle>\n                        <div className=\"flex items-center gap-2\">\n                          <Badge variant=\"secondary\" className=\"text-xs\">\n                            {filial.codigo.toUpperCase()}\n                          </Badge>\n                          {filial.ativo ? (\n                            <Badge variant=\"outline\" className=\"bg-emerald-100 text-emerald-800 border-emerald-200 dark:bg-emerald-950 dark:text-emerald-200 dark:border-emerald-800 text-xs\">\n                              Ativa\n                            </Badge>\n                          ) : (\n                            <Badge variant=\"outline\" className=\"bg-gray-100 text-gray-800 border-gray-200 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 text-xs\">\n                              Inativa\n                            </Badge>\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                  </CardHeader>\n                  <CardContent className=\"space-y-3\">\n                    <div className=\"flex items-start gap-2 text-sm text-muted-foreground\">\n                      <MapPin className=\"h-4 w-4 mt-0.5 flex-shrink-0\" />\n                      <span>{filial.endereco}</span>\n                    </div>\n                    <div className=\"flex gap-2\">\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        className=\"flex-1\"\n                        onClick={() => openEditDialog(filial)}\n                        data-testid={`button-editar-${filial.codigo}`}\n                      >\n                        <Edit className=\"h-4 w-4 mr-2\" />\n                        Editar\n                      </Button>\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        className=\"flex-1\"\n                        onClick={() => toggleFilialStatusMutation.mutate({ filialId: filial.id, ativo: !filial.ativo })}\n                        disabled={toggleFilialStatusMutation.isPending}\n                        data-testid={`button-toggle-${filial.codigo}`}\n                      >\n                        {filial.ativo ? \"Desativar\" : \"Ativar\"}\n                      </Button>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          ) : (\n            <div className=\"text-center py-8\">\n              <Building2 className=\"h-12 w-12 text-muted-foreground mx-auto mb-4 opacity-50\" />\n              <p className=\"text-muted-foreground\">Nenhuma filial cadastrada</p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Dialog Nova Filial */}\n      <Dialog open={showNewDialog} onOpenChange={setShowNewDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Criar Nova Filial</DialogTitle>\n            <DialogDescription>\n              Preencha os dados da nova filial\n            </DialogDescription>\n          </DialogHeader>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"nome\">Nome *</Label>\n              <Input\n                id=\"nome\"\n                data-testid=\"input-nome-filial\"\n                placeholder=\"Filial Guarulhos\"\n                value={formData.nome}\n                onChange={(e) => setFormData({ ...formData, nome: e.target.value })}\n                required\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"codigo\">Código *</Label>\n              <Input\n                id=\"codigo\"\n                data-testid=\"input-codigo-filial\"\n                placeholder=\"guarulhos\"\n                value={formData.codigo}\n                onChange={(e) => setFormData({ ...formData, codigo: e.target.value.toLowerCase() })}\n                required\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"endereco\">Endereço *</Label>\n              <Input\n                id=\"endereco\"\n                data-testid=\"input-endereco-filial\"\n                placeholder=\"Rua Exemplo, 123 - Guarulhos/SP\"\n                value={formData.endereco}\n                onChange={(e) => setFormData({ ...formData, endereco: e.target.value })}\n                required\n              />\n            </div>\n            <DialogFooter>\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => setShowNewDialog(false)}\n              >\n                Cancelar\n              </Button>\n              <Button\n                type=\"submit\"\n                disabled={createFilialMutation.isPending}\n                data-testid=\"button-criar-filial\"\n              >\n                {createFilialMutation.isPending ? (\n                  <>\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                    Criando...\n                  </>\n                ) : (\n                  \"Criar Filial\"\n                )}\n              </Button>\n            </DialogFooter>\n          </form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Dialog Editar Endereço */}\n      <Dialog open={showEditDialog} onOpenChange={setShowEditDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Editar Endereço</DialogTitle>\n            <DialogDescription>\n              Atualize o endereço da filial {editingFilial?.nome}\n            </DialogDescription>\n          </DialogHeader>\n          <form onSubmit={handleEditSubmit} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"edit-endereco\">Endereço *</Label>\n              <Input\n                id=\"edit-endereco\"\n                data-testid=\"input-edit-endereco\"\n                placeholder=\"Rua Exemplo, 123 - Cidade/Estado\"\n                value={editFormData.endereco}\n                onChange={(e) => setEditFormData({ endereco: e.target.value })}\n                required\n              />\n            </div>\n            <DialogFooter>\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => {\n                  setShowEditDialog(false);\n                  setEditingFilial(null);\n                }}\n              >\n                Cancelar\n              </Button>\n              <Button\n                type=\"submit\"\n                disabled={updateFilialMutation.isPending}\n                data-testid=\"button-salvar-endereco\"\n              >\n                {updateFilialMutation.isPending ? (\n                  <>\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                    Salvando...\n                  </>\n                ) : (\n                  \"Salvar\"\n                )}\n              </Button>\n            </DialogFooter>\n          </form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":13264},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/pages/portaria-page.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Truck, LogOut, Plus, Loader2, Clock, UserCheck, ArrowLeft } from \"lucide-react\";\nimport { StatusBadge } from \"@/components/status-badge\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { format } from \"date-fns\";\nimport { ptBR } from \"date-fns/locale\";\nimport { useLocation } from \"wouter\";\nimport type { Veiculo, Vaga, Visitante } from \"@shared/schema\";\n\ntype OperationMode = \"selection\" | \"veiculo\";\n\nexport default function PortariaPage() {\n  const { toast } = useToast();\n  const [, setLocation] = useLocation();\n  const filialId = localStorage.getItem(\"selected_filial\");\n  const [operationMode, setOperationMode] = useState<OperationMode>(\"selection\");\n  const [activeTab, setActiveTab] = useState(\"entrada\");\n  \n  // Estado para Dialog de Saída\n  const [saidaDialogOpen, setSaidaDialogOpen] = useState(false);\n  const [veiculoSaida, setVeiculoSaida] = useState<Veiculo | null>(null);\n  const [saidaData, setSaidaData] = useState({\n    cte: \"\",\n    nf: \"\",\n    lacre: \"\",\n  });\n\n  const [formData, setFormData] = useState({\n    tipoVeiculoCategoria: \"cavalo_carreta\" as \"carro\" | \"moto\" | \"cavalo\" | \"cavalo_carreta\",\n    tipoProprietario: \"terceiro\" as \"terceiro\" | \"agregado\" | \"frota\",\n    statusCarga: \"\" as \"\" | \"carregado\" | \"descarregado\" | \"pernoite\" | \"manutencao\",\n    tipoMotorista: \"visitante\" as \"visitante\" | \"funcionario\", // For carro/moto\n    placaCavalo: \"\",\n    placaCarreta: \"\",\n    motorista: \"\",\n    cpfMotorista: \"\",\n    transportadora: \"\",\n    cliente: \"\",\n    doca: \"\",\n    vagaId: \"\",\n    multi: false,\n    valor: \"\",\n    cte: \"\",\n    nf: \"\",\n    lacre: \"\",\n    observacoes: \"\",\n  });\n\n  const isVeiculoLeve = formData.tipoVeiculoCategoria === \"carro\" || formData.tipoVeiculoCategoria === \"moto\";\n\n  // Clear heavy-vehicle fields when switching to light vehicle\n  useEffect(() => {\n    if (isVeiculoLeve) {\n      setFormData(prev => ({\n        ...prev,\n        placaCarreta: \"\",\n        transportadora: \"\",\n        cliente: \"\",\n        doca: \"\",\n        valor: \"\",\n        cte: \"\",\n        nf: \"\",\n        lacre: \"\",\n        statusCarga: \"\",\n        multi: false,\n      }));\n    }\n  }, [isVeiculoLeve]);\n\n  const { data: veiculos, isLoading: loadingVeiculos } = useQuery<Veiculo[]>({\n    queryKey: [\"/api/veiculos\", filialId],\n    enabled: !!filialId,\n  });\n\n  const { data: vagas } = useQuery<Vaga[]>({\n    queryKey: [\"/api/vagas\", filialId],\n    enabled: !!filialId,\n  });\n\n  const { data: visitantes } = useQuery<Visitante[]>({\n    queryKey: [\"/api/visitantes\", filialId],\n    enabled: !!filialId,\n  });\n\n  const createVeiculoMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const payload: any = {\n        ...data,\n        filialId,\n        situacao: \"aguardando\",\n      };\n      \n      // For carro/moto, set tipoProprietario based on tipoMotorista\n      const isLeve = data.tipoVeiculoCategoria === \"carro\" || data.tipoVeiculoCategoria === \"moto\";\n      if (isLeve) {\n        // For light vehicles, clear ALL heavy-vehicle fields to prevent leakage\n        delete payload.placaCarreta;\n        delete payload.transportadora;\n        delete payload.cliente;\n        delete payload.doca;\n        delete payload.multi;\n        delete payload.statusCarga;\n        delete payload.valor;\n        delete payload.cte;\n        delete payload.nf;\n        delete payload.lacre;\n        // Use tipoMotorista to determine observacoes context\n        payload.observacoes = `Tipo: ${data.tipoMotorista === \"visitante\" ? \"Visitante\" : \"Funcionário\"}${data.observacoes ? ` - ${data.observacoes}` : \"\"}`;\n        // Set a default tipoProprietario for light vehicles\n        payload.tipoProprietario = \"terceiro\";\n      } else {\n        // Convert valor to string (numeric) if present\n        if (data.valor && data.valor !== \"\") {\n          payload.valor = parseFloat(data.valor).toFixed(2);\n        } else {\n          delete payload.valor;\n        }\n        // Remove statusCarga if empty\n        if (!data.statusCarga) {\n          delete payload.statusCarga;\n        }\n      }\n      \n      // Remove vagaId if empty\n      if (!data.vagaId || data.vagaId === \"\") {\n        delete payload.vagaId;\n      }\n      \n      // Clean up tipoMotorista as it's not in the schema\n      delete payload.tipoMotorista;\n      \n      const res = await apiRequest(\"POST\", \"/api/veiculos\", payload);\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/veiculos\", filialId] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/vagas\", filialId] });\n      toast({\n        title: \"Veículo registrado\",\n        description: \"Entrada registrada com sucesso\",\n      });\n      setFormData({\n        tipoVeiculoCategoria: \"cavalo_carreta\",\n        tipoProprietario: \"terceiro\",\n        statusCarga: \"\",\n        tipoMotorista: \"visitante\",\n        placaCavalo: \"\",\n        placaCarreta: \"\",\n        motorista: \"\",\n        cpfMotorista: \"\",\n        transportadora: \"\",\n        cliente: \"\",\n        doca: \"\",\n        vagaId: \"\",\n        multi: false,\n        valor: \"\",\n        cte: \"\",\n        nf: \"\",\n        lacre: \"\",\n        observacoes: \"\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro ao registrar\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const registrarSaidaMutation = useMutation({\n    mutationFn: async ({ veiculoId, data }: { veiculoId: string; data: typeof saidaData }) => {\n      const res = await apiRequest(\"PATCH\", `/api/veiculos/${veiculoId}/saida`, data);\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/veiculos\", filialId] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/vagas\", filialId] });\n      toast({\n        title: \"Saída registrada\",\n        description: \"Veículo liberado com sucesso\",\n      });\n      setSaidaDialogOpen(false);\n      setVeiculoSaida(null);\n      setSaidaData({ cte: \"\", nf: \"\", lacre: \"\" });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    createVeiculoMutation.mutate(formData);\n  };\n\n  const handleAbrirSaida = (veiculo: Veiculo) => {\n    setVeiculoSaida(veiculo);\n    setSaidaData({\n      cte: veiculo.cte || \"\",\n      nf: veiculo.nf || \"\",\n      lacre: veiculo.lacre || \"\",\n    });\n    setSaidaDialogOpen(true);\n  };\n\n  const handleConfirmarSaida = () => {\n    if (veiculoSaida) {\n      registrarSaidaMutation.mutate({ veiculoId: veiculoSaida.id, data: saidaData });\n    }\n  };\n\n  const veiculosHoje = veiculos?.filter((v) => {\n    const hoje = new Date();\n    const entrada = new Date(v.dataEntrada);\n    return entrada.toDateString() === hoje.toDateString();\n  });\n\n  const veiculosAtivos = veiculos?.filter((v) => !v.dataSaida);\n\n  const vagasLivres = vagas?.filter((v) => v.status === \"livre\").length || 0;\n  const vagasOcupadas = vagas?.filter((v) => v.status === \"ocupada\").length || 0;\n\n  const visitantesAguardando = visitantes?.filter((v) => v.status === \"aguardando\").length || 0;\n  const visitantesAprovados = visitantes?.filter((v) => v.status === \"aprovado\").length || 0;\n\n  // Selection Cards View\n  if (operationMode === \"selection\") {\n    return (\n      <div className=\"p-4 md:p-6 space-y-4 md:space-y-6 max-w-7xl mx-auto\">\n        {/* Header */}\n        <div className=\"text-center space-y-2\">\n          <h1 className=\"text-2xl md:text-3xl font-bold text-foreground\">Controle de Portaria</h1>\n          <p className=\"text-sm md:text-base text-muted-foreground\">Selecione uma operação para começar</p>\n        </div>\n\n        {/* Selection Cards */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 max-w-4xl mx-auto mt-8\">\n          {/* Veículos Card */}\n          <Card\n            className=\"cursor-pointer transition-all hover-elevate active-elevate-2 border-2\"\n            onClick={() => setOperationMode(\"veiculo\")}\n            data-testid=\"card-select-veiculo\"\n          >\n            <CardHeader className=\"text-center space-y-4 p-8\">\n              <div className=\"flex justify-center\">\n                <div className=\"flex h-24 w-24 items-center justify-center rounded-2xl bg-primary/10\">\n                  <Truck className=\"h-12 w-12 text-primary\" />\n                </div>\n              </div>\n              <div>\n                <CardTitle className=\"text-2xl\">Veículos</CardTitle>\n                <CardDescription className=\"mt-2\">\n                  Registrar entrada e saída de veículos\n                </CardDescription>\n              </div>\n            </CardHeader>\n            <CardContent className=\"text-center pb-8\">\n              <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                <div>\n                  <p className=\"text-muted-foreground\">Ativos</p>\n                  <p className=\"text-2xl font-bold text-foreground\">{veiculosAtivos?.length || 0}</p>\n                </div>\n                <div>\n                  <p className=\"text-muted-foreground\">Hoje</p>\n                  <p className=\"text-2xl font-bold text-foreground\">{veiculosHoje?.length || 0}</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Visitantes Card */}\n          <Card\n            className=\"cursor-pointer transition-all hover-elevate active-elevate-2 border-2\"\n            onClick={() => setLocation(\"/visitantes\")}\n            data-testid=\"card-select-visitante\"\n          >\n            <CardHeader className=\"text-center space-y-4 p-8\">\n              <div className=\"flex justify-center\">\n                <div className=\"flex h-24 w-24 items-center justify-center rounded-2xl bg-emerald-500/10\">\n                  <UserCheck className=\"h-12 w-12 text-emerald-600\" />\n                </div>\n              </div>\n              <div>\n                <CardTitle className=\"text-2xl\">Visitantes</CardTitle>\n                <CardDescription className=\"mt-2\">\n                  Gerenciar visitantes e prestadores\n                </CardDescription>\n              </div>\n            </CardHeader>\n            <CardContent className=\"text-center pb-8\">\n              <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                <div>\n                  <p className=\"text-muted-foreground\">Aguardando</p>\n                  <p className=\"text-2xl font-bold text-amber-600\">{visitantesAguardando}</p>\n                </div>\n                <div>\n                  <p className=\"text-muted-foreground\">Aprovados</p>\n                  <p className=\"text-2xl font-bold text-emerald-600\">{visitantesAprovados}</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Quick Stats */}\n        <div className=\"grid grid-cols-2 md:grid-cols-2 gap-3 md:gap-4 max-w-2xl mx-auto mt-8\">\n          <Card>\n            <CardHeader className=\"p-4 md:pb-2\">\n              <CardDescription className=\"text-xs md:text-sm\">Vagas Livres</CardDescription>\n              <CardTitle className=\"text-2xl md:text-3xl text-emerald-600\">{vagasLivres}</CardTitle>\n            </CardHeader>\n          </Card>\n          <Card>\n            <CardHeader className=\"p-4 md:pb-2\">\n              <CardDescription className=\"text-xs md:text-sm\">Vagas Ocupadas</CardDescription>\n              <CardTitle className=\"text-2xl md:text-3xl text-rose-600\">{vagasOcupadas}</CardTitle>\n            </CardHeader>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  // Veículos View\n  return (\n    <div className=\"p-4 md:p-6 space-y-4 md:space-y-6 max-w-7xl mx-auto\">\n      {/* Header with Back Button */}\n      <div className=\"flex items-center gap-4\">\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          onClick={() => setOperationMode(\"selection\")}\n          data-testid=\"button-back-to-selection\"\n        >\n          <ArrowLeft className=\"h-5 w-5\" />\n        </Button>\n        <div>\n          <h1 className=\"text-2xl md:text-3xl font-bold text-foreground\">Controle de Veículos</h1>\n          <p className=\"text-sm md:text-base text-muted-foreground\">Gerencie entrada e saída de veículos</p>\n        </div>\n      </div>\n\n      {/* Stats */}\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4\">\n        <Card>\n          <CardHeader className=\"p-4 md:pb-2\">\n            <CardDescription className=\"text-xs md:text-sm\">Veículos Ativos</CardDescription>\n            <CardTitle className=\"text-2xl md:text-3xl\">{veiculosAtivos?.length || 0}</CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"p-4 md:pb-2\">\n            <CardDescription className=\"text-xs md:text-sm\">Entradas Hoje</CardDescription>\n            <CardTitle className=\"text-2xl md:text-3xl\">{veiculosHoje?.length || 0}</CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"p-4 md:pb-2\">\n            <CardDescription className=\"text-xs md:text-sm\">Vagas Livres</CardDescription>\n            <CardTitle className=\"text-2xl md:text-3xl text-emerald-600\">{vagasLivres}</CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"p-4 md:pb-2\">\n            <CardDescription className=\"text-xs md:text-sm\">Vagas Ocupadas</CardDescription>\n            <CardTitle className=\"text-2xl md:text-3xl text-rose-600\">{vagasOcupadas}</CardTitle>\n          </CardHeader>\n        </Card>\n      </div>\n\n      {/* Main Content */}\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList>\n          <TabsTrigger value=\"entrada\" data-testid=\"tab-entrada\">\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Nova Entrada\n          </TabsTrigger>\n          <TabsTrigger value=\"saida\" data-testid=\"tab-saida\">\n            <LogOut className=\"h-4 w-4 mr-2\" />\n            Saída\n          </TabsTrigger>\n          <TabsTrigger value=\"historico\" data-testid=\"tab-historico\">\n            <Clock className=\"h-4 w-4 mr-2\" />\n            Histórico Hoje\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"entrada\" className=\"mt-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Registrar Entrada de Veículo</CardTitle>\n              <CardDescription>Preencha os dados do veículo e motorista</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <form onSubmit={handleSubmit} className=\"space-y-6\">\n                {/* Tipo de Veículo */}\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"tipoVeiculoCategoria\">Tipo de Veículo *</Label>\n                  <Select\n                    value={formData.tipoVeiculoCategoria}\n                    onValueChange={(value: any) => setFormData({ ...formData, tipoVeiculoCategoria: value })}\n                  >\n                    <SelectTrigger id=\"tipoVeiculoCategoria\" data-testid=\"select-tipo-veiculo\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"carro\">Carro</SelectItem>\n                      <SelectItem value=\"moto\">Moto</SelectItem>\n                      <SelectItem value=\"cavalo\">Cavalo (sem carreta)</SelectItem>\n                      <SelectItem value=\"cavalo_carreta\">Cavalo + Carreta</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                {/* Data e Hora de Entrada (Fixada) */}\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"dataHoraEntrada\">Data e Hora de Entrada</Label>\n                  <Input\n                    id=\"dataHoraEntrada\"\n                    data-testid=\"input-data-hora-entrada\"\n                    value={format(new Date(), \"dd/MM/yyyy HH:mm\")}\n                    readOnly\n                    className=\"bg-muted cursor-not-allowed\"\n                  />\n                </div>\n\n                {/* For Cavalo/Cavalo+Carreta - Show Proprietário and Status Carga */}\n                {!isVeiculoLeve && (\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"tipoProprietario\">Proprietário *</Label>\n                      <Select\n                        value={formData.tipoProprietario}\n                        onValueChange={(value: any) => setFormData({ ...formData, tipoProprietario: value })}\n                      >\n                        <SelectTrigger id=\"tipoProprietario\" data-testid=\"select-tipo-proprietario\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"terceiro\">Terceiro</SelectItem>\n                          <SelectItem value=\"agregado\">Agregado</SelectItem>\n                          <SelectItem value=\"frota\">Frota</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"statusCarga\">Status da Carga</Label>\n                      <Select\n                        value={formData.statusCarga || undefined}\n                        onValueChange={(value: any) => setFormData({ ...formData, statusCarga: value || \"\" })}\n                      >\n                        <SelectTrigger id=\"statusCarga\" data-testid=\"select-status-carga\">\n                          <SelectValue placeholder=\"Não informado\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"carregado\">Carregado</SelectItem>\n                          <SelectItem value=\"descarregado\">Descarregado</SelectItem>\n                          <SelectItem value=\"pernoite\">Pernoite</SelectItem>\n                          <SelectItem value=\"manutencao\">Manutenção</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                  </div>\n                )}\n\n                {/* For Carro/Moto - Show Visitante/Funcionário */}\n                {isVeiculoLeve && (\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"tipoMotorista\">Tipo *</Label>\n                    <Select\n                      value={formData.tipoMotorista}\n                      onValueChange={(value: any) => setFormData({ ...formData, tipoMotorista: value })}\n                    >\n                      <SelectTrigger id=\"tipoMotorista\" data-testid=\"select-tipo-motorista\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"visitante\">Visitante</SelectItem>\n                        <SelectItem value=\"funcionario\">Funcionário</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                )}\n\n                {/* Dados do Veículo */}\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"placaCavalo\">\n                      Placa {formData.tipoVeiculoCategoria === \"carro\" ? \"Carro\" : formData.tipoVeiculoCategoria === \"moto\" ? \"Moto\" : \"Cavalo\"} *\n                    </Label>\n                    <Input\n                      id=\"placaCavalo\"\n                      data-testid=\"input-placa-cavalo\"\n                      placeholder=\"ABC-1234\"\n                      value={formData.placaCavalo}\n                      onChange={(e) => setFormData({ ...formData, placaCavalo: e.target.value.toUpperCase() })}\n                      required\n                    />\n                  </div>\n                  {formData.tipoVeiculoCategoria === \"cavalo_carreta\" && (\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"placaCarreta\">Placa Carreta</Label>\n                      <Input\n                        id=\"placaCarreta\"\n                        data-testid=\"input-placa-carreta\"\n                        placeholder=\"DEF-5678\"\n                        value={formData.placaCarreta}\n                        onChange={(e) => setFormData({ ...formData, placaCarreta: e.target.value.toUpperCase() })}\n                      />\n                    </div>\n                  )}\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"motorista\">Motorista *</Label>\n                    <Input\n                      id=\"motorista\"\n                      data-testid=\"input-motorista\"\n                      placeholder=\"Nome do motorista\"\n                      value={formData.motorista}\n                      onChange={(e) => setFormData({ ...formData, motorista: e.target.value })}\n                      required\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"cpfMotorista\">CPF Motorista {!isVeiculoLeve && \"*\"}</Label>\n                    <Input\n                      id=\"cpfMotorista\"\n                      data-testid=\"input-cpf-motorista\"\n                      placeholder=\"000.000.000-00\"\n                      value={formData.cpfMotorista}\n                      onChange={(e) => setFormData({ ...formData, cpfMotorista: e.target.value })}\n                      required={!isVeiculoLeve}\n                    />\n                  </div>\n                  \n                  {/* Only for Cavalo/Cavalo+Carreta */}\n                  {!isVeiculoLeve && (\n                    <>\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"transportadora\">Transportadora</Label>\n                        <Input\n                          id=\"transportadora\"\n                          data-testid=\"input-transportadora\"\n                          placeholder=\"Nome da transportadora\"\n                          value={formData.transportadora}\n                          onChange={(e) => setFormData({ ...formData, transportadora: e.target.value })}\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"cliente\">Cliente</Label>\n                        <Input\n                          id=\"cliente\"\n                          data-testid=\"input-cliente\"\n                          placeholder=\"Nome do cliente\"\n                          value={formData.cliente}\n                          onChange={(e) => setFormData({ ...formData, cliente: e.target.value })}\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"doca\">Doca</Label>\n                        <Input\n                          id=\"doca\"\n                          data-testid=\"input-doca\"\n                          placeholder=\"Número da doca\"\n                          value={formData.doca}\n                          onChange={(e) => setFormData({ ...formData, doca: e.target.value })}\n                        />\n                      </div>\n                    </>\n                  )}\n                  \n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"vagaId\">Vaga</Label>\n                    <Select\n                      value={formData.vagaId}\n                      onValueChange={(value) => setFormData({ ...formData, vagaId: value })}\n                    >\n                      <SelectTrigger id=\"vagaId\" data-testid=\"select-vaga\">\n                        <SelectValue placeholder=\"Selecione uma vaga\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {vagas?.filter(v => v.status === \"livre\").map((vaga) => (\n                          <SelectItem key={vaga.id} value={vaga.id}>\n                            Vaga {vaga.numero}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  \n                  {/* Only for Cavalo/Cavalo+Carreta */}\n                  {!isVeiculoLeve && (\n                    <>\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"valor\">Valor (R$)</Label>\n                        <Input\n                          id=\"valor\"\n                          data-testid=\"input-valor\"\n                          type=\"number\"\n                          step=\"0.01\"\n                          min=\"0\"\n                          placeholder=\"0.00\"\n                          value={formData.valor}\n                          onChange={(e) => setFormData({ ...formData, valor: e.target.value })}\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"cte\">CTE</Label>\n                        <Input\n                          id=\"cte\"\n                          data-testid=\"input-cte\"\n                          placeholder=\"Número do CTE\"\n                          value={formData.cte}\n                          onChange={(e) => setFormData({ ...formData, cte: e.target.value })}\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"nf\">NF (Nota Fiscal)</Label>\n                        <Input\n                          id=\"nf\"\n                          data-testid=\"input-nf\"\n                          placeholder=\"Número da NF\"\n                          value={formData.nf}\n                          onChange={(e) => setFormData({ ...formData, nf: e.target.value })}\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"lacre\">Lacre</Label>\n                        <Input\n                          id=\"lacre\"\n                          data-testid=\"input-lacre\"\n                          placeholder=\"Número do Lacre\"\n                          value={formData.lacre}\n                          onChange={(e) => setFormData({ ...formData, lacre: e.target.value })}\n                        />\n                      </div>\n                      <div className=\"space-y-2 flex items-end\">\n                        <label className=\"flex items-center space-x-2 cursor-pointer\">\n                          <input\n                            type=\"checkbox\"\n                            id=\"multi\"\n                            data-testid=\"checkbox-multi\"\n                            checked={formData.multi}\n                            onChange={(e) => setFormData({ ...formData, multi: e.target.checked })}\n                            className=\"h-4 w-4 rounded border-input\"\n                          />\n                          <Label htmlFor=\"multi\" className=\"cursor-pointer\">Multi</Label>\n                        </label>\n                      </div>\n                    </>\n                  )}\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"observacoes\">Observações</Label>\n                  <Textarea\n                    id=\"observacoes\"\n                    data-testid=\"textarea-observacoes\"\n                    placeholder=\"Informações adicionais...\"\n                    value={formData.observacoes}\n                    onChange={(e) => setFormData({ ...formData, observacoes: e.target.value })}\n                    rows={3}\n                  />\n                </div>\n                <div className=\"flex justify-end gap-2\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => setFormData({\n                      tipoVeiculoCategoria: \"cavalo_carreta\",\n                      tipoProprietario: \"terceiro\",\n                      statusCarga: \"\",\n                      tipoMotorista: \"visitante\",\n                      placaCavalo: \"\",\n                      placaCarreta: \"\",\n                      motorista: \"\",\n                      cpfMotorista: \"\",\n                      transportadora: \"\",\n                      cliente: \"\",\n                      doca: \"\",\n                      vagaId: \"\",\n                      multi: false,\n                      valor: \"\",\n                      cte: \"\",\n                      nf: \"\",\n                      lacre: \"\",\n                      observacoes: \"\",\n                    })}\n                    data-testid=\"button-limpar\"\n                  >\n                    Limpar\n                  </Button>\n                  <Button\n                    type=\"submit\"\n                    disabled={createVeiculoMutation.isPending}\n                    data-testid=\"button-registrar-entrada\"\n                  >\n                    {createVeiculoMutation.isPending ? (\n                      <>\n                        <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                        Registrando...\n                      </>\n                    ) : (\n                      <>\n                        <Truck className=\"mr-2 h-4 w-4\" />\n                        Registrar Entrada\n                      </>\n                    )}\n                  </Button>\n                </div>\n              </form>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"saida\" className=\"mt-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Veículos no Pátio</CardTitle>\n              <CardDescription>Selecione um veículo para registrar saída</CardDescription>\n            </CardHeader>\n            <CardContent>\n              {loadingVeiculos ? (\n                <div className=\"flex justify-center py-8\">\n                  <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n                </div>\n              ) : veiculosAtivos && veiculosAtivos.length > 0 ? (\n                <div className=\"space-y-2\">\n                  {veiculosAtivos.map((veiculo) => (\n                    <div\n                      key={veiculo.id}\n                      className=\"flex items-center justify-between p-4 border rounded-lg hover-elevate\"\n                      data-testid={`veiculo-${veiculo.placaCavalo}`}\n                    >\n                      <div className=\"flex-1 space-y-1\">\n                        <div className=\"flex items-center gap-2\">\n                          <Truck className=\"h-4 w-4 text-muted-foreground\" />\n                          <span className=\"font-medium\" data-testid={`text-placa-${veiculo.placaCavalo}`}>{veiculo.placaCavalo}</span>\n                          {veiculo.placaCarreta && (\n                            <span className=\"text-sm text-muted-foreground\">+ {veiculo.placaCarreta}</span>\n                          )}\n                        </div>\n                        <div className=\"text-sm text-muted-foreground\">\n                          Motorista: {veiculo.motorista}\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <StatusBadge status={veiculo.situacao} type=\"veiculo\" />\n                          <span className=\"text-xs text-muted-foreground\">\n                            Entrada: {format(new Date(veiculo.dataEntrada), \"dd/MM/yyyy HH:mm\", { locale: ptBR })}\n                          </span>\n                        </div>\n                      </div>\n                      <Button\n                        onClick={() => handleAbrirSaida(veiculo)}\n                        disabled={registrarSaidaMutation.isPending}\n                        data-testid={`button-saida-${veiculo.placaCavalo}`}\n                      >\n                        <LogOut className=\"mr-2 h-4 w-4\" />\n                        Registrar Saída\n                      </Button>\n                    </div>\n                  ))}\n                </div>\n              ) : (\n                <div className=\"text-center py-8\">\n                  <Truck className=\"h-12 w-12 text-muted-foreground mx-auto mb-4 opacity-50\" />\n                  <p className=\"text-muted-foreground\">Nenhum veículo no pátio</p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"historico\" className=\"mt-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Movimentações de Hoje</CardTitle>\n              <CardDescription>Histórico de entradas e saídas do dia</CardDescription>\n            </CardHeader>\n            <CardContent>\n              {loadingVeiculos ? (\n                <div className=\"flex justify-center py-8\">\n                  <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n                </div>\n              ) : veiculosHoje && veiculosHoje.length > 0 ? (\n                <div className=\"space-y-2\">\n                  {veiculosHoje.map((veiculo) => (\n                    <div\n                      key={veiculo.id}\n                      className=\"p-4 border rounded-lg\"\n                      data-testid={`historico-${veiculo.placaCavalo}`}\n                    >\n                      <div className=\"flex items-start justify-between\">\n                        <div className=\"space-y-1\">\n                          <div className=\"flex items-center gap-2\">\n                            <Truck className=\"h-4 w-4 text-muted-foreground\" />\n                            <span className=\"font-medium\" data-testid={`text-placa-${veiculo.placaCavalo}`}>{veiculo.placaCavalo}</span>\n                            {veiculo.placaCarreta && (\n                              <span className=\"text-sm text-muted-foreground\">+ {veiculo.placaCarreta}</span>\n                            )}\n                          </div>\n                          <div className=\"text-sm text-muted-foreground\">\n                            Motorista: {veiculo.motorista}\n                          </div>\n                          {veiculo.transportadora && (\n                            <div className=\"text-sm text-muted-foreground\">\n                              Transportadora: {veiculo.transportadora}\n                            </div>\n                          )}\n                          <div className=\"flex items-center gap-2 mt-2\">\n                            <StatusBadge status={veiculo.situacao} type=\"veiculo\" />\n                          </div>\n                        </div>\n                        <div className=\"text-right text-sm text-muted-foreground\">\n                          <div>Entrada: {format(new Date(veiculo.dataEntrada), \"HH:mm\", { locale: ptBR })}</div>\n                          {veiculo.dataSaida && (\n                            <div>Saída: {format(new Date(veiculo.dataSaida), \"HH:mm\", { locale: ptBR })}</div>\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              ) : (\n                <div className=\"text-center py-8\">\n                  <Clock className=\"h-12 w-12 text-muted-foreground mx-auto mb-4 opacity-50\" />\n                  <p className=\"text-muted-foreground\">Nenhuma movimentação hoje</p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n\n      {/* Dialog de Saída com CTE, NF, LACRE */}\n      <Dialog open={saidaDialogOpen} onOpenChange={setSaidaDialogOpen}>\n        <DialogContent data-testid=\"dialog-saida-veiculo\">\n          <DialogHeader>\n            <DialogTitle>Registrar Saída de Veículo</DialogTitle>\n            <DialogDescription>\n              Confirme ou atualize os dados antes de finalizar a saída\n            </DialogDescription>\n          </DialogHeader>\n          {veiculoSaida && (\n            <div className=\"space-y-4\">\n              {/* Informações do Veículo */}\n              <div className=\"p-4 bg-muted rounded-lg space-y-2\">\n                <div className=\"flex items-center gap-2\">\n                  <Truck className=\"h-4 w-4 text-muted-foreground\" />\n                  <span className=\"font-medium\">{veiculoSaida.placaCavalo}</span>\n                  {veiculoSaida.placaCarreta && (\n                    <span className=\"text-sm text-muted-foreground\">+ {veiculoSaida.placaCarreta}</span>\n                  )}\n                </div>\n                <div className=\"text-sm text-muted-foreground\">\n                  Motorista: {veiculoSaida.motorista}\n                </div>\n                {veiculoSaida.transportadora && (\n                  <div className=\"text-sm text-muted-foreground\">\n                    Transportadora: {veiculoSaida.transportadora}\n                  </div>\n                )}\n              </div>\n\n              {/* Data e Hora de Saída (Fixada) */}\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"dataHoraSaida\">Data e Hora de Saída</Label>\n                <Input\n                  id=\"dataHoraSaida\"\n                  data-testid=\"input-data-hora-saida\"\n                  value={format(new Date(), \"dd/MM/yyyy HH:mm\")}\n                  readOnly\n                  className=\"bg-muted cursor-not-allowed\"\n                />\n              </div>\n\n              {/* CTE, NF, LACRE */}\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"cte-saida\">CTE</Label>\n                  <Input\n                    id=\"cte-saida\"\n                    data-testid=\"input-cte-saida\"\n                    placeholder=\"CTE\"\n                    value={saidaData.cte}\n                    onChange={(e) => setSaidaData({ ...saidaData, cte: e.target.value })}\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"nf-saida\">NF</Label>\n                  <Input\n                    id=\"nf-saida\"\n                    data-testid=\"input-nf-saida\"\n                    placeholder=\"Nota Fiscal\"\n                    value={saidaData.nf}\n                    onChange={(e) => setSaidaData({ ...saidaData, nf: e.target.value })}\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"lacre-saida\">Lacre</Label>\n                  <Input\n                    id=\"lacre-saida\"\n                    data-testid=\"input-lacre-saida\"\n                    placeholder=\"Lacre\"\n                    value={saidaData.lacre}\n                    onChange={(e) => setSaidaData({ ...saidaData, lacre: e.target.value })}\n                  />\n                </div>\n              </div>\n            </div>\n          )}\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => setSaidaDialogOpen(false)}\n              data-testid=\"button-cancelar-saida\"\n            >\n              Cancelar\n            </Button>\n            <Button\n              onClick={handleConfirmarSaida}\n              disabled={registrarSaidaMutation.isPending}\n              data-testid=\"button-confirmar-saida\"\n            >\n              {registrarSaidaMutation.isPending ? (\n                <>\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  Registrando...\n                </>\n              ) : (\n                <>\n                  <LogOut className=\"mr-2 h-4 w-4\" />\n                  Confirmar Saída\n                </>\n              )}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":40352},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","size_bytes":1904},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\n// Token management\nconst TOKEN_KEY = \"access_token\";\nconst REFRESH_TOKEN_KEY = \"refresh_token\";\n\nexport function getAccessToken(): string | null {\n  return localStorage.getItem(TOKEN_KEY);\n}\n\nexport function getRefreshToken(): string | null {\n  return localStorage.getItem(REFRESH_TOKEN_KEY);\n}\n\nexport function setTokens(accessToken: string, refreshToken: string) {\n  localStorage.setItem(TOKEN_KEY, accessToken);\n  localStorage.setItem(REFRESH_TOKEN_KEY, refreshToken);\n}\n\nexport function clearTokens() {\n  localStorage.removeItem(TOKEN_KEY);\n  localStorage.removeItem(REFRESH_TOKEN_KEY);\n  localStorage.removeItem(\"selected_filial\");\n}\n\n// Refresh token logic\nlet isRefreshing = false;\nlet refreshPromise: Promise<string> | null = null;\n\nasync function refreshAccessToken(): Promise<string> {\n  if (isRefreshing && refreshPromise) {\n    return refreshPromise;\n  }\n\n  isRefreshing = true;\n  refreshPromise = (async () => {\n    try {\n      const refreshToken = getRefreshToken();\n      if (!refreshToken) {\n        throw new Error(\"No refresh token available\");\n      }\n\n      const res = await fetch(\"/api/refresh\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ refreshToken }),\n      });\n\n      if (!res.ok) {\n        clearTokens();\n        throw new Error(\"Failed to refresh token\");\n      }\n\n      const data = await res.json();\n      localStorage.setItem(TOKEN_KEY, data.accessToken);\n      return data.accessToken;\n    } finally {\n      isRefreshing = false;\n      refreshPromise = null;\n    }\n  })();\n\n  return refreshPromise;\n}\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    let errorMessage = res.statusText;\n    try {\n      const data = await res.json();\n      errorMessage = data.error || data.message || errorMessage;\n    } catch {\n      const text = await res.text();\n      if (text) errorMessage = text;\n    }\n    throw new Error(`${res.status}: ${errorMessage}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n  retryOnce = true,\n): Promise<Response> {\n  const token = getAccessToken();\n  const headers: Record<string, string> = {};\n  \n  if (token) {\n    headers[\"Authorization\"] = `Bearer ${token}`;\n  }\n  \n  if (data) {\n    headers[\"Content-Type\"] = \"application/json\";\n  }\n\n  // Add X-Filial header if a filial is selected\n  const selectedFilial = localStorage.getItem(\"selected_filial\");\n  if (selectedFilial) {\n    headers[\"X-Filial\"] = selectedFilial;\n  }\n\n  const res = await fetch(url, {\n    method,\n    headers,\n    body: data ? JSON.stringify(data) : undefined,\n  });\n\n  // If 401 and we have a refresh token, try to refresh and retry once\n  if (res.status === 401 && retryOnce && getRefreshToken()) {\n    try {\n      const newToken = await refreshAccessToken();\n      headers[\"Authorization\"] = `Bearer ${newToken}`;\n      \n      const retryRes = await fetch(url, {\n        method,\n        headers,\n        body: data ? JSON.stringify(data) : undefined,\n      });\n      \n      await throwIfResNotOk(retryRes);\n      return retryRes;\n    } catch (error) {\n      clearTokens();\n      window.location.href = \"/auth\";\n      throw error;\n    }\n  }\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    try {\n      const token = getAccessToken();\n      const headers: Record<string, string> = {};\n      \n      if (token) {\n        headers[\"Authorization\"] = `Bearer ${token}`;\n      }\n\n      // Add X-Filial header if a filial is selected\n      const selectedFilial = localStorage.getItem(\"selected_filial\");\n      if (selectedFilial) {\n        headers[\"X-Filial\"] = selectedFilial;\n      }\n\n      const res = await fetch(queryKey.join(\"/\") as string, { headers });\n\n      if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n        return null;\n      }\n\n      // If 401 and we have a refresh token, try to refresh and retry once\n      if (res.status === 401 && getRefreshToken()) {\n        try {\n          const newToken = await refreshAccessToken();\n          headers[\"Authorization\"] = `Bearer ${newToken}`;\n          \n          const retryRes = await fetch(queryKey.join(\"/\") as string, { headers });\n          \n          if (unauthorizedBehavior === \"returnNull\" && retryRes.status === 401) {\n            return null;\n          }\n          \n          await throwIfResNotOk(retryRes);\n          return await retryRes.json();\n        } catch (error) {\n          if (unauthorizedBehavior === \"returnNull\") {\n            clearTokens();\n            return null;\n          }\n          throw error;\n        }\n      }\n\n      await throwIfResNotOk(res);\n      return await res.json();\n    } catch (error) {\n      if (unauthorizedBehavior === \"returnNull\") {\n        return null;\n      }\n      throw error;\n    }\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":5381},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"server/seed.ts":{"content":"import { db } from \"./db\";\nimport { filiais, users, vagas, userPermissions } from \"@shared/schema\";\nimport { hashPassword } from \"./auth\";\nimport { eq, and } from \"drizzle-orm\";\n\nasync function seed() {\n  console.log(\"🌱 Iniciando seed do banco de dados...\");\n\n  // Create or update filiais\n  console.log(\"Criando/atualizando filiais...\");\n  const filiaisData = [\n    {\n      nome: \"Filial Guarulhos\",\n      codigo: \"guarulhos\",\n      endereco: \"Av. Presidente Juscelino K. de Oliveira, 5000 - Guarulhos/SP\",\n      ativo: true,\n    },\n    {\n      nome: \"Filial Araraquara\",\n      codigo: \"araraquara\",\n      endereco: \"Rodovia Washington Luís, Km 235 - Araraquara/SP\",\n      ativo: true,\n    },\n    {\n      nome: \"Filial Costeira\",\n      codigo: \"costeira\",\n      endereco: \"Via Anchieta, Km 18 - São Bernardo do Campo/SP\",\n      ativo: true,\n    },\n  ];\n\n  const createdFiliais = [];\n  for (const filialData of filiaisData) {\n    const [existing] = await db.select().from(filiais).where(eq(filiais.codigo, filialData.codigo));\n    \n    if (existing) {\n      console.log(`✓ Filial ${filialData.nome} já existe`);\n      createdFiliais.push(existing);\n    } else {\n      const [f] = await db.insert(filiais).values(filialData).returning();\n      createdFiliais.push(f);\n      console.log(`✓ Filial ${f.nome} criada`);\n    }\n  }\n\n  // Create or update users\n  console.log(\"Criando/atualizando usuários...\");\n  \n  const usersData = [\n    {\n      username: \"admin\",\n      email: \"admin@retropatio.com\",\n      password: await hashPassword(\"admin123\"),\n      nome: \"Administrador\",\n      role: \"gestor\" as const,\n      ativo: true,\n    },\n    {\n      username: \"porteiro\",\n      email: \"porteiro@retropatio.com\",\n      password: await hashPassword(\"porteiro123\"),\n      nome: \"João Silva - Porteiro\",\n      role: \"porteiro\" as const,\n      ativo: true,\n    },\n    {\n      username: \"cliente\",\n      email: \"cliente@retropatio.com\",\n      password: await hashPassword(\"cliente123\"),\n      nome: \"Maria Santos - Cliente\",\n      role: \"cliente\" as const,\n      ativo: true,\n    },\n  ];\n\n  const createdUsers = [];\n  for (const userData of usersData) {\n    const [existing] = await db.select().from(users).where(eq(users.username, userData.username));\n    \n    if (existing) {\n      console.log(`✓ Usuário ${userData.username} já existe`);\n      createdUsers.push(existing);\n    } else {\n      const [u] = await db.insert(users).values(userData).returning();\n      createdUsers.push(u);\n      console.log(`✓ Usuário ${userData.username} criado (password: ${userData.username}123)`);\n    }\n  }\n\n  // Create user permissions - associate users with all filiais\n  console.log(\"Criando permissões de usuário por filial...\");\n  for (const user of createdUsers) {\n    for (const filial of createdFiliais) {\n      const [existing] = await db.select().from(userPermissions)\n        .where(and(\n          eq(userPermissions.userId, user.id),\n          eq(userPermissions.filialId, filial.id)\n        ));\n      \n      if (!existing) {\n        await db.insert(userPermissions).values({\n          userId: user.id,\n          filialId: filial.id,\n        });\n        console.log(`✓ Permissão criada: ${user.username} → ${filial.codigo}`);\n      } else {\n        console.log(`✓ Permissão já existe: ${user.username} → ${filial.codigo}`);\n      }\n    }\n  }\n\n  // Create vagas for each filial if they don't exist\n  console.log(\"Criando vagas...\");\n  for (const filial of createdFiliais) {\n    const existingVagas = await db.select().from(vagas).where(eq(vagas.filialId, filial.id));\n    \n    if (existingVagas.length > 0) {\n      console.log(`✓ Filial ${filial.nome} já tem ${existingVagas.length} vagas`);\n    } else {\n      for (let i = 1; i <= 20; i++) {\n        await db.insert(vagas).values({\n          filialId: filial.id,\n          numero: `V${i.toString().padStart(3, '0')}`,\n          status: \"livre\",\n          descricao: `Vaga ${i} - ${filial.nome}`,\n        });\n      }\n      console.log(`✓ 20 vagas criadas para ${filial.nome}`);\n    }\n  }\n\n  console.log(\"✅ Seed concluído com sucesso!\");\n  console.log(\"\\n📋 Credenciais de acesso:\");\n  console.log(\"   Admin: username=admin, password=admin123\");\n  console.log(\"   Porteiro: username=porteiro, password=porteiro123\");\n  console.log(\"   Cliente: username=cliente, password=cliente123\");\n}\n\nseed()\n  .then(() => process.exit(0))\n  .catch((error) => {\n    console.error(\"❌ Erro ao executar seed:\", error);\n    process.exit(1);\n  });\n","size_bytes":4507},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\n\ndeclare module 'http' {\n  interface IncomingMessage {\n    rawBody: unknown\n  }\n}\napp.use(express.json({\n  verify: (req, _res, buf) => {\n    req.rawBody = buf;\n  }\n}));\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"…\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","size_bytes":2210},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/pages/auditoria-page.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { FileText, Loader2, Shield } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { ptBR } from \"date-fns/locale\";\nimport type { AuditLog } from \"@shared/schema\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\n\nexport default function AuditoriaPage() {\n  const [filters, setFilters] = useState({\n    dataInicio: \"\",\n    dataFim: \"\",\n    acao: \"\",\n    entidade: \"\",\n  });\n\n  const { data: auditLogs, isLoading } = useQuery<AuditLog[]>({\n    queryKey: [\"/api/audit-logs\"],\n  });\n\n  const filteredLogs = auditLogs?.filter((log) => {\n    if (filters.dataInicio && new Date(log.createdAt) < new Date(filters.dataInicio)) return false;\n    if (filters.dataFim && new Date(log.createdAt) > new Date(filters.dataFim)) return false;\n    if (filters.acao && !log.acao.toLowerCase().includes(filters.acao.toLowerCase())) return false;\n    if (filters.entidade && log.entidade !== filters.entidade) return false;\n    return true;\n  });\n\n  const entidades = Array.from(new Set(auditLogs?.map((log) => log.entidade) || []));\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Header */}\n      <div>\n        <h1 className=\"text-3xl font-bold text-foreground\">Auditoria</h1>\n        <p className=\"text-muted-foreground\">Visualize o histórico de ações no sistema</p>\n      </div>\n\n      {/* Stats */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Total de Eventos</CardDescription>\n            <CardTitle className=\"text-3xl\">{auditLogs?.length || 0}</CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Eventos Filtrados</CardDescription>\n            <CardTitle className=\"text-3xl\">{filteredLogs?.length || 0}</CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Entidades Monitoradas</CardDescription>\n            <CardTitle className=\"text-3xl\">{entidades.length}</CardTitle>\n          </CardHeader>\n        </Card>\n      </div>\n\n      {/* Filters */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Filtros</CardTitle>\n          <CardDescription>Refine sua busca</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"dataInicio\">Data Início</Label>\n              <Input\n                id=\"dataInicio\"\n                type=\"date\"\n                data-testid=\"input-data-inicio\"\n                value={filters.dataInicio}\n                onChange={(e) => setFilters({ ...filters, dataInicio: e.target.value })}\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"dataFim\">Data Fim</Label>\n              <Input\n                id=\"dataFim\"\n                type=\"date\"\n                data-testid=\"input-data-fim\"\n                value={filters.dataFim}\n                onChange={(e) => setFilters({ ...filters, dataFim: e.target.value })}\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"entidade\">Entidade</Label>\n              <Select\n                value={filters.entidade}\n                onValueChange={(value) => setFilters({ ...filters, entidade: value })}\n              >\n                <SelectTrigger id=\"entidade\" data-testid=\"select-entidade\">\n                  <SelectValue placeholder=\"Todas\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"\">Todas</SelectItem>\n                  {entidades.map((entidade) => (\n                    <SelectItem key={entidade} value={entidade}>\n                      {entidade}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"acao\">Ação</Label>\n              <Input\n                id=\"acao\"\n                placeholder=\"Filtrar por ação\"\n                data-testid=\"input-acao\"\n                value={filters.acao}\n                onChange={(e) => setFilters({ ...filters, acao: e.target.value })}\n              />\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Logs List */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Histórico de Eventos</CardTitle>\n          <CardDescription>{filteredLogs?.length || 0} eventos encontrados</CardDescription>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"flex justify-center py-8\">\n              <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n            </div>\n          ) : filteredLogs && filteredLogs.length > 0 ? (\n            <div className=\"space-y-2\">\n              {filteredLogs.map((log) => (\n                <div\n                  key={log.id}\n                  className=\"p-4 border rounded-lg hover-elevate\"\n                  data-testid={`audit-log-${log.id}`}\n                >\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"flex-1 space-y-1\">\n                      <div className=\"flex items-center gap-2\">\n                        <Shield className=\"h-4 w-4 text-muted-foreground\" />\n                        <span className=\"font-medium\">{log.acao}</span>\n                        <Badge variant=\"outline\" className=\"text-xs\">{log.entidade}</Badge>\n                      </div>\n                      {log.ipAddress && (\n                        <div className=\"text-xs text-muted-foreground\">\n                          IP: {log.ipAddress}\n                        </div>\n                      )}\n                      {log.dadosAntes && log.dadosDepois && (\n                        <div className=\"mt-2 p-2 bg-muted rounded text-xs space-y-1\">\n                          <div className=\"text-muted-foreground\">\n                            Antes: {log.dadosAntes}\n                          </div>\n                          <div className=\"text-muted-foreground\">\n                            Depois: {log.dadosDepois}\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                    <div className=\"text-right text-sm text-muted-foreground\">\n                      <div>{format(new Date(log.createdAt), \"dd/MM/yyyy\", { locale: ptBR })}</div>\n                      <div className=\"text-xs\">{format(new Date(log.createdAt), \"HH:mm:ss\", { locale: ptBR })}</div>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <div className=\"text-center py-8\">\n              <FileText className=\"h-12 w-12 text-muted-foreground mx-auto mb-4 opacity-50\" />\n              <p className=\"text-muted-foreground\">Nenhum evento encontrado</p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":7477},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":2359},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/theme-toggle.tsx":{"content":"import { Moon, Sun } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useTheme } from \"./theme-provider\";\n\nexport function ThemeToggle() {\n  const { theme, toggleTheme } = useTheme();\n\n  return (\n    <Button\n      variant=\"ghost\"\n      size=\"icon\"\n      onClick={toggleTheme}\n      data-testid=\"button-theme-toggle\"\n      className=\"h-9 w-9\"\n    >\n      {theme === \"light\" ? (\n        <Moon className=\"h-4 w-4\" />\n      ) : (\n        <Sun className=\"h-4 w-4\" />\n      )}\n      <span className=\"sr-only\">Toggle theme</span>\n    </Button>\n  );\n}\n","size_bytes":574},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"client/src/hooks/use-auth.tsx":{"content":"import { createContext, ReactNode, useContext } from \"react\";\nimport {\n  useQuery,\n  useMutation,\n  UseMutationResult,\n} from \"@tanstack/react-query\";\nimport type { User as SelectUser } from \"@shared/schema\";\nimport { getQueryFn, apiRequest, queryClient, setTokens, clearTokens, getRefreshToken } from \"../lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ntype AuthContextType = {\n  user: SelectUser | null;\n  isLoading: boolean;\n  error: Error | null;\n  loginMutation: UseMutationResult<AuthResponse, Error, LoginData>;\n  logoutMutation: UseMutationResult<void, Error, void>;\n  registerMutation: UseMutationResult<AuthResponse, Error, RegisterData>;\n};\n\ntype LoginData = {\n  username: string;\n  password: string;\n};\n\ntype RegisterData = {\n  username: string;\n  email: string;\n  password: string;\n  nome: string;\n};\n\ntype AuthResponse = {\n  user: SelectUser;\n  accessToken: string;\n  refreshToken: string;\n};\n\nexport const AuthContext = createContext<AuthContextType | null>(null);\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const { toast } = useToast();\n  \n  const {\n    data: user,\n    error,\n    isLoading,\n  } = useQuery<SelectUser | undefined, Error>({\n    queryKey: [\"/api/user\"],\n    queryFn: getQueryFn({ on401: \"returnNull\" }),\n  });\n\n  const loginMutation = useMutation<AuthResponse, Error, LoginData>({\n    mutationFn: async (credentials) => {\n      const res = await apiRequest(\"POST\", \"/api/login\", credentials, false);\n      return await res.json();\n    },\n    onSuccess: (data) => {\n      setTokens(data.accessToken, data.refreshToken);\n      queryClient.setQueryData([\"/api/user\"], data.user);\n      toast({\n        title: \"Login realizado\",\n        description: `Bem-vindo, ${data.user.nome}!`,\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro no login\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const registerMutation = useMutation<AuthResponse, Error, RegisterData>({\n    mutationFn: async (credentials) => {\n      const res = await apiRequest(\"POST\", \"/api/register\", credentials, false);\n      return await res.json();\n    },\n    onSuccess: (data) => {\n      setTokens(data.accessToken, data.refreshToken);\n      queryClient.setQueryData([\"/api/user\"], data.user);\n      toast({\n        title: \"Registro realizado\",\n        description: `Bem-vindo, ${data.user.nome}!`,\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro no registro\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const logoutMutation = useMutation<void, Error, void>({\n    mutationFn: async () => {\n      const refreshToken = getRefreshToken();\n      await apiRequest(\"POST\", \"/api/logout\", { refreshToken });\n    },\n    onSuccess: () => {\n      clearTokens();\n      queryClient.setQueryData([\"/api/user\"], null);\n      toast({\n        title: \"Logout realizado\",\n        description: \"Até logo!\",\n      });\n    },\n    onError: (error) => {\n      clearTokens();\n      queryClient.setQueryData([\"/api/user\"], null);\n      toast({\n        title: \"Erro no logout\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  return (\n    <AuthContext.Provider\n      value={{\n        user: user ?? null,\n        isLoading,\n        error,\n        loginMutation,\n        logoutMutation,\n        registerMutation,\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error(\"useAuth must be used within an AuthProvider\");\n  }\n  return context;\n}\n","size_bytes":3681},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/pages/relatorios-page.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { FileDown, FileText, Loader2, Search } from \"lucide-react\";\nimport { StatusBadge } from \"@/components/status-badge\";\nimport { format } from \"date-fns\";\nimport { ptBR } from \"date-fns/locale\";\nimport type { Veiculo } from \"@shared/schema\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport jsPDF from \"jspdf\";\nimport autoTable from \"jspdf-autotable\";\n\nexport default function RelatoriosPage() {\n  const filialId = localStorage.getItem(\"selected_filial\");\n  const [filters, setFilters] = useState({\n    dataInicio: \"\",\n    dataFim: \"\",\n    cliente: \"\",\n    transportadora: \"\",\n    situacao: \"all\",\n    motorista: \"\",\n    placa: \"\",\n    statusCarga: \"all\",\n    tipoProprietario: \"all\",\n    vaga: \"\",\n    cte: \"\",\n    nf: \"\",\n    lacre: \"\",\n    observacao: \"\",\n  });\n  const [isExporting, setIsExporting] = useState(false);\n\n  const { data: veiculos, isLoading } = useQuery<Veiculo[]>({\n    queryKey: [\"/api/veiculos\", filialId],\n    enabled: !!filialId,\n  });\n\n  // Função para calcular tempo na vaga\n  const calcularTempoNaVaga = (dataEntrada: string, dataSaida: string | null) => {\n    const entrada = new Date(dataEntrada);\n    const saida = dataSaida ? new Date(dataSaida) : new Date();\n    const diffMs = saida.getTime() - entrada.getTime();\n    \n    const horas = Math.floor(diffMs / (1000 * 60 * 60));\n    const minutos = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));\n    \n    if (horas > 24) {\n      const dias = Math.floor(horas / 24);\n      const horasRestantes = horas % 24;\n      return `${dias}d ${horasRestantes}h ${minutos}m`;\n    }\n    \n    return `${horas}h ${minutos}m`;\n  };\n\n  const filteredVeiculos = veiculos?.filter((v) => {\n    if (filters.dataInicio && new Date(v.dataEntrada) < new Date(filters.dataInicio)) return false;\n    if (filters.dataFim && new Date(v.dataEntrada) > new Date(filters.dataFim)) return false;\n    if (filters.cliente && !(v.cliente ?? \"\").toLowerCase().includes(filters.cliente.toLowerCase())) return false;\n    if (filters.transportadora && !(v.transportadora ?? \"\").toLowerCase().includes(filters.transportadora.toLowerCase())) return false;\n    if (filters.situacao && filters.situacao !== \"all\" && v.situacao !== filters.situacao) return false;\n    if (filters.motorista && !v.motorista.toLowerCase().includes(filters.motorista.toLowerCase())) return false;\n    if (filters.placa && !v.placaCavalo.toLowerCase().includes(filters.placa.toLowerCase())) return false;\n    if (filters.statusCarga && filters.statusCarga !== \"all\" && v.statusCarga !== filters.statusCarga) return false;\n    if (filters.tipoProprietario && filters.tipoProprietario !== \"all\" && v.tipoProprietario !== filters.tipoProprietario) return false;\n    if (filters.vaga && v.vagaId !== filters.vaga) return false;\n    if (filters.cte && !(v.cte ?? \"\").toLowerCase().includes(filters.cte.toLowerCase())) return false;\n    if (filters.nf && !(v.nf ?? \"\").toLowerCase().includes(filters.nf.toLowerCase())) return false;\n    if (filters.lacre && !(v.lacre ?? \"\").toLowerCase().includes(filters.lacre.toLowerCase())) return false;\n    if (filters.observacao && !(v.observacoes ?? \"\").toLowerCase().includes(filters.observacao.toLowerCase())) return false;\n    return true;\n  });\n\n  const exportToCSV = () => {\n    if (!filteredVeiculos) return;\n    \n    setIsExporting(true);\n    try {\n      const headers = [\"Placa Cavalo\", \"Placa Carreta\", \"Motorista\", \"CPF\", \"Transportadora\", \"Cliente\", \"Doca\", \"Situação\", \"Status Carga\", \"Proprietário\", \"Entrada\", \"Saída\", \"Tempo na Vaga\", \"Valor\", \"CTE\", \"NF\", \"Lacre\", \"Observações\"];\n      const rows = filteredVeiculos.map((v) => [\n        v.placaCavalo,\n        v.placaCarreta || \"\",\n        v.motorista,\n        v.cpfMotorista || \"\",\n        v.transportadora || \"\",\n        v.cliente || \"\",\n        v.doca || \"\",\n        v.situacao,\n        v.statusCarga || \"\",\n        v.tipoProprietario || \"\",\n        format(new Date(v.dataEntrada), \"dd/MM/yyyy HH:mm\"),\n        v.dataSaida ? format(new Date(v.dataSaida), \"dd/MM/yyyy HH:mm\") : \"\",\n        calcularTempoNaVaga(v.dataEntrada.toString(), v.dataSaida?.toString() || null),\n        v.valor || \"\",\n        v.cte || \"\",\n        v.nf || \"\",\n        v.lacre || \"\",\n        v.observacoes || \"\",\n      ]);\n\n      const csv = [headers, ...rows].map((row) => row.join(\",\")).join(\"\\n\");\n      const blob = new Blob([csv], { type: \"text/csv;charset=utf-8;\" });\n      const link = document.createElement(\"a\");\n      link.href = URL.createObjectURL(blob);\n      link.download = `relatorio-veiculos-${format(new Date(), \"yyyy-MM-dd\")}.csv`;\n      link.click();\n    } finally {\n      setIsExporting(false);\n    }\n  };\n\n  const exportToPDF = () => {\n    if (!filteredVeiculos) return;\n\n    setIsExporting(true);\n    try {\n      const doc = new jsPDF({\n        orientation: \"landscape\",\n        unit: \"mm\",\n        format: \"a4\",\n      });\n\n      // Header\n      doc.setFontSize(18);\n      doc.text(\"Relatório de Movimentação de Veículos\", 14, 15);\n      \n      doc.setFontSize(10);\n      doc.text(`Data: ${format(new Date(), \"dd/MM/yyyy HH:mm\", { locale: ptBR })}`, 14, 22);\n      doc.text(`Total de Registros: ${filteredVeiculos.length}`, 14, 27);\n\n      // Table\n      const headers = [\n        \"Placa\",\n        \"Motorista\",\n        \"Transp.\",\n        \"Cliente\",\n        \"Situação\",\n        \"Status\",\n        \"Valor\",\n        \"CTE\",\n        \"NF\",\n        \"Lacre\",\n        \"Entrada\",\n        \"Saída\",\n        \"Tempo\"\n      ];\n\n      const rows = filteredVeiculos.map((v) => [\n        v.placaCarreta ? `${v.placaCavalo}+${v.placaCarreta}` : v.placaCavalo,\n        v.motorista,\n        v.transportadora || \"-\",\n        v.cliente || \"-\",\n        v.situacao,\n        v.statusCarga || \"-\",\n        v.valor || \"-\",\n        v.cte || \"-\",\n        v.nf || \"-\",\n        v.lacre || \"-\",\n        format(new Date(v.dataEntrada), \"dd/MM HH:mm\"),\n        v.dataSaida ? format(new Date(v.dataSaida), \"dd/MM HH:mm\") : \"-\",\n        calcularTempoNaVaga(v.dataEntrada.toString(), v.dataSaida?.toString() || null),\n      ]);\n\n      autoTable(doc, {\n        head: [headers],\n        body: rows,\n        startY: 32,\n        styles: {\n          fontSize: 8,\n          cellPadding: 2,\n        },\n        headStyles: {\n          fillColor: [239, 68, 68], // PIZZATTIO red color\n          textColor: 255,\n          fontStyle: \"bold\",\n        },\n        alternateRowStyles: {\n          fillColor: [245, 245, 245],\n        },\n        margin: { top: 32 },\n      });\n\n      doc.save(`relatorio-veiculos-${format(new Date(), \"yyyy-MM-dd\")}.pdf`);\n    } finally {\n      setIsExporting(false);\n    }\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Header */}\n      <div>\n        <h1 className=\"text-3xl font-bold text-foreground\">Relatórios</h1>\n        <p className=\"text-muted-foreground\">Consulte e exporte relatórios de movimentação</p>\n      </div>\n\n      {/* Filters */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Filtros</CardTitle>\n          <CardDescription>Refine sua busca</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"dataInicio\">Data Início</Label>\n              <Input\n                id=\"dataInicio\"\n                type=\"date\"\n                data-testid=\"input-data-inicio\"\n                value={filters.dataInicio}\n                onChange={(e) => setFilters({ ...filters, dataInicio: e.target.value })}\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"dataFim\">Data Fim</Label>\n              <Input\n                id=\"dataFim\"\n                type=\"date\"\n                data-testid=\"input-data-fim\"\n                value={filters.dataFim}\n                onChange={(e) => setFilters({ ...filters, dataFim: e.target.value })}\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"situacao\">Situação</Label>\n              <Select\n                value={filters.situacao}\n                onValueChange={(value) => setFilters({ ...filters, situacao: value })}\n              >\n                <SelectTrigger id=\"situacao\" data-testid=\"select-situacao\">\n                  <SelectValue placeholder=\"Todas\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">Todas</SelectItem>\n                  <SelectItem value=\"aguardando\">Aguardando</SelectItem>\n                  <SelectItem value=\"docado\">Docado</SelectItem>\n                  <SelectItem value=\"carregando\">Carregando</SelectItem>\n                  <SelectItem value=\"descarregando\">Descarregando</SelectItem>\n                  <SelectItem value=\"finalizado\">Finalizado</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"cliente\">Cliente</Label>\n              <Input\n                id=\"cliente\"\n                placeholder=\"Filtrar por cliente\"\n                data-testid=\"input-cliente-filter\"\n                value={filters.cliente}\n                onChange={(e) => setFilters({ ...filters, cliente: e.target.value })}\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"transportadora\">Transportadora</Label>\n              <Input\n                id=\"transportadora\"\n                placeholder=\"Filtrar por transportadora\"\n                data-testid=\"input-transportadora-filter\"\n                value={filters.transportadora}\n                onChange={(e) => setFilters({ ...filters, transportadora: e.target.value })}\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"motorista-filter\">Motorista</Label>\n              <Input\n                id=\"motorista-filter\"\n                placeholder=\"Filtrar por motorista\"\n                data-testid=\"input-motorista-filter\"\n                value={filters.motorista}\n                onChange={(e) => setFilters({ ...filters, motorista: e.target.value })}\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"placa-filter\">Placa</Label>\n              <Input\n                id=\"placa-filter\"\n                placeholder=\"Filtrar por placa\"\n                data-testid=\"input-placa-filter\"\n                value={filters.placa}\n                onChange={(e) => setFilters({ ...filters, placa: e.target.value })}\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"statusCarga-filter\">Status da Carga</Label>\n              <Select\n                value={filters.statusCarga}\n                onValueChange={(value) => setFilters({ ...filters, statusCarga: value })}\n              >\n                <SelectTrigger id=\"statusCarga-filter\" data-testid=\"select-status-carga\">\n                  <SelectValue placeholder=\"Todos\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">Todos</SelectItem>\n                  <SelectItem value=\"carregado\">Carregado</SelectItem>\n                  <SelectItem value=\"descarregado\">Descarregado</SelectItem>\n                  <SelectItem value=\"pernoite\">Pernoite</SelectItem>\n                  <SelectItem value=\"manutencao\">Manutenção</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"tipoProprietario-filter\">Tipo Proprietário</Label>\n              <Select\n                value={filters.tipoProprietario}\n                onValueChange={(value) => setFilters({ ...filters, tipoProprietario: value })}\n              >\n                <SelectTrigger id=\"tipoProprietario-filter\" data-testid=\"select-tipo-proprietario\">\n                  <SelectValue placeholder=\"Todos\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">Todos</SelectItem>\n                  <SelectItem value=\"terceiro\">Terceiro</SelectItem>\n                  <SelectItem value=\"agregado\">Agregado</SelectItem>\n                  <SelectItem value=\"frota\">Frota</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"cte-filter\">CTE</Label>\n              <Input\n                id=\"cte-filter\"\n                placeholder=\"Filtrar por CTE\"\n                data-testid=\"input-cte-filter\"\n                value={filters.cte}\n                onChange={(e) => setFilters({ ...filters, cte: e.target.value })}\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"nf-filter\">NF</Label>\n              <Input\n                id=\"nf-filter\"\n                placeholder=\"Filtrar por NF\"\n                data-testid=\"input-nf-filter\"\n                value={filters.nf}\n                onChange={(e) => setFilters({ ...filters, nf: e.target.value })}\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"lacre-filter\">Lacre</Label>\n              <Input\n                id=\"lacre-filter\"\n                placeholder=\"Filtrar por Lacre\"\n                data-testid=\"input-lacre-filter\"\n                value={filters.lacre}\n                onChange={(e) => setFilters({ ...filters, lacre: e.target.value })}\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"observacao-filter\">Observações</Label>\n              <Input\n                id=\"observacao-filter\"\n                placeholder=\"Filtrar por observações\"\n                data-testid=\"input-observacao-filter\"\n                value={filters.observacao}\n                onChange={(e) => setFilters({ ...filters, observacao: e.target.value })}\n              />\n            </div>\n            <div className=\"flex items-end\">\n              <Button\n                variant=\"outline\"\n                className=\"w-full\"\n                onClick={() => setFilters({\n                  dataInicio: \"\",\n                  dataFim: \"\",\n                  cliente: \"\",\n                  transportadora: \"\",\n                  situacao: \"\",\n                  motorista: \"\",\n                  placa: \"\",\n                  statusCarga: \"\",\n                  tipoProprietario: \"\",\n                  vaga: \"\",\n                  cte: \"\",\n                  nf: \"\",\n                  lacre: \"\",\n                  observacao: \"\",\n                })}\n                data-testid=\"button-limpar-filtros\"\n              >\n                Limpar Filtros\n              </Button>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Results */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <CardTitle>Resultados</CardTitle>\n              <CardDescription>{filteredVeiculos?.length || 0} registros encontrados</CardDescription>\n            </div>\n            <div className=\"flex gap-2\">\n              <Button\n                onClick={exportToCSV}\n                disabled={!filteredVeiculos || filteredVeiculos.length === 0 || isExporting}\n                data-testid=\"button-export-csv\"\n                variant=\"outline\"\n              >\n                {isExporting ? (\n                  <>\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                    Exportando...\n                  </>\n                ) : (\n                  <>\n                    <FileDown className=\"mr-2 h-4 w-4\" />\n                    Exportar CSV\n                  </>\n                )}\n              </Button>\n              <Button\n                onClick={exportToPDF}\n                disabled={!filteredVeiculos || filteredVeiculos.length === 0 || isExporting}\n                data-testid=\"button-export-pdf\"\n              >\n                {isExporting ? (\n                  <>\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                    Exportando...\n                  </>\n                ) : (\n                  <>\n                    <FileText className=\"mr-2 h-4 w-4\" />\n                    Exportar PDF\n                  </>\n                )}\n              </Button>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"flex justify-center py-8\">\n              <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n            </div>\n          ) : filteredVeiculos && filteredVeiculos.length > 0 ? (\n            <div className=\"space-y-2\">\n              {filteredVeiculos.map((veiculo) => (\n                <div\n                  key={veiculo.id}\n                  className=\"p-4 border rounded-lg hover-elevate\"\n                  data-testid={`relatorio-veiculo-${veiculo.placaCavalo}`}\n                >\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"space-y-1\">\n                      <div className=\"flex items-center gap-2\">\n                        <span className=\"font-medium\">{veiculo.placaCavalo}</span>\n                        {veiculo.placaCarreta && (\n                          <span className=\"text-sm text-muted-foreground\">+ {veiculo.placaCarreta}</span>\n                        )}\n                        <StatusBadge status={veiculo.situacao} type=\"veiculo\" />\n                      </div>\n                      <div className=\"text-sm text-muted-foreground\">\n                        Motorista: {veiculo.motorista}\n                      </div>\n                      {veiculo.transportadora && (\n                        <div className=\"text-sm text-muted-foreground\">\n                          Transportadora: {veiculo.transportadora}\n                        </div>\n                      )}\n                      {veiculo.cliente && (\n                        <div className=\"text-sm text-muted-foreground\">\n                          Cliente: {veiculo.cliente}\n                        </div>\n                      )}\n                      {veiculo.doca && (\n                        <div className=\"text-sm text-muted-foreground\">\n                          Doca: {veiculo.doca}\n                        </div>\n                      )}\n                    </div>\n                    <div className=\"text-right text-sm text-muted-foreground space-y-1\">\n                      <div>Entrada: {format(new Date(veiculo.dataEntrada), \"dd/MM/yyyy HH:mm\", { locale: ptBR })}</div>\n                      {veiculo.dataSaida && (\n                        <div>Saída: {format(new Date(veiculo.dataSaida), \"dd/MM/yyyy HH:mm\", { locale: ptBR })}</div>\n                      )}\n                      <div className=\"font-medium text-primary\">\n                        ⏱️ {calcularTempoNaVaga(veiculo.dataEntrada.toString(), veiculo.dataSaida?.toString() || null)}\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <div className=\"text-center py-8\">\n              <FileText className=\"h-12 w-12 text-muted-foreground mx-auto mb-4 opacity-50\" />\n              <p className=\"text-muted-foreground\">Nenhum resultado encontrado</p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":19938},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/pages/visitantes-page.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { UserCheck, Plus, Check, X, Loader2 } from \"lucide-react\";\nimport { StatusBadge } from \"@/components/status-badge\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { format } from \"date-fns\";\nimport { ptBR } from \"date-fns/locale\";\nimport type { Visitante } from \"@shared/schema\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\n\nexport default function VisitantesPage() {\n  const { toast } = useToast();\n  const filialId = localStorage.getItem(\"selected_filial\");\n  const [activeTab, setActiveTab] = useState(\"aguardando\");\n  const [showNewDialog, setShowNewDialog] = useState(false);\n\n  const [formData, setFormData] = useState({\n    nome: \"\",\n    cpf: \"\",\n    empresa: \"\",\n    tipoVisita: \"visitante\",\n    motivoVisita: \"\",\n  });\n\n  const { data: visitantes, isLoading } = useQuery<Visitante[]>({\n    queryKey: [\"/api/visitantes\", filialId],\n    enabled: !!filialId,\n  });\n\n  const createVisitanteMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const res = await apiRequest(\"POST\", \"/api/visitantes\", {\n        ...data,\n        filialId,\n      });\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/visitantes\"] });\n      toast({\n        title: \"Visitante cadastrado\",\n        description: \"Aguardando aprovação\",\n      });\n      setFormData({\n        nome: \"\",\n        cpf: \"\",\n        empresa: \"\",\n        tipoVisita: \"visitante\",\n        motivoVisita: \"\",\n      });\n      setShowNewDialog(false);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro ao cadastrar\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const aprovarVisitanteMutation = useMutation({\n    mutationFn: async (visitanteId: string) => {\n      const res = await apiRequest(\"PATCH\", `/api/visitantes/${visitanteId}/aprovar`, {});\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/visitantes\"] });\n      toast({\n        title: \"Visitante aprovado\",\n        description: \"Entrada liberada\",\n      });\n    },\n  });\n\n  const registrarEntradaMutation = useMutation({\n    mutationFn: async (visitanteId: string) => {\n      const res = await apiRequest(\"PATCH\", `/api/visitantes/${visitanteId}/entrada`, {});\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/visitantes\"] });\n      toast({\n        title: \"Entrada registrada\",\n        description: \"Visitante está dentro da filial\",\n      });\n    },\n  });\n\n  const registrarSaidaMutation = useMutation({\n    mutationFn: async (visitanteId: string) => {\n      const res = await apiRequest(\"PATCH\", `/api/visitantes/${visitanteId}/saida`, {});\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/visitantes\"] });\n      toast({\n        title: \"Saída registrada\",\n        description: \"Visitante deixou a filial\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    createVisitanteMutation.mutate(formData);\n  };\n\n  const visitantesAguardando = visitantes?.filter((v) => v.status === \"aguardando\");\n  const visitantesAprovados = visitantes?.filter((v) => v.status === \"aprovado\");\n  const visitantesDentro = visitantes?.filter((v) => v.status === \"dentro\");\n  const visitantesSairam = visitantes?.filter((v) => v.status === \"saiu\");\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">Gestão de Visitantes</h1>\n          <p className=\"text-muted-foreground\">Controle de visitantes e prestadores de serviço</p>\n        </div>\n        <Button onClick={() => setShowNewDialog(true)} data-testid=\"button-novo-visitante\">\n          <Plus className=\"mr-2 h-4 w-4\" />\n          Novo Visitante\n        </Button>\n      </div>\n\n      {/* Stats */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Aguardando</CardDescription>\n            <CardTitle className=\"text-3xl text-amber-600\">{visitantesAguardando?.length || 0}</CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Aprovados</CardDescription>\n            <CardTitle className=\"text-3xl text-blue-600\">{visitantesAprovados?.length || 0}</CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Dentro</CardDescription>\n            <CardTitle className=\"text-3xl text-emerald-600\">{visitantesDentro?.length || 0}</CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Hoje</CardDescription>\n            <CardTitle className=\"text-3xl\">{visitantes?.length || 0}</CardTitle>\n          </CardHeader>\n        </Card>\n      </div>\n\n      {/* Tabs */}\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList>\n          <TabsTrigger value=\"aguardando\" data-testid=\"tab-aguardando\">\n            Aguardando ({visitantesAguardando?.length || 0})\n          </TabsTrigger>\n          <TabsTrigger value=\"aprovados\" data-testid=\"tab-aprovados\">\n            Aprovados ({visitantesAprovados?.length || 0})\n          </TabsTrigger>\n          <TabsTrigger value=\"dentro\" data-testid=\"tab-dentro\">\n            Dentro ({visitantesDentro?.length || 0})\n          </TabsTrigger>\n          <TabsTrigger value=\"historico\" data-testid=\"tab-historico\">\n            Histórico\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"aguardando\" className=\"mt-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Visitantes Aguardando Aprovação</CardTitle>\n              <CardDescription>Aprove ou rejeite solicitações de visita</CardDescription>\n            </CardHeader>\n            <CardContent>\n              {isLoading ? (\n                <div className=\"flex justify-center py-8\">\n                  <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n                </div>\n              ) : visitantesAguardando && visitantesAguardando.length > 0 ? (\n                <div className=\"space-y-2\">\n                  {visitantesAguardando.map((visitante) => (\n                    <div\n                      key={visitante.id}\n                      className=\"flex items-center justify-between p-4 border rounded-lg hover-elevate\"\n                      data-testid={`visitante-${visitante.cpf}`}\n                    >\n                      <div className=\"flex-1 space-y-1\">\n                        <div className=\"flex items-center gap-2\">\n                          <UserCheck className=\"h-4 w-4 text-muted-foreground\" />\n                          <span className=\"font-medium\">{visitante.nome}</span>\n                          <StatusBadge status={visitante.status} type=\"visitante\" />\n                        </div>\n                        <div className=\"text-sm text-muted-foreground\">\n                          CPF: {visitante.cpf}\n                        </div>\n                        {visitante.empresa && (\n                          <div className=\"text-sm text-muted-foreground\">\n                            Empresa: {visitante.empresa}\n                          </div>\n                        )}\n                        {visitante.motivoVisita && (\n                          <div className=\"text-sm text-muted-foreground\">\n                            Motivo: {visitante.motivoVisita}\n                          </div>\n                        )}\n                      </div>\n                      <div className=\"flex gap-2\">\n                        <Button\n                          size=\"sm\"\n                          onClick={() => aprovarVisitanteMutation.mutate(visitante.id)}\n                          disabled={aprovarVisitanteMutation.isPending}\n                          data-testid={`button-aprovar-${visitante.cpf}`}\n                        >\n                          <Check className=\"mr-2 h-4 w-4\" />\n                          Aprovar\n                        </Button>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              ) : (\n                <div className=\"text-center py-8\">\n                  <UserCheck className=\"h-12 w-12 text-muted-foreground mx-auto mb-4 opacity-50\" />\n                  <p className=\"text-muted-foreground\">Nenhum visitante aguardando aprovação</p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"aprovados\" className=\"mt-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Visitantes Aprovados</CardTitle>\n              <CardDescription>Registre a entrada de visitantes aprovados</CardDescription>\n            </CardHeader>\n            <CardContent>\n              {visitantesAprovados && visitantesAprovados.length > 0 ? (\n                <div className=\"space-y-2\">\n                  {visitantesAprovados.map((visitante) => (\n                    <div\n                      key={visitante.id}\n                      className=\"flex items-center justify-between p-4 border rounded-lg hover-elevate\"\n                    >\n                      <div className=\"flex-1 space-y-1\">\n                        <div className=\"flex items-center gap-2\">\n                          <UserCheck className=\"h-4 w-4 text-muted-foreground\" />\n                          <span className=\"font-medium\">{visitante.nome}</span>\n                          <StatusBadge status={visitante.status} type=\"visitante\" />\n                        </div>\n                        <div className=\"text-sm text-muted-foreground\">\n                          CPF: {visitante.cpf}\n                        </div>\n                        {visitante.empresa && (\n                          <div className=\"text-sm text-muted-foreground\">\n                            Empresa: {visitante.empresa}\n                          </div>\n                        )}\n                      </div>\n                      <Button\n                        size=\"sm\"\n                        onClick={() => registrarEntradaMutation.mutate(visitante.id)}\n                        disabled={registrarEntradaMutation.isPending}\n                        data-testid={`button-entrada-${visitante.cpf}`}\n                      >\n                        Registrar Entrada\n                      </Button>\n                    </div>\n                  ))}\n                </div>\n              ) : (\n                <div className=\"text-center py-8\">\n                  <UserCheck className=\"h-12 w-12 text-muted-foreground mx-auto mb-4 opacity-50\" />\n                  <p className=\"text-muted-foreground\">Nenhum visitante aprovado</p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"dentro\" className=\"mt-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Visitantes Dentro da Filial</CardTitle>\n              <CardDescription>Registre a saída de visitantes</CardDescription>\n            </CardHeader>\n            <CardContent>\n              {visitantesDentro && visitantesDentro.length > 0 ? (\n                <div className=\"space-y-2\">\n                  {visitantesDentro.map((visitante) => (\n                    <div\n                      key={visitante.id}\n                      className=\"flex items-center justify-between p-4 border rounded-lg hover-elevate\"\n                    >\n                      <div className=\"flex-1 space-y-1\">\n                        <div className=\"flex items-center gap-2\">\n                          <UserCheck className=\"h-4 w-4 text-muted-foreground\" />\n                          <span className=\"font-medium\">{visitante.nome}</span>\n                          <StatusBadge status={visitante.status} type=\"visitante\" />\n                        </div>\n                        <div className=\"text-sm text-muted-foreground\">\n                          Entrada: {visitante.dataEntrada && format(new Date(visitante.dataEntrada), \"dd/MM/yyyy HH:mm\", { locale: ptBR })}\n                        </div>\n                      </div>\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() => registrarSaidaMutation.mutate(visitante.id)}\n                        disabled={registrarSaidaMutation.isPending}\n                        data-testid={`button-saida-${visitante.cpf}`}\n                      >\n                        Registrar Saída\n                      </Button>\n                    </div>\n                  ))}\n                </div>\n              ) : (\n                <div className=\"text-center py-8\">\n                  <UserCheck className=\"h-12 w-12 text-muted-foreground mx-auto mb-4 opacity-50\" />\n                  <p className=\"text-muted-foreground\">Nenhum visitante dentro da filial</p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"historico\" className=\"mt-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Histórico de Visitantes</CardTitle>\n              <CardDescription>Todos os visitantes registrados</CardDescription>\n            </CardHeader>\n            <CardContent>\n              {visitantes && visitantes.length > 0 ? (\n                <div className=\"space-y-2\">\n                  {visitantes.map((visitante) => (\n                    <div key={visitante.id} className=\"p-4 border rounded-lg\">\n                      <div className=\"flex items-start justify-between\">\n                        <div className=\"space-y-1\">\n                          <div className=\"flex items-center gap-2\">\n                            <UserCheck className=\"h-4 w-4 text-muted-foreground\" />\n                            <span className=\"font-medium\">{visitante.nome}</span>\n                            <StatusBadge status={visitante.status} type=\"visitante\" />\n                          </div>\n                          <div className=\"text-sm text-muted-foreground\">\n                            CPF: {visitante.cpf}\n                          </div>\n                          {visitante.empresa && (\n                            <div className=\"text-sm text-muted-foreground\">\n                              Empresa: {visitante.empresa}\n                            </div>\n                          )}\n                        </div>\n                        <div className=\"text-right text-sm text-muted-foreground\">\n                          {visitante.dataEntrada && (\n                            <div>Entrada: {format(new Date(visitante.dataEntrada), \"dd/MM HH:mm\", { locale: ptBR })}</div>\n                          )}\n                          {visitante.dataSaida && (\n                            <div>Saída: {format(new Date(visitante.dataSaida), \"dd/MM HH:mm\", { locale: ptBR })}</div>\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              ) : (\n                <div className=\"text-center py-8\">\n                  <UserCheck className=\"h-12 w-12 text-muted-foreground mx-auto mb-4 opacity-50\" />\n                  <p className=\"text-muted-foreground\">Nenhum visitante registrado</p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n\n      {/* Dialog Novo Visitante */}\n      <Dialog open={showNewDialog} onOpenChange={setShowNewDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Cadastrar Novo Visitante</DialogTitle>\n            <DialogDescription>\n              Preencha os dados do visitante para solicitar aprovação\n            </DialogDescription>\n          </DialogHeader>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"nome\">Nome Completo *</Label>\n              <Input\n                id=\"nome\"\n                data-testid=\"input-nome-visitante\"\n                placeholder=\"João Silva\"\n                value={formData.nome}\n                onChange={(e) => setFormData({ ...formData, nome: e.target.value })}\n                required\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"cpf\">CPF *</Label>\n              <Input\n                id=\"cpf\"\n                data-testid=\"input-cpf-visitante\"\n                placeholder=\"000.000.000-00\"\n                value={formData.cpf}\n                onChange={(e) => setFormData({ ...formData, cpf: e.target.value })}\n                required\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"empresa\">Empresa</Label>\n              <Input\n                id=\"empresa\"\n                data-testid=\"input-empresa-visitante\"\n                placeholder=\"Nome da empresa\"\n                value={formData.empresa}\n                onChange={(e) => setFormData({ ...formData, empresa: e.target.value })}\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"tipoVisita\">Tipo de Visita *</Label>\n              <Select\n                value={formData.tipoVisita}\n                onValueChange={(value) => setFormData({ ...formData, tipoVisita: value })}\n              >\n                <SelectTrigger id=\"tipoVisita\" data-testid=\"select-tipo-visita\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"visitante\">Visitante</SelectItem>\n                  <SelectItem value=\"prestador_servico\">Prestador de Serviço</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"motivoVisita\">Motivo da Visita</Label>\n              <Textarea\n                id=\"motivoVisita\"\n                data-testid=\"textarea-motivo-visita\"\n                placeholder=\"Descreva o motivo da visita...\"\n                value={formData.motivoVisita}\n                onChange={(e) => setFormData({ ...formData, motivoVisita: e.target.value })}\n                rows={3}\n              />\n            </div>\n            <DialogFooter>\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => setShowNewDialog(false)}\n              >\n                Cancelar\n              </Button>\n              <Button\n                type=\"submit\"\n                disabled={createVisitanteMutation.isPending}\n                data-testid=\"button-cadastrar-visitante\"\n              >\n                {createVisitanteMutation.isPending ? (\n                  <>\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                    Cadastrando...\n                  </>\n                ) : (\n                  \"Cadastrar\"\n                )}\n              </Button>\n            </DialogFooter>\n          </form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":20178},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/role-badge.tsx":{"content":"import { Badge } from \"@/components/ui/badge\";\nimport { Shield, User, UserCog } from \"lucide-react\";\n\ninterface RoleBadgeProps {\n  role: \"porteiro\" | \"cliente\" | \"gestor\";\n}\n\nexport function RoleBadge({ role }: RoleBadgeProps) {\n  const configs = {\n    porteiro: { \n      label: \"Porteiro\", \n      icon: User, \n      className: \"bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-950 dark:text-blue-200 dark:border-blue-800\"\n    },\n    cliente: { \n      label: \"Cliente\", \n      icon: User, \n      className: \"bg-purple-100 text-purple-800 border-purple-200 dark:bg-purple-950 dark:text-purple-200 dark:border-purple-800\"\n    },\n    gestor: { \n      label: \"Gestor\", \n      icon: Shield, \n      className: \"bg-emerald-100 text-emerald-800 border-emerald-200 dark:bg-emerald-950 dark:text-emerald-200 dark:border-emerald-800\"\n    },\n  };\n\n  const config = configs[role];\n  const Icon = config.icon;\n\n  return (\n    <Badge variant=\"outline\" className={`${config.className} gap-1 text-xs font-medium`} data-testid={`badge-role-${role}`}>\n      <Icon className=\"h-3 w-3\" />\n      {config.label}\n    </Badge>\n  );\n}\n","size_bytes":1115},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/pages/gestao-page.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Users, Building2, FileText, Shield, Loader2, TrendingUp, Activity } from \"lucide-react\";\nimport type { User, Filial, AuditLog, Veiculo } from \"@shared/schema\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { format } from \"date-fns\";\nimport { ptBR } from \"date-fns/locale\";\n\nexport default function GestaoPage() {\n  const { data: users } = useQuery<User[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  const { data: filiais } = useQuery<Filial[]>({\n    queryKey: [\"/api/filiais\"],\n  });\n\n  const { data: auditLogs } = useQuery<AuditLog[]>({\n    queryKey: [\"/api/audit-logs\"],\n  });\n\n  const { data: veiculos } = useQuery<Veiculo[]>({\n    queryKey: [\"/api/veiculos/all\"],\n  });\n\n  const usuariosAtivos = users?.filter((u) => u.ativo).length || 0;\n  const filiaisAtivas = filiais?.filter((f) => f.ativo).length || 0;\n  const veiculosHoje = veiculos?.filter((v) => {\n    const hoje = new Date();\n    const entrada = new Date(v.dataEntrada);\n    return entrada.toDateString() === hoje.toDateString();\n  }).length || 0;\n\n  const recentLogs = auditLogs?.slice(0, 10) || [];\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Header */}\n      <div>\n        <h1 className=\"text-3xl font-bold text-foreground\">Gestão</h1>\n        <p className=\"text-muted-foreground\">Visão geral do sistema</p>\n      </div>\n\n      {/* Main Stats */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription className=\"flex items-center gap-2\">\n              <Users className=\"h-4 w-4\" />\n              Usuários Ativos\n            </CardDescription>\n            <CardTitle className=\"text-3xl\">{usuariosAtivos}</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-xs text-muted-foreground\">Total: {users?.length || 0}</p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription className=\"flex items-center gap-2\">\n              <Building2 className=\"h-4 w-4\" />\n              Filiais Ativas\n            </CardDescription>\n            <CardTitle className=\"text-3xl\">{filiaisAtivas}</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-xs text-muted-foreground\">Total: {filiais?.length || 0}</p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription className=\"flex items-center gap-2\">\n              <Activity className=\"h-4 w-4\" />\n              Movimentações Hoje\n            </CardDescription>\n            <CardTitle className=\"text-3xl\">{veiculosHoje}</CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription className=\"flex items-center gap-2\">\n              <FileText className=\"h-4 w-4\" />\n              Eventos de Auditoria\n            </CardDescription>\n            <CardTitle className=\"text-3xl\">{auditLogs?.length || 0}</CardTitle>\n          </CardHeader>\n        </Card>\n      </div>\n\n      {/* Quick Actions */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <Card className=\"hover-elevate cursor-pointer transition-all\" onClick={() => window.location.href = \"/usuarios\"} data-testid=\"card-manage-users\">\n          <CardHeader>\n            <div className=\"flex items-center gap-3\">\n              <div className=\"flex h-12 w-12 items-center justify-center rounded-lg bg-primary/10\">\n                <Users className=\"h-6 w-6 text-primary\" />\n              </div>\n              <div>\n                <CardTitle className=\"text-lg\">Usuários</CardTitle>\n                <CardDescription>Gerencie usuários e permissões</CardDescription>\n              </div>\n            </div>\n          </CardHeader>\n        </Card>\n\n        <Card className=\"hover-elevate cursor-pointer transition-all\" onClick={() => window.location.href = \"/filiais\"} data-testid=\"card-manage-filiais\">\n          <CardHeader>\n            <div className=\"flex items-center gap-3\">\n              <div className=\"flex h-12 w-12 items-center justify-center rounded-lg bg-primary/10\">\n                <Building2 className=\"h-6 w-6 text-primary\" />\n              </div>\n              <div>\n                <CardTitle className=\"text-lg\">Filiais</CardTitle>\n                <CardDescription>Gerencie filiais e vagas</CardDescription>\n              </div>\n            </div>\n          </CardHeader>\n        </Card>\n\n        <Card className=\"hover-elevate cursor-pointer transition-all\" onClick={() => window.location.href = \"/auditoria\"} data-testid=\"card-audit\">\n          <CardHeader>\n            <div className=\"flex items-center gap-3\">\n              <div className=\"flex h-12 w-12 items-center justify-center rounded-lg bg-primary/10\">\n                <FileText className=\"h-6 w-6 text-primary\" />\n              </div>\n              <div>\n                <CardTitle className=\"text-lg\">Auditoria</CardTitle>\n                <CardDescription>Visualize logs do sistema</CardDescription>\n              </div>\n            </div>\n          </CardHeader>\n        </Card>\n      </div>\n\n      {/* Recent Activity */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Atividade Recente</CardTitle>\n          <CardDescription>Últimas ações no sistema</CardDescription>\n        </CardHeader>\n        <CardContent>\n          {recentLogs.length > 0 ? (\n            <div className=\"space-y-2\">\n              {recentLogs.map((log) => (\n                <div key={log.id} className=\"flex items-center justify-between p-3 border rounded-lg text-sm\">\n                  <div className=\"flex-1 space-y-1\">\n                    <div className=\"flex items-center gap-2\">\n                      <Shield className=\"h-3 w-3 text-muted-foreground\" />\n                      <span className=\"font-medium\">{log.acao}</span>\n                      <Badge variant=\"outline\" className=\"text-xs\">{log.entidade}</Badge>\n                    </div>\n                  </div>\n                  <span className=\"text-xs text-muted-foreground\">\n                    {format(new Date(log.createdAt), \"dd/MM HH:mm\", { locale: ptBR })}\n                  </span>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <div className=\"text-center py-8\">\n              <FileText className=\"h-12 w-12 text-muted-foreground mx-auto mb-4 opacity-50\" />\n              <p className=\"text-muted-foreground\">Nenhuma atividade registrada</p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":6744},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":844},"replit.md":{"content":"# APP PIZZATTIO LOG - Sistema de Controle de Pátio e Portaria\n\n## Overview\n\nA comprehensive web-based system designed for managing vehicle and visitor entry/exit in logistics yards. Rebranded as PIZZATTIO LOG with signature red/orange/yellow branding. Features RBAC user profiles, multi-branch operations, real-time tracking, detailed reporting with time-in-vaga calculations, TV display for driver calls, and enhanced analytics. The system aims to enhance operational efficiency and security in logistics environments.\n\n## User Preferences\n\n- I prefer simple language and clear explanations.\n- I like functional programming paradigms where appropriate.\n- I want an iterative development approach, with frequent updates and feedback loops.\n- Please ask for my approval before implementing major architectural changes or refactoring large portions of the codebase.\n- I prefer detailed explanations for complex features or decisions.\n- Do not make changes to the `shared/schema.ts` file without explicit instruction.\n- Ensure all new features include `data-testids` for E2E testing.\n\n## System Architecture\n\nThe system is built on a modern full-stack architecture.\n\n- **Frontend**: React, TypeScript, Tailwind CSS, Shadcn UI for a consistent and responsive design supporting dark mode.\n- **Backend**: Express.js, TypeScript.\n- **Database**: PostgreSQL (Neon) with Drizzle ORM.\n- **Real-time Communication**: WebSockets (`ws`) for instant updates on vehicle movements, visitor status, and calls.\n- **Authentication**: Session-based authentication using Passport.js, JWTs with access and refresh tokens, scrypt for password hashing, and brute-force protection.\n- **Authorization**: Role-Based Access Control (RBAC) with \"Porteiro\" (Gatekeeper), \"Cliente\" (Client), and \"Gestor/Admin\" (Manager/Admin) roles. Multi-tenant architecture with logical data isolation per branch using a `filialId` field.\n- **UI/UX**: Emphasis on readability with the Inter font, clear hierarchy, and PIZZATTIO branding color scheme (Primary: Red #EF4444, Secondary: Orange #F97316, Accent: Yellow #FDE047, Success: Green, Warning: Yellow/Orange, Danger: Red).\n- **Core Features**:\n    - **Portaria Control**: Vehicle entry/exit registration with various categories (Carro, Moto, Cavalo, Cavalo + Carreta), owner types (Terceiro, Agregado, Frota), and load statuses (Carregado, Descarregado, Pernoite, Manutenção). Conditional fields and mobile-responsive forms for self-registration.\n    - **Vaga Map**: Real-time visualization of 20 parking spots per branch, showing Free/Occupied status.\n    - **Visitor Management**: Registration, approval workflow, and entry/exit tracking for visitors and service providers.\n    - **Call System**: Driver notification and status tracking (Pendente, Atendida, Cancelada).\n    - **TV Display**: Public display page for driver calls with black background and PIZZATTIO gradient colors, designed for warehouse TV monitors with auto-refresh.\n    - **Reporting**: Comprehensive movimentation reports with 10+ filters (transportadora, motorista, placa, vaga, status carga, tipo proprietário, observações), time-in-vaga calculation, CSV and PDF export with PIZZATTIO branding, and full audit history.\n    - **Audit System**: Comprehensive logging of all critical actions, including user, timestamp, branch, action type, affected entity, before/after data (JSON), IP, and User Agent.\n    - **Notification System**: Real-time notifications for managers via polling, with unread counts, status management (read/unread), and branch-specific isolation.\n    - **Administrative Modules**: CRUD functionalities for Drivers, Registered Vehicles, Suppliers, and Custom Truck Statuses, all with multi-tenant isolation, Zod validation, and automatic audit logging.\n    - **Analytical Dashboard**: Bar charts for daily movements, pie charts for status distribution, average stay time metrics with real-time updates, and individual vehicle duration tracking.\n    - **Digital Checklist System**: Database schema created for managing checklists per vehicle and individual items, supporting various types and photo uploads (under development).\n\n## External Dependencies\n\n- **PostgreSQL (Neon)**: Primary database for all application data.\n- **WebSockets (`ws`)**: Used for real-time communication and updates across the application.\n- **Passport.js**: Authentication middleware.\n- **Drizzle ORM**: Object-Relational Mapper for database interactions.\n- **React Query**: Used for data fetching, caching, and synchronization in the frontend.\n- **Zod**: Schema validation library for both frontend and backend.\n- **date-fns**: Library for date formatting (specifically PT-BR locale).\n- **Recharts**: Charting library used for analytical dashboard visualizations.\n\n## Multi-Tenant Security Architecture (Updated October 2025)\n\nThe system implements comprehensive multi-tenant data isolation across all routes:\n\n### Security Layers\n1. **Authentication**: JWT-based session authentication (requireAuth middleware)\n2. **Authorization**: Role-based access control (requireRole middleware)\n3. **Filial Permission Validation**: requireFilial middleware validates X-Filial header against user's authorized filials\n4. **Header-Based Multi-Tenancy**: All GET routes use validated X-Filial header instead of URL parameters\n5. **Entity-Level Verification**: All PATCH/DELETE routes verify entity.filialId matches req.filialId before allowing modifications\n6. **Filial Reassignment Prevention**: All PATCH routes strip filialId from req.body to prevent cross-tenant data manipulation\n\n### API Security Pattern\nAll tenant-scoped routes follow this pattern:\n```typescript\napp.get(\"/api/entity\", requireAuth, requireRole(\"role\"), requireFilial, async (req, res) => {\n  const filialId = (req as any).filialId; // Validated by middleware\n  const data = await storage.getByFilial(filialId);\n  res.json(data);\n});\n\napp.patch(\"/api/entity/:id\", requireAuth, requireRole(\"role\"), requireFilial, async (req, res) => {\n  const filialId = (req as any).filialId;\n  const entity = await storage.get(req.params.id);\n  \n  if (!entity) return res.status(404).json({ error: \"Not found\" });\n  if (entity.filialId !== filialId) return res.status(403).json({ error: \"Access denied\" });\n  \n  const { filialId: _, ...updateData } = req.body; // Strip filialId\n  const updated = await storage.update(req.params.id, updateData);\n  res.json(updated);\n});\n```\n\n### Recent Security & Feature Updates (October-November 2025)\n\n✅ **PIZZATTIO Rebranding** (November 3, 2025):\n   - Complete visual rebrand from blue to PIZZATTIO signature colors\n   - Primary: Red #EF4444 (HSL: 0 91% 57%)\n   - Secondary: Orange #F97316, Accent: Yellow #FDE047\n   - Updated all pages including login, reports, TV display\n   - Logo integrated into login page with black background and gradient\n   - PDF exports now use red headers matching brand identity\n   - Dark mode support maintained with new color palette\n\n✅ **TV Display for Driver Calls** (November 3, 2025):\n   - New public display page at `/tv-display` for warehouse monitors\n   - Black background with PIZZATTIO red/orange/yellow gradient\n   - Shows pending driver calls with placa, motorista, and motivo\n   - Auto-refresh every 30 seconds + WebSocket real-time updates\n   - Large, high-contrast text designed for TV visibility\n   - Animated pulse effects on call cards\n\n✅ **Enhanced Reporting System** (November 3, 2025):\n   - Added 10+ comprehensive filters: transportadora, motorista, placa, vaga, status carga, tipo proprietário, observações, data range\n   - Tempo na vaga calculation (days, hours, minutes) for all vehicles\n   - Fixed vaga filter to correctly compare vagaId\n   - Time display in cards, CSV exports, and PDF reports\n   - PDF export header color updated to PIZZATTIO red\n   - Improved UX with clear filter sections\n\n✅ **Dashboard Analytics Improvements** (November 3, 2025):\n   - Enhanced \"Tempo Médio na Vaga\" card with better formatting (shows days if >= 24h)\n   - Added count of finalized vehicles used in average calculation\n   - Real-time duration updates every 60 seconds for active vehicles\n   - Individual vehicle duration display with Timer icon in recent activity\n   - Accurate Math.floor formatting (no rounding errors)\n\n✅ **WebSocket Filial Filtering**: WebSocket connections now track filialId per client and broadcasts are filtered by target filial\n   - filialId extracted from WebSocket URL query parameter during connection\n   - All 9 broadcast calls updated to include targetFilialId parameter\n   - Query invalidations include filialId for proper cache updates\n   - Resolves cross-tenant data exposure in real-time events\n\n✅ **Portaria UX Enhancements**:\n   - Quick-selection cards for Vehicle/Visitor operations with real-time statistics\n   - Visitor approval toast notifications (5-second duration)\n   - **Simplified Vehicle Entry Forms** (October 31, 2025):\n     - **Carro/Moto**: Only 7 fields shown (tipo veículo, tipo motorista visitante/funcionário, placa, motorista, CPF opcional, vaga, observações)\n     - **Cavalo/Cavalo+Carreta**: All 14+ fields maintained (tipo proprietário, status carga, transportadora, cliente, doca, valor, multi, etc)\n     - Automatic field cleanup when switching between light and heavy vehicles to prevent data leakage\n     - CPF validation: Optional for carro/moto, required for cavalo/cavalo+carreta\n     - tipoMotorista (visitante/funcionário) stored in observações field for light vehicles\n   - **Timestamp and Document Fields** (November 3, 2025):\n     - **Data/Hora de Entrada**: Fixed readonly field showing current timestamp in entrada form (format: dd/MM/yyyy HH:mm)\n     - **Data/Hora de Saída**: Fixed readonly field showing current timestamp in saída dialog\n     - **Saída Dialog**: Comprehensive exit dialog with vehicle info display, editable CTE/NF/LACRE fields\n     - **Document Pre-fill**: CTE/NF/LACRE from entrada are pre-filled in saída dialog for easy updates\n     - **Backend Update**: registrarSaida method accepts optional dadosAdicionais {cte, nf, lacre} parameter\n     - **Controlled State**: All saída inputs use controlled state with onChange handlers\n     - All timestamp fields have bg-muted class and are non-editable for record integrity\n\n✅ **User Permissions Management**:\n   - New administrative interface for managing user-filial permissions\n   - Gestores can assign/remove filial access for any user\n   - Dialog-based interface showing current permissions and available filials\n   - Routes: GET/POST `/api/users/:userId/permissions`, DELETE `/api/user-permissions/:id`\n   - Storage method `getUserPermissions()` returns permissions with filial details via join\n\n✅ **Previous Security Fixes**:\n   - Fixed all parameterized GET routes to use header-based filialId\n   - Added entity ownership verification to all PATCH/DELETE routes\n   - Implemented filialId stripping in all PATCH handlers\n   - Added requireFilial middleware to all tenant-scoped routes\n   - Fixed /api/veiculos/all to respect filial isolation","size_bytes":11035},"client/src/pages/auth-page.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Loader2 } from \"lucide-react\";\nimport logoImage from \"@assets/1_1762177943558.png\";\n\nexport default function AuthPage() {\n  const { user, loginMutation } = useAuth();\n  const [, setLocation] = useLocation();\n  const [loginForm, setLoginForm] = useState({ username: \"\", password: \"\" });\n\n  useEffect(() => {\n    if (user) {\n      setLocation(\"/filial\");\n    }\n  }, [user, setLocation]);\n\n  const handleLogin = (e: React.FormEvent) => {\n    e.preventDefault();\n    loginMutation.mutate(loginForm);\n  };\n\n  if (user) {\n    return null;\n  }\n\n  return (\n    <div className=\"min-h-screen flex\">\n      {/* Left side - Login Form */}\n      <div className=\"w-full lg:w-1/2 flex items-center justify-center p-8 bg-background\">\n        <div className=\"w-full max-w-md space-y-6\">\n          <Card>\n            <CardHeader>\n              <div className=\"flex flex-col items-center gap-3 mb-2\">\n                <img \n                  src={logoImage} \n                  alt=\"Pizzattolog\" \n                  className=\"h-20 w-auto\"\n                  data-testid=\"img-logo\"\n                />\n                <CardTitle className=\"text-2xl text-center\">Acesse sua conta</CardTitle>\n              </div>\n              <CardDescription className=\"text-center\">\n                Entre com suas credenciais para acessar o sistema de controle de pátio e portaria\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <form onSubmit={handleLogin} className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"login-username\">Usuário</Label>\n                  <Input\n                    id=\"login-username\"\n                    data-testid=\"input-login-username\"\n                    type=\"text\"\n                    placeholder=\"seu.usuario\"\n                    value={loginForm.username}\n                    onChange={(e) => setLoginForm({ ...loginForm, username: e.target.value })}\n                    required\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"login-password\">Senha</Label>\n                  <Input\n                    id=\"login-password\"\n                    data-testid=\"input-login-password\"\n                    type=\"password\"\n                    placeholder=\"••••••••\"\n                    value={loginForm.password}\n                    onChange={(e) => setLoginForm({ ...loginForm, password: e.target.value })}\n                    required\n                  />\n                </div>\n                <Button\n                  type=\"submit\"\n                  className=\"w-full\"\n                  disabled={loginMutation.isPending}\n                  data-testid=\"button-login\"\n                >\n                  {loginMutation.isPending ? (\n                    <>\n                      <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                      Entrando...\n                    </>\n                  ) : (\n                    \"Entrar\"\n                  )}\n                </Button>\n              </form>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n\n      {/* Right side - Hero */}\n      <div className=\"hidden lg:flex lg:w-1/2 bg-black items-center justify-center p-12 relative overflow-hidden\">\n        {/* Gradient waves background */}\n        <div className=\"absolute inset-0 bg-gradient-to-br from-red-600/30 via-orange-500/30 to-yellow-500/30\"></div>\n        \n        <div className=\"max-w-md text-white space-y-10 relative z-10\">\n          <div className=\"space-y-4\">\n            <h2 className=\"text-4xl font-bold leading-tight\">\n              Controle Total do seu Pátio\n            </h2>\n            <p className=\"text-lg opacity-90\">\n              Gerencie entrada e saída de veículos, visitantes e operações logísticas com eficiência e segurança.\n            </p>\n          </div>\n          \n          <ul className=\"space-y-4 text-base\">\n            <li className=\"flex items-start gap-3\">\n              <div className=\"h-2 w-2 rounded-full bg-red-500 mt-2 flex-shrink-0\"></div>\n              <span className=\"opacity-90\">Controle em tempo real de vagas e movimentações</span>\n            </li>\n            <li className=\"flex items-start gap-3\">\n              <div className=\"h-2 w-2 rounded-full bg-orange-500 mt-2 flex-shrink-0\"></div>\n              <span className=\"opacity-90\">Gestão completa de visitantes e prestadores</span>\n            </li>\n            <li className=\"flex items-start gap-3\">\n              <div className=\"h-2 w-2 rounded-full bg-yellow-500 mt-2 flex-shrink-0\"></div>\n              <span className=\"opacity-90\">Relatórios e auditoria detalhados</span>\n            </li>\n            <li className=\"flex items-start gap-3\">\n              <div className=\"h-2 w-2 rounded-full bg-red-500 mt-2 flex-shrink-0\"></div>\n              <span className=\"opacity-90\">Sistema multi-filial integrado</span>\n            </li>\n          </ul>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":5410},"client/src/pages/cliente-dashboard-page.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Truck, Clock, CheckCircle2, Loader2, TrendingUp, Timer } from \"lucide-react\";\nimport { StatusBadge } from \"@/components/status-badge\";\nimport { format, subDays, startOfDay, differenceInMinutes } from \"date-fns\";\nimport { ptBR } from \"date-fns/locale\";\nimport type { Veiculo } from \"@shared/schema\";\nimport { useState, useEffect } from \"react\";\nimport {\n  BarChart,\n  Bar,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  Legend,\n  ResponsiveContainer,\n  PieChart,\n  Pie,\n  Cell,\n} from \"recharts\";\n\nexport default function ClienteDashboardPage() {\n  const filialId = localStorage.getItem(\"selected_filial\");\n  const [currentTime, setCurrentTime] = useState(new Date());\n\n  const { data: veiculos, isLoading } = useQuery<Veiculo[]>({\n    queryKey: [\"/api/veiculos\", filialId],\n    enabled: !!filialId,\n  });\n\n  // Update time every minute for real-time duration display\n  useEffect(() => {\n    const interval = setInterval(() => {\n      setCurrentTime(new Date());\n    }, 60000); // Update every minute\n    return () => clearInterval(interval);\n  }, []);\n\n  const veiculosAtivos = veiculos?.filter((v) => !v.dataSaida);\n  const veiculosHoje = veiculos?.filter((v) => {\n    const hoje = new Date();\n    const entrada = new Date(v.dataEntrada);\n    return entrada.toDateString() === hoje.toDateString();\n  });\n  const veiculosFinalizados = veiculos?.filter((v) => v.situacao === \"finalizado\");\n\n  // Group by situacao\n  const porSituacao = veiculos?.reduce((acc, v) => {\n    acc[v.situacao] = (acc[v.situacao] || 0) + 1;\n    return acc;\n  }, {} as Record<string, number>);\n\n  // Chart data: Movimentações últimos 7 dias\n  const last7Days = Array.from({ length: 7 }, (_, i) => {\n    const date = subDays(new Date(), 6 - i);\n    const dateStr = startOfDay(date).toISOString();\n    const count = veiculos?.filter((v) => {\n      const entryDate = startOfDay(new Date(v.dataEntrada));\n      return entryDate.toISOString() === dateStr;\n    }).length || 0;\n    \n    return {\n      date: format(date, \"dd/MM\", { locale: ptBR }),\n      fullDate: format(date, \"dd MMM\", { locale: ptBR }),\n      movimentacoes: count,\n    };\n  });\n\n  // Pie chart data: Distribuição por situação\n  const COLORS = {\n    aguardando: \"#f59e0b\",\n    docado: \"#3b82f6\",\n    carregando: \"#8b5cf6\",\n    descarregando: \"#06b6d4\",\n    finalizado: \"#10b981\",\n  };\n\n  const pieData = Object.entries(porSituacao || {}).map(([situacao, count]) => ({\n    name: situacao.charAt(0).toUpperCase() + situacao.slice(1),\n    value: count,\n    color: COLORS[situacao as keyof typeof COLORS] || \"#64748b\",\n  }));\n\n  // Tempo médio de permanência (em horas)\n  const veiculosComSaida = veiculos?.filter((v) => v.dataSaida);\n  const tempoMedioPermanencia = veiculosComSaida && veiculosComSaida.length > 0\n    ? veiculosComSaida.reduce((acc, v) => {\n        const minutes = differenceInMinutes(new Date(v.dataSaida!), new Date(v.dataEntrada));\n        return acc + (minutes / 60);\n      }, 0) / veiculosComSaida.length\n    : 0;\n\n  // Função para calcular tempo na vaga\n  const calcularTempoNaVaga = (dataEntrada: string, dataSaida: string | null): string => {\n    const entrada = new Date(dataEntrada);\n    const saida = dataSaida ? new Date(dataSaida) : new Date();\n    \n    const diffMs = saida.getTime() - entrada.getTime();\n    const diffMinutos = Math.floor(diffMs / (1000 * 60));\n    \n    if (diffMinutos < 60) {\n      return `${diffMinutos}m`;\n    }\n    \n    const dias = Math.floor(diffMinutos / (60 * 24));\n    const horas = Math.floor((diffMinutos % (60 * 24)) / 60);\n    const minutos = diffMinutos % 60;\n    \n    if (dias > 0) {\n      return `${dias}d ${horas}h ${minutos}m`;\n    }\n    \n    return `${horas}h ${minutos}m`;\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[60vh]\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Header */}\n      <div>\n        <h1 className=\"text-3xl font-bold text-foreground\">Dashboard</h1>\n        <p className=\"text-muted-foreground\">Visão geral das operações do pátio</p>\n      </div>\n\n      {/* Main Stats */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription className=\"flex items-center gap-2\">\n              <Truck className=\"h-4 w-4\" />\n              Veículos Ativos\n            </CardDescription>\n            <CardTitle className=\"text-3xl\">{veiculosAtivos?.length || 0}</CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription className=\"flex items-center gap-2\">\n              <TrendingUp className=\"h-4 w-4\" />\n              Movimentações Hoje\n            </CardDescription>\n            <CardTitle className=\"text-3xl\">{veiculosHoje?.length || 0}</CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription className=\"flex items-center gap-2\">\n              <CheckCircle2 className=\"h-4 w-4\" />\n              Finalizados\n            </CardDescription>\n            <CardTitle className=\"text-3xl text-emerald-600\">{veiculosFinalizados?.length || 0}</CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription className=\"flex items-center gap-2\">\n              <Clock className=\"h-4 w-4\" />\n              Tempo Médio na Vaga\n            </CardDescription>\n            <CardTitle className=\"text-3xl\">\n              {tempoMedioPermanencia >= 24 \n                ? `${Math.floor(tempoMedioPermanencia / 24)}d ${Math.floor(tempoMedioPermanencia % 24)}h`\n                : `${tempoMedioPermanencia.toFixed(1)}h`\n              }\n            </CardTitle>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              {veiculosComSaida?.length || 0} veículos finalizados\n            </p>\n          </CardHeader>\n        </Card>\n      </div>\n\n      {/* Charts Row */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* Bar Chart - Movimentações */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Movimentações - Últimos 7 Dias</CardTitle>\n            <CardDescription>Entrada de veículos por dia</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <ResponsiveContainer width=\"100%\" height={300}>\n              <BarChart data={last7Days}>\n                <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                <XAxis dataKey=\"date\" className=\"text-xs\" />\n                <YAxis className=\"text-xs\" />\n                <Tooltip\n                  contentStyle={{\n                    backgroundColor: \"hsl(var(--card))\",\n                    border: \"1px solid hsl(var(--border))\",\n                    borderRadius: \"6px\",\n                  }}\n                  labelFormatter={(label) => {\n                    const item = last7Days.find((d) => d.date === label);\n                    return item?.fullDate || label;\n                  }}\n                />\n                <Legend />\n                <Bar\n                  dataKey=\"movimentacoes\"\n                  fill=\"hsl(var(--primary))\"\n                  name=\"Entradas\"\n                  radius={[4, 4, 0, 0]}\n                />\n              </BarChart>\n            </ResponsiveContainer>\n          </CardContent>\n        </Card>\n\n        {/* Pie Chart - Distribuição */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Distribuição por Situação</CardTitle>\n            <CardDescription>Status atual de todos os veículos</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <ResponsiveContainer width=\"100%\" height={300}>\n              <PieChart>\n                <Pie\n                  data={pieData}\n                  cx=\"50%\"\n                  cy=\"50%\"\n                  labelLine={false}\n                  label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}\n                  outerRadius={100}\n                  fill=\"#8884d8\"\n                  dataKey=\"value\"\n                >\n                  {pieData.map((entry, index) => (\n                    <Cell key={`cell-${index}`} fill={entry.color} />\n                  ))}\n                </Pie>\n                <Tooltip\n                  contentStyle={{\n                    backgroundColor: \"hsl(var(--card))\",\n                    border: \"1px solid hsl(var(--border))\",\n                    borderRadius: \"6px\",\n                  }}\n                />\n              </PieChart>\n            </ResponsiveContainer>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Recent Activity */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Atividade Recente</CardTitle>\n          <CardDescription>Últimas movimentações registradas</CardDescription>\n        </CardHeader>\n        <CardContent>\n          {veiculosHoje && veiculosHoje.length > 0 ? (\n            <div className=\"space-y-2\">\n              {veiculosHoje.slice(0, 10).map((veiculo) => (\n                <div\n                  key={veiculo.id}\n                  className=\"flex items-center justify-between p-4 border rounded-lg hover-elevate\"\n                  data-testid={`veiculo-recente-${veiculo.placaCavalo}`}\n                >\n                  <div className=\"flex-1 space-y-1\">\n                    <div className=\"flex items-center gap-2\">\n                      <Truck className=\"h-4 w-4 text-muted-foreground\" />\n                      <span className=\"font-medium\">{veiculo.placaCavalo}</span>\n                      {veiculo.placaCarreta && (\n                        <span className=\"text-sm text-muted-foreground\">+ {veiculo.placaCarreta}</span>\n                      )}\n                    </div>\n                    <div className=\"text-sm text-muted-foreground\">\n                      {veiculo.motorista}\n                      {veiculo.transportadora && ` - ${veiculo.transportadora}`}\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <StatusBadge status={veiculo.situacao} type=\"veiculo\" />\n                    </div>\n                  </div>\n                  <div className=\"text-right text-sm text-muted-foreground space-y-1\">\n                    <div>Entrada: {format(new Date(veiculo.dataEntrada), \"HH:mm\", { locale: ptBR })}</div>\n                    {veiculo.dataSaida && (\n                      <div>Saída: {format(new Date(veiculo.dataSaida), \"HH:mm\", { locale: ptBR })}</div>\n                    )}\n                    <div className=\"font-medium text-primary flex items-center justify-end gap-1\">\n                      <Timer className=\"h-3 w-3\" />\n                      {calcularTempoNaVaga(veiculo.dataEntrada.toString(), veiculo.dataSaida?.toString() || null)}\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <div className=\"text-center py-8\">\n              <Truck className=\"h-12 w-12 text-muted-foreground mx-auto mb-4 opacity-50\" />\n              <p className=\"text-muted-foreground\">Nenhuma movimentação hoje</p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":11491},"server/db.ts":{"content":"// Reference: blueprint:javascript_database\nimport { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });\n","size_bytes":527},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"server/auth.ts":{"content":"import { Request, Response, NextFunction } from \"express\";\nimport jwt from \"jsonwebtoken\";\nimport { scrypt, randomBytes, timingSafeEqual } from \"crypto\";\nimport { promisify } from \"util\";\nimport { storage } from \"./storage\";\nimport { type User } from \"@shared/schema\";\n\nconst scryptAsync = promisify(scrypt);\n\n// JWT configuration\nconst JWT_SECRET = process.env.SESSION_SECRET || \"default-secret-change-in-production\";\nconst JWT_EXPIRES_IN = \"15m\"; // 15 minutes\nconst REFRESH_TOKEN_EXPIRES_IN = \"7d\"; // 7 days\n\nexport interface JWTPayload {\n  userId: string;\n  username: string;\n  role: string;\n}\n\nexport async function hashPassword(password: string) {\n  const salt = randomBytes(16).toString(\"hex\");\n  const buf = (await scryptAsync(password, salt, 64)) as Buffer;\n  return `${buf.toString(\"hex\")}.${salt}`;\n}\n\nexport async function comparePasswords(supplied: string, stored: string) {\n  const [hashed, salt] = stored.split(\".\");\n  const hashedBuf = Buffer.from(hashed, \"hex\");\n  const suppliedBuf = (await scryptAsync(supplied, salt, 64)) as Buffer;\n  return timingSafeEqual(hashedBuf, suppliedBuf);\n}\n\nexport function generateAccessToken(user: User): string {\n  const payload: JWTPayload = {\n    userId: user.id,\n    username: user.username,\n    role: user.role,\n  };\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: JWT_EXPIRES_IN });\n}\n\nexport function generateRefreshToken(user: User): string {\n  return jwt.sign({ userId: user.id }, JWT_SECRET, { expiresIn: REFRESH_TOKEN_EXPIRES_IN });\n}\n\nexport function verifyToken(token: string): JWTPayload {\n  return jwt.verify(token, JWT_SECRET) as JWTPayload;\n}\n\n// Remove sensitive fields from user object\nexport function sanitizeUser(user: User) {\n  const { password, loginAttempts, lockedUntil, ...sanitized } = user;\n  return sanitized;\n}\n\n// Middleware to verify JWT token\nexport async function requireAuth(req: Request, res: Response, next: NextFunction) {\n  try {\n    const authHeader = req.headers.authorization;\n    \n    if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n      return res.status(401).json({ error: \"Token não fornecido\" });\n    }\n\n    const token = authHeader.substring(7);\n    const payload = verifyToken(token);\n    \n    const user = await storage.getUser(payload.userId);\n    \n    if (!user || !user.ativo) {\n      return res.status(401).json({ error: \"Usuário inválido ou inativo\" });\n    }\n\n    // Attach user to request\n    (req as any).user = user;\n    next();\n  } catch (error) {\n    if (error instanceof jwt.TokenExpiredError) {\n      return res.status(401).json({ error: \"Token expirado\" });\n    }\n    if (error instanceof jwt.JsonWebTokenError) {\n      return res.status(401).json({ error: \"Token inválido\" });\n    }\n    return res.status(500).json({ error: \"Erro ao verificar token\" });\n  }\n}\n\n// Middleware to require specific role\nexport function requireRole(...roles: string[]) {\n  return (req: Request, res: Response, next: NextFunction) => {\n    const user = (req as any).user as User;\n    \n    if (!user) {\n      return res.status(401).json({ error: \"Não autenticado\" });\n    }\n\n    if (!roles.includes(user.role)) {\n      return res.status(403).json({ error: \"Permissão negada\" });\n    }\n\n    next();\n  };\n}\n","size_bytes":3217},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":4050},"client/src/components/status-badge.tsx":{"content":"import { Badge } from \"@/components/ui/badge\";\nimport { Check, Clock, AlertCircle, LogOut, X } from \"lucide-react\";\n\ninterface StatusBadgeProps {\n  status: string;\n  type?: \"vaga\" | \"visitante\" | \"veiculo\" | \"chamada\";\n}\n\nexport function StatusBadge({ status, type = \"veiculo\" }: StatusBadgeProps) {\n  const getStatusConfig = () => {\n    if (type === \"vaga\") {\n      return status === \"livre\"\n        ? { label: \"Livre\", variant: \"default\" as const, icon: Check, className: \"bg-emerald-100 text-emerald-800 border-emerald-200 dark:bg-emerald-950 dark:text-emerald-200 dark:border-emerald-800\" }\n        : { label: \"Ocupado\", variant: \"secondary\" as const, icon: X, className: \"bg-rose-100 text-rose-800 border-rose-200 dark:bg-rose-950 dark:text-rose-200 dark:border-rose-800\" };\n    }\n    \n    if (type === \"visitante\") {\n      const configs = {\n        aguardando: { label: \"Aguardando\", icon: Clock, className: \"bg-amber-100 text-amber-800 border-amber-200 dark:bg-amber-950 dark:text-amber-200 dark:border-amber-800\" },\n        aprovado: { label: \"Aprovado\", icon: Check, className: \"bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-950 dark:text-blue-200 dark:border-blue-800\" },\n        dentro: { label: \"Dentro\", icon: Check, className: \"bg-emerald-100 text-emerald-800 border-emerald-200 dark:bg-emerald-950 dark:text-emerald-200 dark:border-emerald-800\" },\n        saiu: { label: \"Saiu\", icon: LogOut, className: \"bg-gray-100 text-gray-800 border-gray-200 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700\" },\n      };\n      return configs[status as keyof typeof configs] || configs.aguardando;\n    }\n\n    if (type === \"chamada\") {\n      const configs = {\n        pendente: { label: \"Pendente\", icon: Clock, className: \"bg-amber-100 text-amber-800 border-amber-200 dark:bg-amber-950 dark:text-amber-200 dark:border-amber-800\" },\n        atendida: { label: \"Atendida\", icon: Check, className: \"bg-emerald-100 text-emerald-800 border-emerald-200 dark:bg-emerald-950 dark:text-emerald-200 dark:border-emerald-800\" },\n        cancelada: { label: \"Cancelada\", icon: X, className: \"bg-gray-100 text-gray-800 border-gray-200 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700\" },\n      };\n      return configs[status as keyof typeof configs] || configs.pendente;\n    }\n    \n    // veiculo\n    const configs = {\n      aguardando: { label: \"Aguardando\", icon: Clock, className: \"bg-amber-100 text-amber-800 border-amber-200 dark:bg-amber-950 dark:text-amber-200 dark:border-amber-800\" },\n      docado: { label: \"Docado\", icon: Check, className: \"bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-950 dark:text-blue-200 dark:border-blue-800\" },\n      carregando: { label: \"Carregando\", icon: AlertCircle, className: \"bg-purple-100 text-purple-800 border-purple-200 dark:bg-purple-950 dark:text-purple-200 dark:border-purple-800\" },\n      descarregando: { label: \"Descarregando\", icon: AlertCircle, className: \"bg-cyan-100 text-cyan-800 border-cyan-200 dark:bg-cyan-950 dark:text-cyan-200 dark:border-cyan-800\" },\n      finalizado: { label: \"Finalizado\", icon: Check, className: \"bg-emerald-100 text-emerald-800 border-emerald-200 dark:bg-emerald-950 dark:text-emerald-200 dark:border-emerald-800\" },\n    };\n    return configs[status as keyof typeof configs] || configs.aguardando;\n  };\n\n  const config = getStatusConfig();\n  const Icon = config.icon;\n\n  return (\n    <Badge variant=\"outline\" className={`${config.className} gap-1 text-xs font-medium`} data-testid={`badge-status-${status}`}>\n      <Icon className=\"h-3 w-3\" />\n      {config.label}\n    </Badge>\n  );\n}\n","size_bytes":3591},"client/src/components/theme-provider.tsx":{"content":"import { createContext, useContext, useEffect, useState, ReactNode } from \"react\";\n\ntype Theme = \"light\" | \"dark\";\n\ntype ThemeContextType = {\n  theme: Theme;\n  toggleTheme: () => void;\n};\n\nconst ThemeContext = createContext<ThemeContextType | null>(null);\n\nexport function ThemeProvider({ children }: { children: ReactNode }) {\n  const [theme, setTheme] = useState<Theme>(() => {\n    const stored = localStorage.getItem(\"theme\");\n    return (stored === \"dark\" || stored === \"light\") ? stored : \"light\";\n  });\n\n  useEffect(() => {\n    const root = document.documentElement;\n    if (theme === \"dark\") {\n      root.classList.add(\"dark\");\n    } else {\n      root.classList.remove(\"dark\");\n    }\n    localStorage.setItem(\"theme\", theme);\n  }, [theme]);\n\n  const toggleTheme = () => {\n    setTheme(prev => prev === \"light\" ? \"dark\" : \"light\");\n  };\n\n  return (\n    <ThemeContext.Provider value={{ theme, toggleTheme }}>\n      {children}\n    </ThemeContext.Provider>\n  );\n}\n\nexport function useTheme() {\n  const context = useContext(ThemeContext);\n  if (!context) {\n    throw new Error(\"useTheme must be used within ThemeProvider\");\n  }\n  return context;\n}\n","size_bytes":1150},"client/src/pages/vagas-page.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { MapPin, Loader2 } from \"lucide-react\";\nimport { StatusBadge } from \"@/components/status-badge\";\nimport type { Vaga, Veiculo } from \"@shared/schema\";\nimport { Badge } from \"@/components/ui/badge\";\n\nexport default function VagasPage() {\n  const filialId = localStorage.getItem(\"selected_filial\");\n\n  const { data: vagas, isLoading } = useQuery<Vaga[]>({\n    queryKey: [\"/api/vagas\", filialId],\n    enabled: !!filialId,\n  });\n\n  const { data: veiculos } = useQuery<Veiculo[]>({\n    queryKey: [\"/api/veiculos\", filialId],\n    enabled: !!filialId,\n  });\n\n  const getVeiculoByVaga = (vagaId: string) => {\n    return veiculos?.find((v) => v.vagaId === vagaId && !v.dataSaida);\n  };\n\n  const vagasLivres = vagas?.filter((v) => v.status === \"livre\").length || 0;\n  const vagasOcupadas = vagas?.filter((v) => v.status === \"ocupada\").length || 0;\n  const totalVagas = vagas?.length || 0;\n  const ocupacaoPercent = totalVagas > 0 ? Math.round((vagasOcupadas / totalVagas) * 100) : 0;\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[60vh]\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Header */}\n      <div>\n        <h1 className=\"text-3xl font-bold text-foreground\">Mapa de Vagas</h1>\n        <p className=\"text-muted-foreground\">Visualização em tempo real das vagas do pátio</p>\n      </div>\n\n      {/* Stats */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Total de Vagas</CardDescription>\n            <CardTitle className=\"text-3xl\">{totalVagas}</CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Vagas Livres</CardDescription>\n            <CardTitle className=\"text-3xl text-emerald-600\">{vagasLivres}</CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Vagas Ocupadas</CardDescription>\n            <CardTitle className=\"text-3xl text-rose-600\">{vagasOcupadas}</CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Taxa de Ocupação</CardDescription>\n            <CardTitle className=\"text-3xl\">{ocupacaoPercent}%</CardTitle>\n          </CardHeader>\n        </Card>\n      </div>\n\n      {/* Mapa de Vagas */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Vagas Disponíveis</CardTitle>\n          <CardDescription>Clique em uma vaga para ver detalhes</CardDescription>\n        </CardHeader>\n        <CardContent>\n          {vagas && vagas.length > 0 ? (\n            <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4\">\n              {vagas.map((vaga) => {\n                const veiculo = getVeiculoByVaga(vaga.id);\n                const isOcupada = vaga.status === \"ocupada\";\n\n                return (\n                  <div\n                    key={vaga.id}\n                    className={`relative aspect-square rounded-lg border-2 p-4 transition-all hover-elevate cursor-pointer ${\n                      isOcupada\n                        ? \"border-rose-300 bg-rose-50 dark:border-rose-800 dark:bg-rose-950/30\"\n                        : \"border-emerald-300 bg-emerald-50 dark:border-emerald-800 dark:bg-emerald-950/30\"\n                    }`}\n                    data-testid={`vaga-${vaga.numero}`}\n                  >\n                    <div className=\"flex flex-col items-center justify-center h-full gap-2\">\n                      <div className=\"flex items-center gap-1\">\n                        <MapPin className={`h-5 w-5 ${isOcupada ? \"text-rose-600\" : \"text-emerald-600\"}`} />\n                        <span className=\"text-2xl font-bold\">{vaga.numero}</span>\n                      </div>\n                      <StatusBadge status={vaga.status} type=\"vaga\" />\n                      {veiculo && (\n                        <div className=\"mt-2 text-center space-y-1\">\n                          <Badge variant=\"secondary\" className=\"text-xs\">\n                            {veiculo.placaCavalo}\n                          </Badge>\n                          <p className=\"text-xs text-muted-foreground truncate max-w-full px-1\">\n                            {veiculo.motorista}\n                          </p>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          ) : (\n            <div className=\"text-center py-12\">\n              <MapPin className=\"h-12 w-12 text-muted-foreground mx-auto mb-4 opacity-50\" />\n              <p className=\"text-muted-foreground\">Nenhuma vaga cadastrada</p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Legenda */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-lg\">Legenda</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex flex-wrap gap-6\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"h-4 w-4 rounded bg-emerald-200 border-2 border-emerald-300 dark:bg-emerald-950 dark:border-emerald-800\"></div>\n              <span className=\"text-sm text-muted-foreground\">Vaga Livre</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <div className=\"h-4 w-4 rounded bg-rose-200 border-2 border-rose-300 dark:bg-rose-950 dark:border-rose-800\"></div>\n              <span className=\"text-sm text-muted-foreground\">Vaga Ocupada</span>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":5935},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5741},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"design_guidelines.md":{"content":"# APP RETROPATIO - Design Guidelines\n\n## Design Approach\n\n**Selected System**: Material Design + Linear-inspired minimalism for operational dashboards\n**Rationale**: Logistics operations require clear information hierarchy, quick data scanning, and reliable interaction patterns. Material Design provides robust components for data-heavy interfaces, while Linear's clean aesthetic ensures the UI doesn't overwhelm operators during long shifts.\n\n**Core Principles**:\n- Operational Clarity: Every element serves a functional purpose\n- Scannable Information: Data tables and status indicators must be immediately readable\n- Consistent Patterns: Reduce cognitive load with predictable interactions\n- Real-time Awareness: Clear visual feedback for live updates\n\n---\n\n## Typography System\n\n**Font Family**: Inter (via Google Fonts CDN) - excellent legibility for data-dense interfaces\n\n**Hierarchy**:\n- Page Titles: text-3xl, font-bold (e.g., \"Controle de Portaria\")\n- Section Headers: text-xl, font-semibold (e.g., \"Veículos no Pátio\")\n- Card/Panel Titles: text-lg, font-medium\n- Body Text: text-base, font-normal (forms, descriptions)\n- Data Labels: text-sm, font-medium, uppercase, tracking-wide\n- Table Data: text-sm, font-normal\n- Metadata/Timestamps: text-xs, font-normal\n\n---\n\n## Layout System\n\n**Spacing Primitives**: Consistent use of Tailwind units: 2, 4, 6, 8, 12, 16, 24\n- Component padding: p-4 or p-6\n- Section gaps: gap-6 or gap-8\n- Page margins: px-6 lg:px-8\n- Card spacing: space-y-4\n\n**Grid Structure**:\n- Dashboard Layout: Sidebar (w-64) + Main Content (flex-1)\n- Responsive: Collapsible sidebar on mobile (hamburger menu)\n- Max-width containers: max-w-7xl mx-auto for content areas\n\n---\n\n## Navigation & Layout Structure\n\n**Top Navigation Bar** (h-16, fixed):\n- Logo/Brand (left)\n- Current Branch indicator with dropdown (center-left)\n- User profile menu with role badge (right)\n- Notification bell icon with unread count badge (right)\n\n**Sidebar Navigation** (persistent on desktop, collapsible on mobile):\n- Grouped by user role\n- Active state: subtle highlight, border-l-4 accent\n- Icon + label pattern using Heroicons\n- Bottom section: Settings, Help, Logout\n\n**Main Content Area**:\n- Page header with breadcrumbs\n- Action toolbar (filters, export, primary actions)\n- Content grid or table\n\n---\n\n## Component Library\n\n### Dashboard Cards\n- Rounded corners: rounded-lg\n- Elevation: shadow-sm with hover:shadow-md transition\n- Padding: p-6\n- Structure: Header with title + action menu, body content, optional footer\n\n### Status Badges\n- Pill shape: rounded-full, px-3, py-1, text-xs font-medium\n- States: \"Livre\" (success), \"Ocupado\" (warning), \"Aguardando\" (neutral), \"Aprovado\" (info)\n- Use semantic meaning without color references\n\n### Data Tables\n- Zebra striping for rows\n- Sticky header: sticky top-0 with backdrop blur\n- Row hover state for interactivity\n- Compact mode: py-2 for dense data\n- Action column (right-aligned) with icon buttons\n\n### Forms\n- Grouped in sections with subtle dividers\n- Label above input: text-sm font-medium mb-1\n- Input fields: rounded-md border, px-3 py-2, focus:ring-2 transition\n- Required fields: asterisk indicator\n- Inline validation messages below fields\n- Form actions: Right-aligned button group (Cancel + Submit)\n\n### Mapa de Vagas (Vacancy Map)\n- Grid layout representing dock positions\n- Each slot: Aspect square card with large slot number\n- Visual states: Empty (outline), Occupied (filled), Selected (highlight)\n- Click interaction for slot selection\n- Real-time pulse animation on status change (subtle)\n\n### Modal Dialogs\n- Overlay: backdrop-blur-sm\n- Modal: max-w-2xl, rounded-xl, p-6\n- Header: text-lg font-semibold with close button\n- Footer: Button group (right-aligned)\n\n### Notification Toast\n- Fixed position: top-4 right-4\n- Auto-dismiss after 5s\n- Icon + message + dismiss button\n- Slide-in animation from right\n\n### Real-time Indicators\n- Pulsing dot icon for live updates\n- \"Atualizado há X minutos\" timestamp in metadata style\n- Subtle flash animation on new data arrival\n\n---\n\n## Page-Specific Layouts\n\n### Login Page\n- Centered card: max-w-md mx-auto, mt-32\n- Logo above form\n- Email and password fields stacked\n- \"Esqueci minha senha\" link below\n- Full-width submit button\n- Error messages inline above button\n\n### Seleção de Filial\n- Grid of branch cards: grid-cols-1 md:grid-cols-2 lg:grid-cols-3, gap-6\n- Each card: Branch name, address, status indicator\n- Search/filter bar above grid\n- Selected state: ring-2 highlight\n\n### Portaria (Gate Control)\n- Two-column layout: Form (left, w-1/3) + Mapa de Vagas (right, w-2/3)\n- Tabbed interface: \"Nova Entrada\" | \"Saída\" | \"Histórico Hoje\"\n- Sticky action bar at bottom of form\n- Live activity feed in sidebar showing recent entries/exits\n\n### Cliente Dashboard\n- Summary cards row: grid-cols-4 showing key metrics (Veículos Ativos, Pendentes, etc.)\n- Main content: Tabbed view (Movimentações | Relatórios | Chamadas)\n- Filtros panel: Collapsible sidebar with filter options\n\n### Gestor/Admin\n- Tab navigation: \"Usuários\" | \"Filiais\" | \"Permissões\" | \"Auditoria\"\n- Data table as primary content\n- Floating action button (+) for new entries\n- Bulk actions toolbar appears on row selection\n\n### Relatórios\n- Filter panel (top): Inline form fields in row\n- Export buttons: CSV, PDF icons with labels\n- Results table with pagination\n- Empty state: Centered illustration + helpful text\n\n---\n\n## Responsive Behavior\n\n**Breakpoints**:\n- Mobile: < 768px (single column, hamburger menu, stacked forms)\n- Tablet: 768px-1024px (sidebar collapsible, 2-column grids)\n- Desktop: > 1024px (full sidebar, multi-column layouts)\n\n**Mobile Optimizations**:\n- Bottom navigation bar for primary actions\n- Swipeable cards for vacancy map\n- Simplified table views (cards instead of tables)\n- Floating action button for primary actions\n\n---\n\n## Icons\n**Library**: Heroicons (via CDN)\n- Outline style for navigation and secondary actions\n- Solid style for status indicators and primary buttons\n\n---\n\n## Accessibility\n- All form inputs include visible labels\n- Focus states: ring-2 with offset\n- Keyboard navigation fully supported\n- ARIA labels for icon-only buttons\n- Skip to main content link\n- Sufficient contrast ratios throughout\n\n---\n\n## Images\nNo hero images required for this operational dashboard. Focus on data visualization and functional UI elements. Avatars for user profiles should use initials or placeholder icons from Heroicons.","size_bytes":6467},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1592},"client/src/lib/protected-route.tsx":{"content":"// Reference: blueprint:javascript_auth_all_persistance\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { Loader2 } from \"lucide-react\";\nimport { Redirect, Route } from \"wouter\";\n\nexport function ProtectedRoute({\n  path,\n  component: Component,\n}: {\n  path: string;\n  component: () => React.JSX.Element;\n}) {\n  const { user, isLoading } = useAuth();\n\n  if (isLoading) {\n    return (\n      <Route path={path}>\n        <div className=\"flex items-center justify-center min-h-screen bg-background\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n        </div>\n      </Route>\n    );\n  }\n\n  if (!user) {\n    return (\n      <Route path={path}>\n        <Redirect to=\"/auth\" />\n      </Route>\n    );\n  }\n\n  return <Route path={path}><Component /></Route>;\n}\n","size_bytes":774},"server/routes.ts":{"content":"// Reference: blueprint:javascript_websocket\nimport type { Express, Request, Response, NextFunction } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { WebSocketServer, WebSocket } from \"ws\";\nimport { storage } from \"./storage\";\nimport {\n  hashPassword,\n  comparePasswords,\n  generateAccessToken,\n  generateRefreshToken,\n  verifyToken,\n  sanitizeUser,\n  requireAuth,\n  requireRole,\n} from \"./auth\";\nimport {\n  loginSchema,\n  registerSchema,\n  refreshTokenRequestSchema,\n  insertUserSchema,\n  insertFilialSchema,\n  insertVeiculoSchema,\n  insertVagaSchema,\n  insertVisitanteSchema,\n  insertChamadaSchema,\n  insertMotoristaSchema,\n  insertVeiculoCadastroSchema,\n  insertFornecedorSchema,\n  insertStatusCaminhaoSchema,\n  type User,\n} from \"@shared/schema\";\nimport { fromZodError } from \"zod-validation-error\";\n\n// Middleware to validate Zod schema\nfunction validateBody(schema: any) {\n  return (req: Request, res: Response, next: NextFunction) => {\n    const result = schema.safeParse(req.body);\n    if (!result.success) {\n      const validationError = fromZodError(result.error);\n      return res.status(400).json({ error: validationError.message });\n    }\n    req.body = result.data;\n    next();\n  };\n}\n\n// Middleware to enforce X-Filial header for multi-tenant isolation\nasync function requireFilial(req: Request, res: Response, next: NextFunction) {\n  const filialId = req.headers[\"x-filial\"] as string;\n  const user = (req as any).user as User | undefined;\n  \n  if (!filialId) {\n    return res.status(400).json({ error: \"Header X-Filial é obrigatório\" });\n  }\n  \n  // Validate that the user has access to this filial\n  if (user) {\n    const userFiliais = await storage.getUserFilialIds(user.id);\n    if (!userFiliais.includes(filialId)) {\n      return res.status(403).json({ error: \"Acesso negado a esta filial\" });\n    }\n  }\n  \n  (req as any).filialId = filialId;\n  next();\n}\n\n// Middleware to log audit\nasync function logAudit(req: Request, acao: string, entidade: string, entidadeId?: string, dadosAntes?: any, dadosDepois?: any) {\n  const user = (req as any).user as User | undefined;\n  if (!user) return;\n  \n  const filialId = (req as any).filialId as string | undefined;\n  \n  await storage.createAuditLog({\n    userId: user.id,\n    filialId: filialId || null,\n    acao,\n    entidade,\n    entidadeId: entidadeId || null,\n    dadosAntes: dadosAntes ? JSON.stringify(dadosAntes) : null,\n    dadosDepois: dadosDepois ? JSON.stringify(dadosDepois) : null,\n    ipAddress: req.ip || req.socket.remoteAddress || null,\n    userAgent: req.headers[\"user-agent\"] || null,\n  });\n}\n\nexport function registerRoutes(app: Express): Server {\n  // Clean up expired tokens periodically (every hour)\n  setInterval(async () => {\n    try {\n      await storage.deleteExpiredTokens();\n    } catch (error) {\n      console.error(\"Error cleaning up expired tokens:\", error);\n    }\n  }, 60 * 60 * 1000);\n\n  // ==================== Authentication Routes ====================\n  \n  // DISABLED: Public registration disabled. Only admins can create users via /api/users\n  // app.post(\"/api/register\", validateBody(registerSchema), async (req, res, next) => {\n  //   try {\n  //     const existingUser = await storage.getUserByUsername(req.body.username);\n  //     if (existingUser) {\n  //       return res.status(400).json({ error: \"Nome de usuário já existe\" });\n  //     }\n\n  //     const existingEmail = await storage.getUserByEmail(req.body.email);\n  //     if (existingEmail) {\n  //       return res.status(400).json({ error: \"E-mail já cadastrado\" });\n  //     }\n\n  //     const user = await storage.createUser({\n  //       ...req.body,\n  //       role: \"cliente\", // Default role, admin can change later\n  //       password: await hashPassword(req.body.password),\n  //     });\n\n  //     const accessToken = generateAccessToken(user);\n  //     const refreshToken = generateRefreshToken(user);\n\n  //     // Store refresh token\n  //     const expiresAt = new Date();\n  //     expiresAt.setDate(expiresAt.getDate() + 7); // 7 days\n  //     await storage.createRefreshToken({\n  //       userId: user.id,\n  //       token: refreshToken,\n  //       expiresAt,\n  //     });\n\n  //     await logAudit(req, \"REGISTRO\", \"users\", user.id, null, user);\n\n  //     res.status(201).json({\n  //       user: sanitizeUser(user),\n  //       accessToken,\n  //       refreshToken,\n  //     });\n  //   } catch (error) {\n  //     next(error);\n  //   }\n  // });\n\n  app.post(\"/api/login\", validateBody(loginSchema), async (req, res, next) => {\n    try {\n      const user = await storage.getUserByUsername(req.body.username);\n      \n      if (!user) {\n        return res.status(401).json({ error: \"Usuário não encontrado\" });\n      }\n\n      // Check if account is locked\n      if (user.lockedUntil && user.lockedUntil > new Date()) {\n        return res.status(401).json({ error: \"Conta bloqueada. Tente novamente mais tarde.\" });\n      }\n\n      const passwordMatch = await comparePasswords(req.body.password, user.password);\n      \n      if (!passwordMatch) {\n        await storage.incrementLoginAttempts(user.id);\n        return res.status(401).json({ error: \"Senha incorreta\" });\n      }\n\n      if (!user.ativo) {\n        return res.status(401).json({ error: \"Usuário inativo\" });\n      }\n\n      // Reset login attempts on successful login\n      await storage.resetLoginAttempts(user.id);\n\n      const accessToken = generateAccessToken(user);\n      const refreshToken = generateRefreshToken(user);\n\n      // Store refresh token\n      const expiresAt = new Date();\n      expiresAt.setDate(expiresAt.getDate() + 7); // 7 days\n      await storage.createRefreshToken({\n        userId: user.id,\n        token: refreshToken,\n        expiresAt,\n      });\n\n      (req as any).user = user;\n      await logAudit(req, \"LOGIN\", \"users\", user.id);\n\n      res.json({\n        user: sanitizeUser(user),\n        accessToken,\n        refreshToken,\n      });\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.post(\"/api/refresh\", validateBody(refreshTokenRequestSchema), async (req, res, next) => {\n    try {\n      const { refreshToken } = req.body;\n      \n      const storedToken = await storage.getRefreshToken(refreshToken);\n      \n      if (!storedToken) {\n        return res.status(401).json({ error: \"Refresh token inválido\" });\n      }\n\n      if (storedToken.expiresAt < new Date()) {\n        await storage.deleteRefreshToken(refreshToken);\n        return res.status(401).json({ error: \"Refresh token expirado\" });\n      }\n\n      const user = await storage.getUser(storedToken.userId);\n      \n      if (!user || !user.ativo) {\n        return res.status(401).json({ error: \"Usuário inválido ou inativo\" });\n      }\n\n      const newAccessToken = generateAccessToken(user);\n\n      res.json({\n        accessToken: newAccessToken,\n      });\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.post(\"/api/logout\", requireAuth, async (req, res, next) => {\n    try {\n      const authHeader = req.headers.authorization;\n      if (authHeader) {\n        const refreshToken = req.body.refreshToken;\n        if (refreshToken) {\n          await storage.deleteRefreshToken(refreshToken);\n        }\n      }\n      \n      const user = (req as any).user;\n      await logAudit(req, \"LOGOUT\", \"users\", user?.id);\n      \n      res.sendStatus(200);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.get(\"/api/user\", requireAuth, (req, res) => {\n    const user = (req as any).user as User;\n    res.json(sanitizeUser(user));\n  });\n\n  // ==================== Users Routes ====================\n  \n  app.get(\"/api/users\", requireAuth, requireRole(\"gestor\"), async (req, res, next) => {\n    try {\n      const users = await storage.getAllUsers();\n      res.json(users.map(sanitizeUser));\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.post(\"/api/users\", requireAuth, requireRole(\"gestor\"), validateBody(insertUserSchema), async (req, res, next) => {\n    try {\n      const user = await storage.createUser({\n        ...req.body,\n        password: await hashPassword(req.body.password),\n      });\n      \n      await logAudit(req, \"CRIAR_USUARIO\", \"users\", user.id, null, user);\n      res.status(201).json(sanitizeUser(user));\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.patch(\"/api/users/:id\", requireAuth, requireRole(\"gestor\"), async (req, res, next) => {\n    try {\n      const userBefore = await storage.getUser(req.params.id);\n      \n      // If updating password, hash it\n      const updateData = { ...req.body };\n      if (updateData.password) {\n        updateData.password = await hashPassword(updateData.password);\n      }\n      \n      const user = await storage.updateUser(req.params.id, updateData);\n      \n      await logAudit(req, \"ATUALIZAR_USUARIO\", \"users\", user.id, userBefore, user);\n      res.json(sanitizeUser(user));\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.get(\"/api/user-filiais\", requireAuth, async (req, res, next) => {\n    try {\n      const user = (req as any).user as User;\n      const filialIds = await storage.getUserFilialIds(user.id);\n      res.json(filialIds);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  // ==================== User Permissions Routes ====================\n  \n  // Get all permissions for a user (with filial details)\n  app.get(\"/api/users/:userId/permissions\", requireAuth, requireRole(\"gestor\"), async (req, res, next) => {\n    try {\n      const currentUser = (req as any).user as User;\n      const currentUserFilials = await storage.getUserFilialIds(currentUser.id);\n      \n      // Get all permissions but only return those for filials the current user has access to\n      const allPermissions = await storage.getUserPermissions(req.params.userId);\n      const filteredPermissions = allPermissions.filter(p => currentUserFilials.includes(p.filialId));\n      \n      res.json(filteredPermissions);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  // Add permission for a user\n  app.post(\"/api/users/:userId/permissions\", requireAuth, requireRole(\"gestor\"), async (req, res, next) => {\n    try {\n      const currentUser = (req as any).user as User;\n      const { filialId } = req.body;\n      \n      if (!filialId) {\n        return res.status(400).json({ error: \"filialId é obrigatório\" });\n      }\n\n      // Verify that the current gestor has access to the filial they're trying to assign\n      const currentUserFilials = await storage.getUserFilialIds(currentUser.id);\n      if (!currentUserFilials.includes(filialId)) {\n        return res.status(403).json({ error: \"Você não tem permissão para atribuir acesso a esta filial\" });\n      }\n\n      const permission = await storage.createUserPermission({\n        userId: req.params.userId,\n        filialId,\n      });\n      \n      await logAudit(req, \"ADICIONAR_PERMISSAO_USUARIO\", \"user_permissions\", permission.id, null, permission);\n      res.status(201).json(permission);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  // Delete a user permission\n  app.delete(\"/api/user-permissions/:id\", requireAuth, requireRole(\"gestor\"), async (req, res, next) => {\n    try {\n      const currentUser = (req as any).user as User;\n      \n      // Get the permission to verify the gestor has access to that filial\n      const permission = await storage.getUserPermission(req.params.id);\n      \n      if (!permission) {\n        return res.status(404).json({ error: \"Permissão não encontrada\" });\n      }\n      \n      // Verify that the current gestor has access to the filial\n      const currentUserFilials = await storage.getUserFilialIds(currentUser.id);\n      if (!currentUserFilials.includes(permission.filialId)) {\n        return res.status(403).json({ error: \"Você não tem permissão para remover acesso a esta filial\" });\n      }\n\n      await storage.deleteUserPermission(req.params.id);\n      await logAudit(req, \"REMOVER_PERMISSAO_USUARIO\", \"user_permissions\", req.params.id, null, null);\n      res.status(204).send();\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  // ==================== Filiais Routes ====================\n  \n  app.get(\"/api/filiais\", requireAuth, async (req, res, next) => {\n    try {\n      const filiais = await storage.getAllFiliais();\n      res.json(filiais);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.post(\"/api/filiais\", requireAuth, requireRole(\"gestor\"), validateBody(insertFilialSchema), async (req, res, next) => {\n    try {\n      const filial = await storage.createFilial(req.body);\n      \n      await logAudit(req, \"CRIAR_FILIAL\", \"filiais\", filial.id, null, filial);\n      res.status(201).json(filial);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.patch(\"/api/filiais/:id\", requireAuth, requireRole(\"gestor\"), async (req, res, next) => {\n    try {\n      const filialBefore = await storage.getFilial(req.params.id);\n      const filial = await storage.updateFilial(req.params.id, req.body);\n      \n      await logAudit(req, \"ATUALIZAR_FILIAL\", \"filiais\", filial.id, filialBefore, filial);\n      res.json(filial);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  // ==================== Veiculos Routes ====================\n  \n  app.get(\"/api/veiculos/all\", requireAuth, requireRole(\"gestor\"), requireFilial, async (req, res, next) => {\n    try {\n      const filialId = (req as any).filialId as string;\n      const veiculos = await storage.getVeiculosByFilial(filialId);\n      res.json(veiculos);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.get(\"/api/veiculos\", requireAuth, requireFilial, async (req, res, next) => {\n    try {\n      const filialId = (req as any).filialId as string;\n      const veiculos = await storage.getVeiculosByFilial(filialId);\n      res.json(veiculos);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.post(\"/api/veiculos\", requireAuth, requireFilial, validateBody(insertVeiculoSchema), async (req, res, next) => {\n    try {\n      const user = (req as any).user as User;\n      const filialId = (req as any).filialId as string;\n      \n      const veiculo = await storage.createVeiculo({\n        ...req.body,\n        filialId,\n        registradoPor: user.id,\n      });\n      \n      await logAudit(req, \"REGISTRAR_ENTRADA_VEICULO\", \"veiculos\", veiculo.id, null, veiculo);\n      \n      // Broadcast to WebSocket clients (only to this filial)\n      broadcastToClients({ type: \"veiculo_entrada\", data: veiculo }, veiculo.filialId);\n      \n      res.status(201).json(veiculo);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.patch(\"/api/veiculos/:id/saida\", requireAuth, requireFilial, async (req, res, next) => {\n    try {\n      const filialId = (req as any).filialId as string;\n      const veiculoBefore = await storage.getVeiculo(req.params.id);\n      \n      if (!veiculoBefore) {\n        return res.status(404).json({ error: \"Veículo não encontrado\" });\n      }\n      \n      if (veiculoBefore.filialId !== filialId) {\n        return res.status(403).json({ error: \"Acesso negado a este veículo\" });\n      }\n      \n      // Aceita dados opcionais de CTE, NF, LACRE do req.body\n      const { cte, nf, lacre } = req.body;\n      const veiculo = await storage.registrarSaida(req.params.id, { cte, nf, lacre });\n      \n      await logAudit(req, \"REGISTRAR_SAIDA_VEICULO\", \"veiculos\", veiculo.id, veiculoBefore, veiculo);\n      \n      // Broadcast to WebSocket clients (only to this filial)\n      broadcastToClients({ type: \"veiculo_saida\", data: veiculo }, veiculo.filialId);\n      \n      res.json(veiculo);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  // ==================== Vagas Routes ====================\n  \n  app.get(\"/api/vagas/all\", requireAuth, requireRole(\"gestor\"), async (req, res, next) => {\n    try {\n      const vagas = await storage.getAllVagas();\n      res.json(vagas);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.get(\"/api/vagas\", requireAuth, requireFilial, async (req, res, next) => {\n    try {\n      const filialId = (req as any).filialId as string;\n      const vagas = await storage.getVagasByFilial(filialId);\n      res.json(vagas);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.post(\"/api/vagas\", requireAuth, requireRole(\"gestor\"), requireFilial, validateBody(insertVagaSchema), async (req, res, next) => {\n    try {\n      const filialId = (req as any).filialId as string;\n      \n      const vaga = await storage.createVaga({\n        ...req.body,\n        filialId,\n      });\n      \n      await logAudit(req, \"CRIAR_VAGA\", \"vagas\", vaga.id, null, vaga);\n      \n      // Broadcast to WebSocket clients (only to this filial)\n      broadcastToClients({ type: \"vaga_created\", data: vaga }, vaga.filialId);\n      \n      res.status(201).json(vaga);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.patch(\"/api/vagas/:id\", requireAuth, requireFilial, async (req, res, next) => {\n    try {\n      const filialId = (req as any).filialId as string;\n      const vagaBefore = await storage.getVaga(req.params.id);\n      \n      if (!vagaBefore) {\n        return res.status(404).json({ error: \"Vaga não encontrada\" });\n      }\n      \n      if (vagaBefore.filialId !== filialId) {\n        return res.status(403).json({ error: \"Acesso negado a esta vaga\" });\n      }\n      \n      // Prevent filialId from being changed via PATCH\n      const { filialId: _, ...updateData } = req.body;\n      const vaga = await storage.updateVaga(req.params.id, updateData);\n      \n      await logAudit(req, \"ATUALIZAR_VAGA\", \"vagas\", vaga.id, vagaBefore, vaga);\n      \n      // Broadcast to WebSocket clients (only to this filial)\n      broadcastToClients({ type: \"vaga_updated\", data: vaga }, vaga.filialId);\n      \n      res.json(vaga);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.delete(\"/api/vagas/:id\", requireAuth, requireRole(\"gestor\"), requireFilial, async (req, res, next) => {\n    try {\n      const filialId = (req as any).filialId as string;\n      const vaga = await storage.getVaga(req.params.id);\n      \n      if (!vaga) {\n        return res.status(404).json({ error: \"Vaga não encontrada\" });\n      }\n      \n      if (vaga.filialId !== filialId) {\n        return res.status(403).json({ error: \"Acesso negado a esta vaga\" });\n      }\n\n      // Check if vaga is occupied\n      if (vaga.status === \"ocupada\") {\n        return res.status(400).json({ error: \"Não é possível deletar uma vaga ocupada\" });\n      }\n\n      await storage.deleteVaga(req.params.id);\n      \n      await logAudit(req, \"DELETAR_VAGA\", \"vagas\", vaga.id, vaga, null);\n      \n      // Broadcast to WebSocket clients (only to this filial)\n      broadcastToClients({ type: \"vaga_deleted\", data: { id: vaga.id } }, vaga.filialId);\n      \n      res.status(204).send();\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  // ==================== Visitantes Routes ====================\n  \n  app.get(\"/api/visitantes\", requireAuth, requireFilial, async (req, res, next) => {\n    try {\n      const filialId = (req as any).filialId as string;\n      const visitantes = await storage.getVisitantesByFilial(filialId);\n      res.json(visitantes);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.post(\"/api/visitantes\", requireAuth, requireFilial, validateBody(insertVisitanteSchema), async (req, res, next) => {\n    try {\n      const filialId = (req as any).filialId as string;\n      \n      const visitante = await storage.createVisitante({\n        ...req.body,\n        filialId,\n      });\n      \n      await logAudit(req, \"CRIAR_VISITANTE\", \"visitantes\", visitante.id, null, visitante);\n      \n      // Broadcast to WebSocket clients (only to this filial)\n      broadcastToClients({ type: \"visitante_novo\", data: visitante }, visitante.filialId);\n      \n      // Create notification for gestores of this filial if visitor is awaiting approval\n      if (visitante.status === \"aguardando\") {\n        // Get all users and filter for active gestores\n        const allUsers = await storage.getAllUsers();\n        const gestores = allUsers.filter(u => u.role === \"gestor\" && u.ativo);\n        \n        // Create notification only for gestores with permission in this filial\n        for (const gestor of gestores) {\n          const gestorFilialIds = await storage.getUserFilialIds(gestor.id);\n          \n          // Only notify if gestor has access to this filial\n          if (gestorFilialIds.includes(filialId)) {\n            await storage.createNotification({\n              userId: gestor.id,\n              filialId: filialId,\n              tipo: \"visitante_aprovacao\",\n              titulo: \"Novo visitante aguardando aprovação\",\n              mensagem: `${visitante.nome} (${visitante.tipoVisita}) aguarda aprovação para entrada.`,\n              status: \"nao_lida\",\n              entidadeId: visitante.id,\n              entidadeTipo: \"visitante\",\n              actionUrl: `/visitantes`,\n            });\n            // Note: Notification not broadcasted via WebSocket for security.\n            // Frontend will poll /api/notifications/unread-count periodically.\n          }\n        }\n      }\n      \n      res.status(201).json(visitante);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.patch(\"/api/visitantes/:id/aprovar\", requireAuth, requireRole(\"porteiro\", \"gestor\"), requireFilial, async (req, res, next) => {\n    try {\n      const user = (req as any).user as User;\n      const filialId = (req as any).filialId as string;\n      const visitanteBefore = await storage.getVisitante(req.params.id);\n      \n      if (!visitanteBefore) {\n        return res.status(404).json({ error: \"Visitante não encontrado\" });\n      }\n      \n      if (visitanteBefore.filialId !== filialId) {\n        return res.status(403).json({ error: \"Acesso negado a este visitante\" });\n      }\n      \n      const visitante = await storage.updateVisitante(req.params.id, {\n        status: \"aprovado\",\n        aprovadoPor: user.id,\n        dataAprovacao: new Date(),\n      });\n      \n      await logAudit(req, \"APROVAR_VISITANTE\", \"visitantes\", visitante.id, visitanteBefore, visitante);\n      \n      // Broadcast to WebSocket clients (only to this filial)\n      broadcastToClients({ type: \"visitante_aprovado\", data: visitante }, visitante.filialId);\n      \n      res.json(visitante);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.patch(\"/api/visitantes/:id/entrada\", requireAuth, requireRole(\"porteiro\", \"gestor\"), requireFilial, async (req, res, next) => {\n    try {\n      const filialId = (req as any).filialId as string;\n      const visitanteBefore = await storage.getVisitante(req.params.id);\n      \n      if (!visitanteBefore) {\n        return res.status(404).json({ error: \"Visitante não encontrado\" });\n      }\n      \n      if (visitanteBefore.filialId !== filialId) {\n        return res.status(403).json({ error: \"Acesso negado a este visitante\" });\n      }\n      \n      const visitante = await storage.updateVisitante(req.params.id, {\n        status: \"dentro\",\n        dataEntrada: new Date(),\n      });\n      \n      await logAudit(req, \"REGISTRAR_ENTRADA_VISITANTE\", \"visitantes\", visitante.id, visitanteBefore, visitante);\n      \n      // Broadcast to WebSocket clients (only to this filial)\n      broadcastToClients({ type: \"visitante_entrada\", data: visitante }, visitante.filialId);\n      \n      res.json(visitante);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.patch(\"/api/visitantes/:id/saida\", requireAuth, requireRole(\"porteiro\", \"gestor\"), requireFilial, async (req, res, next) => {\n    try {\n      const filialId = (req as any).filialId as string;\n      const visitanteBefore = await storage.getVisitante(req.params.id);\n      \n      if (!visitanteBefore) {\n        return res.status(404).json({ error: \"Visitante não encontrado\" });\n      }\n      \n      if (visitanteBefore.filialId !== filialId) {\n        return res.status(403).json({ error: \"Acesso negado a este visitante\" });\n      }\n      \n      const visitante = await storage.updateVisitante(req.params.id, {\n        status: \"saiu\",\n        dataSaida: new Date(),\n      });\n      \n      await logAudit(req, \"REGISTRAR_SAIDA_VISITANTE\", \"visitantes\", visitante.id, visitanteBefore, visitante);\n      \n      // Broadcast to WebSocket clients (only to this filial)\n      broadcastToClients({ type: \"visitante_saida\", data: visitante }, visitante.filialId);\n      \n      res.json(visitante);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  // ==================== Chamadas Routes ====================\n  \n  app.get(\"/api/chamadas\", requireAuth, requireFilial, async (req, res, next) => {\n    try {\n      const filialId = (req as any).filialId as string;\n      const chamadas = await storage.getChamadasByFilial(filialId);\n      res.json(chamadas);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.post(\"/api/chamadas\", requireAuth, requireFilial, validateBody(insertChamadaSchema), async (req, res, next) => {\n    try {\n      const user = (req as any).user as User;\n      const filialId = (req as any).filialId as string;\n      \n      const chamada = await storage.createChamada({\n        ...req.body,\n        filialId,\n        criadoPor: user.id,\n      });\n      \n      await logAudit(req, \"CRIAR_CHAMADA\", \"chamadas\", chamada.id, null, chamada);\n      \n      // Broadcast to WebSocket clients (only to this filial)\n      broadcastToClients({ type: \"chamada_nova\", data: chamada }, chamada.filialId);\n      \n      res.status(201).json(chamada);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.patch(\"/api/chamadas/:id/atender\", requireAuth, requireRole(\"porteiro\", \"gestor\"), requireFilial, async (req, res, next) => {\n    try {\n      const user = (req as any).user as User;\n      const filialId = (req as any).filialId as string;\n      const chamadaBefore = await storage.getChamada(req.params.id);\n      \n      if (!chamadaBefore) {\n        return res.status(404).json({ error: \"Chamada não encontrada\" });\n      }\n      \n      if (chamadaBefore.filialId !== filialId) {\n        return res.status(403).json({ error: \"Acesso negado a esta chamada\" });\n      }\n      \n      const chamada = await storage.updateChamada(req.params.id, {\n        status: \"atendida\",\n        atendidoPor: user.id,\n        dataAtendimento: new Date(),\n      });\n      \n      await logAudit(req, \"ATENDER_CHAMADA\", \"chamadas\", chamada.id, chamadaBefore, chamada);\n      \n      // Broadcast to WebSocket clients (only to this filial)\n      broadcastToClients({ type: \"chamada_atendida\", data: chamada }, chamada.filialId);\n      \n      res.json(chamada);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  // ==================== Notifications Routes ====================\n  \n  // Get all notifications for current user\n  app.get(\"/api/notifications\", requireAuth, async (req, res, next) => {\n    try {\n      const user = (req as any).user as User;\n      const notifications = await storage.getNotificationsByUser(user.id);\n      res.json(notifications);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  // Get unread notifications count\n  app.get(\"/api/notifications/unread-count\", requireAuth, async (req, res, next) => {\n    try {\n      const user = (req as any).user as User;\n      const count = await storage.getUnreadCountByUser(user.id);\n      res.json({ count });\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  // Mark notification as read\n  app.patch(\"/api/notifications/:id/read\", requireAuth, async (req, res, next) => {\n    try {\n      const user = (req as any).user as User;\n      const { id } = req.params;\n      \n      // Verify ownership\n      const notification = await storage.getNotification(id);\n      if (!notification) {\n        return res.status(404).json({ error: \"Notificação não encontrada\" });\n      }\n      if (notification.userId !== user.id) {\n        return res.status(403).json({ error: \"Você não tem permissão para acessar esta notificação\" });\n      }\n      \n      const updated = await storage.markAsRead(id);\n      res.json(updated);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  // Mark all notifications as read\n  app.patch(\"/api/notifications/read-all\", requireAuth, async (req, res, next) => {\n    try {\n      const user = (req as any).user as User;\n      await storage.markAllAsRead(user.id);\n      res.json({ success: true });\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  // Delete notification\n  app.delete(\"/api/notifications/:id\", requireAuth, async (req, res, next) => {\n    try {\n      const user = (req as any).user as User;\n      const { id } = req.params;\n      \n      // Verify ownership\n      const notification = await storage.getNotification(id);\n      if (!notification) {\n        return res.status(404).json({ error: \"Notificação não encontrada\" });\n      }\n      if (notification.userId !== user.id) {\n        return res.status(403).json({ error: \"Você não tem permissão para deletar esta notificação\" });\n      }\n      \n      await storage.deleteNotification(id);\n      res.json({ success: true });\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  // ==================== Motoristas Routes ====================\n  \n  app.get(\"/api/motoristas\", requireAuth, requireFilial, async (req, res, next) => {\n    try {\n      const filialId = (req as any).filialId as string;\n      const motoristas = await storage.getMotoristasByFilial(filialId);\n      res.json(motoristas);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.post(\"/api/motoristas\", requireAuth, requireRole(\"gestor\"), requireFilial, validateBody(insertMotoristaSchema), async (req, res, next) => {\n    try {\n      const user = (req as any).user as User;\n      const filialId = (req as any).filialId as string;\n      \n      const motorista = await storage.createMotorista({\n        ...req.body,\n        filialId,\n      });\n\n      await storage.createAuditLog({\n        acao: \"create\",\n        entidade: \"motorista\",\n        entidadeId: motorista.id,\n        userId: user.id,\n        filialId,\n        dadosDepois: JSON.stringify(motorista),\n      });\n\n      res.status(201).json(motorista);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.patch(\"/api/motoristas/:id\", requireAuth, requireRole(\"gestor\"), requireFilial, async (req, res, next) => {\n    try {\n      const user = (req as any).user as User;\n      const filialId = (req as any).filialId as string;\n      const before = await storage.getMotorista(req.params.id);\n      \n      if (!before) {\n        return res.status(404).json({ error: \"Motorista não encontrado\" });\n      }\n      \n      if (before.filialId !== filialId) {\n        return res.status(403).json({ error: \"Acesso negado a este motorista\" });\n      }\n      \n      // Prevent filialId from being changed via PATCH\n      const { filialId: _, ...updateData } = req.body;\n      const motorista = await storage.updateMotorista(req.params.id, updateData);\n\n      await storage.createAuditLog({\n        acao: \"update\",\n        entidade: \"motorista\",\n        entidadeId: motorista.id,\n        userId: user.id,\n        filialId: motorista.filialId,\n        dadosAntes: JSON.stringify(before),\n        dadosDepois: JSON.stringify(motorista),\n      });\n\n      res.json(motorista);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.delete(\"/api/motoristas/:id\", requireAuth, requireRole(\"gestor\"), requireFilial, async (req, res, next) => {\n    try {\n      const user = (req as any).user as User;\n      const filialId = (req as any).filialId as string;\n      const motorista = await storage.getMotorista(req.params.id);\n      \n      if (!motorista) {\n        return res.status(404).json({ error: \"Motorista não encontrado\" });\n      }\n      \n      if (motorista.filialId !== filialId) {\n        return res.status(403).json({ error: \"Acesso negado a este motorista\" });\n      }\n\n      await storage.deleteMotorista(req.params.id);\n\n      await storage.createAuditLog({\n        acao: \"delete\",\n        entidade: \"motorista\",\n        entidadeId: req.params.id,\n        userId: user.id,\n        filialId: motorista.filialId,\n        dadosAntes: JSON.stringify(motorista),\n      });\n\n      res.json({ success: true });\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  // ==================== Veículos Cadastro Routes ====================\n  \n  app.get(\"/api/veiculos-cadastro\", requireAuth, requireFilial, async (req, res, next) => {\n    try {\n      const filialId = (req as any).filialId as string;\n      const veiculos = await storage.getVeiculosCadastroByFilial(filialId);\n      res.json(veiculos);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.post(\"/api/veiculos-cadastro\", requireAuth, requireRole(\"gestor\"), requireFilial, validateBody(insertVeiculoCadastroSchema), async (req, res, next) => {\n    try {\n      const user = (req as any).user as User;\n      const filialId = (req as any).filialId as string;\n      \n      const veiculo = await storage.createVeiculoCadastro({\n        ...req.body,\n        filialId,\n      });\n\n      await storage.createAuditLog({\n        acao: \"create\",\n        entidade: \"veiculo_cadastro\",\n        entidadeId: veiculo.id,\n        userId: user.id,\n        filialId,\n        dadosDepois: JSON.stringify(veiculo),\n      });\n\n      res.status(201).json(veiculo);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.patch(\"/api/veiculos-cadastro/:id\", requireAuth, requireRole(\"gestor\"), requireFilial, async (req, res, next) => {\n    try {\n      const user = (req as any).user as User;\n      const filialId = (req as any).filialId as string;\n      const before = await storage.getVeiculoCadastro(req.params.id);\n      \n      if (!before) {\n        return res.status(404).json({ error: \"Veículo não encontrado\" });\n      }\n      \n      if (before.filialId !== filialId) {\n        return res.status(403).json({ error: \"Acesso negado a este veículo\" });\n      }\n      \n      // Prevent filialId from being changed via PATCH\n      const { filialId: _, ...updateData } = req.body;\n      const veiculo = await storage.updateVeiculoCadastro(req.params.id, updateData);\n\n      await storage.createAuditLog({\n        acao: \"update\",\n        entidade: \"veiculo_cadastro\",\n        entidadeId: veiculo.id,\n        userId: user.id,\n        filialId: veiculo.filialId,\n        dadosAntes: JSON.stringify(before),\n        dadosDepois: JSON.stringify(veiculo),\n      });\n\n      res.json(veiculo);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.delete(\"/api/veiculos-cadastro/:id\", requireAuth, requireRole(\"gestor\"), requireFilial, async (req, res, next) => {\n    try {\n      const user = (req as any).user as User;\n      const filialId = (req as any).filialId as string;\n      const veiculo = await storage.getVeiculoCadastro(req.params.id);\n      \n      if (!veiculo) {\n        return res.status(404).json({ error: \"Veículo não encontrado\" });\n      }\n      \n      if (veiculo.filialId !== filialId) {\n        return res.status(403).json({ error: \"Acesso negado a este veículo\" });\n      }\n\n      await storage.deleteVeiculoCadastro(req.params.id);\n\n      await storage.createAuditLog({\n        acao: \"delete\",\n        entidade: \"veiculo_cadastro\",\n        entidadeId: req.params.id,\n        userId: user.id,\n        filialId: veiculo.filialId,\n        dadosAntes: JSON.stringify(veiculo),\n      });\n\n      res.json({ success: true });\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  // ==================== Fornecedores Routes ====================\n  \n  app.get(\"/api/fornecedores\", requireAuth, requireFilial, async (req, res, next) => {\n    try {\n      const filialId = (req as any).filialId as string;\n      const fornecedores = await storage.getFornecedoresByFilial(filialId);\n      res.json(fornecedores);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.post(\"/api/fornecedores\", requireAuth, requireRole(\"gestor\"), requireFilial, validateBody(insertFornecedorSchema), async (req, res, next) => {\n    try {\n      const user = (req as any).user as User;\n      const filialId = (req as any).filialId as string;\n      \n      const fornecedor = await storage.createFornecedor({\n        ...req.body,\n        filialId,\n      });\n\n      await storage.createAuditLog({\n        acao: \"create\",\n        entidade: \"fornecedor\",\n        entidadeId: fornecedor.id,\n        userId: user.id,\n        filialId,\n        dadosDepois: JSON.stringify(fornecedor),\n      });\n\n      res.status(201).json(fornecedor);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.patch(\"/api/fornecedores/:id\", requireAuth, requireRole(\"gestor\"), requireFilial, async (req, res, next) => {\n    try {\n      const user = (req as any).user as User;\n      const filialId = (req as any).filialId as string;\n      const before = await storage.getFornecedor(req.params.id);\n      \n      if (!before) {\n        return res.status(404).json({ error: \"Fornecedor não encontrado\" });\n      }\n      \n      if (before.filialId !== filialId) {\n        return res.status(403).json({ error: \"Acesso negado a este fornecedor\" });\n      }\n      \n      // Prevent filialId from being changed via PATCH\n      const { filialId: _, ...updateData } = req.body;\n      const fornecedor = await storage.updateFornecedor(req.params.id, updateData);\n\n      await storage.createAuditLog({\n        acao: \"update\",\n        entidade: \"fornecedor\",\n        entidadeId: fornecedor.id,\n        userId: user.id,\n        filialId: fornecedor.filialId,\n        dadosAntes: JSON.stringify(before),\n        dadosDepois: JSON.stringify(fornecedor),\n      });\n\n      res.json(fornecedor);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.delete(\"/api/fornecedores/:id\", requireAuth, requireRole(\"gestor\"), requireFilial, async (req, res, next) => {\n    try {\n      const user = (req as any).user as User;\n      const filialId = (req as any).filialId as string;\n      const fornecedor = await storage.getFornecedor(req.params.id);\n      \n      if (!fornecedor) {\n        return res.status(404).json({ error: \"Fornecedor não encontrado\" });\n      }\n      \n      if (fornecedor.filialId !== filialId) {\n        return res.status(403).json({ error: \"Acesso negado a este fornecedor\" });\n      }\n\n      await storage.deleteFornecedor(req.params.id);\n\n      await storage.createAuditLog({\n        acao: \"delete\",\n        entidade: \"fornecedor\",\n        entidadeId: req.params.id,\n        userId: user.id,\n        filialId: fornecedor.filialId,\n        dadosAntes: JSON.stringify(fornecedor),\n      });\n\n      res.json({ success: true });\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  // ==================== Status Caminhão Routes ====================\n  \n  app.get(\"/api/status-caminhao\", requireAuth, requireFilial, async (req, res, next) => {\n    try {\n      const filialId = (req as any).filialId as string;\n      const status = await storage.getStatusCaminhaoByFilial(filialId);\n      res.json(status);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.post(\"/api/status-caminhao\", requireAuth, requireRole(\"gestor\"), requireFilial, validateBody(insertStatusCaminhaoSchema), async (req, res, next) => {\n    try {\n      const user = (req as any).user as User;\n      const filialId = (req as any).filialId as string;\n      \n      const status = await storage.createStatusCaminhao({\n        ...req.body,\n        filialId,\n      });\n\n      await storage.createAuditLog({\n        acao: \"create\",\n        entidade: \"status_caminhao\",\n        entidadeId: status.id,\n        userId: user.id,\n        filialId,\n        dadosDepois: JSON.stringify(status),\n      });\n\n      res.status(201).json(status);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.patch(\"/api/status-caminhao/:id\", requireAuth, requireRole(\"gestor\"), requireFilial, async (req, res, next) => {\n    try {\n      const user = (req as any).user as User;\n      const filialId = (req as any).filialId as string;\n      const before = await storage.getStatusCaminhao(req.params.id);\n      \n      if (!before) {\n        return res.status(404).json({ error: \"Status não encontrado\" });\n      }\n      \n      if (before.filialId !== filialId) {\n        return res.status(403).json({ error: \"Acesso negado a este status\" });\n      }\n      \n      // Prevent filialId from being changed via PATCH\n      const { filialId: _, ...updateData } = req.body;\n      const status = await storage.updateStatusCaminhao(req.params.id, updateData);\n\n      await storage.createAuditLog({\n        acao: \"update\",\n        entidade: \"status_caminhao\",\n        entidadeId: status.id,\n        userId: user.id,\n        filialId: status.filialId,\n        dadosAntes: JSON.stringify(before),\n        dadosDepois: JSON.stringify(status),\n      });\n\n      res.json(status);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.delete(\"/api/status-caminhao/:id\", requireAuth, requireRole(\"gestor\"), requireFilial, async (req, res, next) => {\n    try {\n      const user = (req as any).user as User;\n      const filialId = (req as any).filialId as string;\n      const status = await storage.getStatusCaminhao(req.params.id);\n      \n      if (!status) {\n        return res.status(404).json({ error: \"Status não encontrado\" });\n      }\n      \n      if (status.filialId !== filialId) {\n        return res.status(403).json({ error: \"Acesso negado a este status\" });\n      }\n\n      await storage.deleteStatusCaminhao(req.params.id);\n\n      await storage.createAuditLog({\n        acao: \"delete\",\n        entidade: \"status_caminhao\",\n        entidadeId: req.params.id,\n        userId: user.id,\n        filialId: status.filialId,\n        dadosAntes: JSON.stringify(status),\n      });\n\n      res.json({ success: true });\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  // ==================== Audit Logs Routes ====================\n  \n  app.get(\"/api/audit-logs\", requireAuth, requireRole(\"gestor\"), async (req, res, next) => {\n    try {\n      const logs = await storage.getAllAuditLogs();\n      res.json(logs);\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  const httpServer = createServer(app);\n\n  // ==================== WebSocket Setup ====================\n  const wss = new WebSocketServer({ server: httpServer, path: '/ws' });\n  const clients = new Map<WebSocket, string>(); // Map WebSocket to filialId\n\n  wss.on('connection', (ws, req) => {\n    // Extract filialId from query parameter\n    const url = new URL(req.url || '', `http://${req.headers.host}`);\n    const filialId = url.searchParams.get('filialId');\n\n    if (!filialId) {\n      console.log('WebSocket connection rejected: missing filialId');\n      ws.close(1008, 'Missing filialId parameter');\n      return;\n    }\n\n    clients.set(ws, filialId);\n    console.log(`WebSocket client connected for filial ${filialId}. Total clients: ${clients.size}`);\n\n    ws.on('close', () => {\n      clients.delete(ws);\n      console.log(`WebSocket client disconnected. Total clients: ${clients.size}`);\n    });\n\n    ws.on('error', (error) => {\n      console.error('WebSocket error:', error);\n      clients.delete(ws);\n    });\n  });\n\n  // Broadcast to all clients or filter by filialId\n  function broadcastToClients(message: any, targetFilialId?: string) {\n    const data = JSON.stringify(message);\n    clients.forEach((clientFilialId, client) => {\n      if (client.readyState === WebSocket.OPEN) {\n        // If targetFilialId is specified, only send to matching clients\n        if (!targetFilialId || clientFilialId === targetFilialId) {\n          client.send(data);\n        }\n      }\n    });\n  }\n\n  return httpServer;\n}\n","size_bytes":43434},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n\n  /* Automatic computation of border around primary / danger buttons */\n  --opaque-button-border-intensity: -8; /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n\n  --background: 210 10% 98%;\n\n  --foreground: 215 20% 12%;\n\n  --border: 210 12% 88%;\n\n  --card: 0 0% 100%;\n\n  --card-foreground: 215 20% 12%;\n\n  --card-border: 210 12% 90%;\n\n  --sidebar: 0 0% 10%;\n\n  --sidebar-foreground: 0 0% 95%;\n\n  --sidebar-border: 0 0% 15%;\n\n  --sidebar-primary: 0 91% 57%;\n\n  --sidebar-primary-foreground: 0 0% 100%;\n\n  --sidebar-accent: 0 0% 18%;\n\n  --sidebar-accent-foreground: 0 0% 92%;\n\n  --sidebar-ring: 0 91% 60%;\n\n  --popover: 0 0% 100%;\n\n  --popover-foreground: 215 20% 12%;\n\n  --popover-border: 210 12% 88%;\n\n  --primary: 0 91% 57%;\n\n  --primary-foreground: 0 0% 100%;\n\n  --secondary: 24 95% 95%;\n\n  --secondary-foreground: 24 95% 25%;\n\n  --muted: 0 0% 92%;\n\n  --muted-foreground: 0 0% 45%;\n\n  --accent: 24 95% 96%;\n\n  --accent-foreground: 24 95% 35%;\n\n  --destructive: 358 75% 45%;\n\n  --destructive-foreground: 358 5% 98%;\n\n  --input: 0 0% 75%;\n  --ring: 0 91% 55%;\n  --chart-1: 0 91% 57%;\n  --chart-2: 24 95% 53%;\n  --chart-3: 48 96% 63%;\n  --chart-4: 0 70% 40%;\n  --chart-5: 24 70% 40%;\n\n  --font-sans: Inter, -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: \"SF Mono\", Monaco, \"Cascadia Code\", \"Roboto Mono\", Consolas, monospace;\n  --radius: .5rem; /* 8px */\n  --shadow-2xs: 0px 1px 2px 0px hsl(215 25% 27% / 0.04);\n  --shadow-xs: 0px 1px 3px 0px hsl(215 25% 27% / 0.06);\n  --shadow-sm: 0px 2px 4px -1px hsl(215 25% 27% / 0.04), 0px 1px 2px -1px hsl(215 25% 27% / 0.06);\n  --shadow: 0px 4px 6px -1px hsl(215 25% 27% / 0.06), 0px 2px 4px -2px hsl(215 25% 27% / 0.08);\n  --shadow-md: 0px 6px 12px -2px hsl(215 25% 27% / 0.08), 0px 3px 6px -3px hsl(215 25% 27% / 0.10);\n  --shadow-lg: 0px 10px 20px -4px hsl(215 25% 27% / 0.10), 0px 4px 8px -4px hsl(215 25% 27% / 0.12);\n  --shadow-xl: 0px 20px 30px -6px hsl(215 25% 27% / 0.12), 0px 8px 16px -6px hsl(215 25% 27% / 0.14);\n  --shadow-2xl: 0px 30px 50px -8px hsl(215 25% 27% / 0.16);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n  /* Automatically computed borders - intensity can be controlled by the user by the --opaque-button-border-intensity setting */\n\n  /* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n\n  --opaque-button-border-intensity: 9;  /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n\n  --background: 215 25% 8%;\n\n  --foreground: 210 10% 95%;\n\n  --border: 215 20% 18%;\n\n  --card: 215 25% 10%;\n\n  --card-foreground: 210 10% 95%;\n\n  --card-border: 215 20% 20%;\n\n  --sidebar: 0 0% 8%;\n\n  --sidebar-foreground: 0 0% 95%;\n\n  --sidebar-border: 0 0% 15%;\n\n  --sidebar-primary: 0 91% 57%;\n\n  --sidebar-primary-foreground: 0 0% 100%;\n\n  --sidebar-accent: 0 0% 15%;\n\n  --sidebar-accent-foreground: 0 0% 92%;\n\n  --sidebar-ring: 0 91% 60%;\n\n  --popover: 215 25% 12%;\n\n  --popover-foreground: 210 10% 95%;\n\n  --popover-border: 215 20% 24%;\n\n  --primary: 0 91% 57%;\n\n  --primary-foreground: 0 0% 100%;\n\n  --secondary: 24 50% 20%;\n\n  --secondary-foreground: 24 10% 92%;\n\n  --muted: 0 0% 18%;\n\n  --muted-foreground: 0 0% 68%;\n\n  --accent: 24 50% 20%;\n\n  --accent-foreground: 24 10% 92%;\n\n  --destructive: 358 70% 52%;\n\n  --destructive-foreground: 358 5% 8%;\n\n  /* Used as the border around inputs. Dark mode: Should be a border that is light enough to have high contrast when rendered on a --card background. More contrast than standard --border */\n  --input: 0 0% 35%;\n  --ring: 0 91% 60%;\n  --chart-1: 0 91% 60%;\n  --chart-2: 24 95% 58%;\n  --chart-3: 48 96% 68%;\n  --chart-4: 0 70% 50%;\n  --chart-5: 24 70% 50%;\n\n  --shadow-2xs: 0px 1px 2px 0px hsl(215 25% 3% / 0.20);\n  --shadow-xs: 0px 1px 3px 0px hsl(215 25% 3% / 0.25);\n  --shadow-sm: 0px 2px 4px -1px hsl(215 25% 3% / 0.20), 0px 1px 2px -1px hsl(215 25% 3% / 0.25);\n  --shadow: 0px 4px 6px -1px hsl(215 25% 3% / 0.25), 0px 2px 4px -2px hsl(215 25% 3% / 0.30);\n  --shadow-md: 0px 6px 12px -2px hsl(215 25% 3% / 0.30), 0px 3px 6px -3px hsl(215 25% 3% / 0.35);\n  --shadow-lg: 0px 10px 20px -4px hsl(215 25% 3% / 0.35), 0px 4px 8px -4px hsl(215 25% 3% / 0.40);\n  --shadow-xl: 0px 20px 30px -6px hsl(215 25% 3% / 0.40), 0px 8px 16px -6px hsl(215 25% 3% / 0.45);\n  --shadow-2xl: 0px 30px 50px -8px hsl(215 25% 3% / 0.50);\n\n  /* Automatically computed borders - intensity can be controlled by the user by the --opaque-button-border-intensity setting */\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}","size_bytes":11030},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":21846},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/pages/filial-selection-page.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Building2, Search, MapPin, CheckCircle2, Loader2 } from \"lucide-react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport type { Filial } from \"@shared/schema\";\nimport { useAuth } from \"@/hooks/use-auth\";\n\nexport default function FilialSelectionPage() {\n  const [, setLocation] = useLocation();\n  const { user } = useAuth();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [selectedFilialId, setSelectedFilialId] = useState<string | null>(() => {\n    return localStorage.getItem(\"selected_filial\");\n  });\n\n  const { data: filiais, isLoading } = useQuery<Filial[]>({\n    queryKey: [\"/api/filiais\"],\n  });\n\n  const { data: userFiliais } = useQuery<string[]>({\n    queryKey: [\"/api/user-filiais\"],\n  });\n\n  const filteredFiliais = filiais?.filter((filial) => {\n    const matchesSearch = filial.nome.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      filial.codigo.toLowerCase().includes(searchTerm.toLowerCase());\n    const hasAccess = !userFiliais || userFiliais.includes(filial.id);\n    return matchesSearch && hasAccess && filial.ativo;\n  });\n\n  const handleSelectFilial = (filialId: string) => {\n    setSelectedFilialId(filialId);\n    localStorage.setItem(\"selected_filial\", filialId);\n    \n    // Redirect based on role\n    if (user?.role === \"porteiro\") {\n      setLocation(\"/portaria\");\n    } else if (user?.role === \"cliente\") {\n      setLocation(\"/cliente\");\n    } else if (user?.role === \"gestor\") {\n      setLocation(\"/gestao\");\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen bg-background\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background p-6\">\n      <div className=\"max-w-5xl mx-auto space-y-8\">\n        {/* Header */}\n        <div className=\"text-center space-y-2\">\n          <div className=\"flex justify-center\">\n            <div className=\"flex h-16 w-16 items-center justify-center rounded-xl bg-primary mb-4\">\n              <Building2 className=\"h-10 w-10 text-primary-foreground\" />\n            </div>\n          </div>\n          <h1 className=\"text-3xl font-bold text-foreground\">Selecione a Filial</h1>\n          <p className=\"text-muted-foreground\">\n            Escolha a filial que deseja acessar para continuar\n          </p>\n        </div>\n\n        {/* Search */}\n        <div className=\"relative max-w-md mx-auto\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <Input\n            data-testid=\"input-search-filial\"\n            placeholder=\"Buscar filial...\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"pl-10\"\n          />\n        </div>\n\n        {/* Filiais Grid */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {filteredFiliais?.map((filial) => (\n            <Card\n              key={filial.id}\n              className={`cursor-pointer transition-all hover-elevate ${\n                selectedFilialId === filial.id\n                  ? \"ring-2 ring-primary\"\n                  : \"\"\n              }`}\n              onClick={() => handleSelectFilial(filial.id)}\n              data-testid={`card-filial-${filial.codigo}`}\n            >\n              <CardHeader>\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex-1\">\n                    <CardTitle className=\"text-lg flex items-center gap-2\">\n                      {filial.nome}\n                      {selectedFilialId === filial.id && (\n                        <CheckCircle2 className=\"h-5 w-5 text-primary\" />\n                      )}\n                    </CardTitle>\n                    <CardDescription className=\"mt-1\">\n                      <Badge variant=\"secondary\" className=\"text-xs\">\n                        {filial.codigo.toUpperCase()}\n                      </Badge>\n                    </CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                <div className=\"flex items-start gap-2 text-sm text-muted-foreground\">\n                  <MapPin className=\"h-4 w-4 mt-0.5 flex-shrink-0\" />\n                  <span>{filial.endereco}</span>\n                </div>\n                {selectedFilialId === filial.id && (\n                  <Button className=\"w-full\" size=\"sm\" data-testid=\"button-continue\">\n                    Continuar\n                  </Button>\n                )}\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n\n        {filteredFiliais?.length === 0 && (\n          <div className=\"text-center py-12\">\n            <Building2 className=\"h-12 w-12 text-muted-foreground mx-auto mb-4 opacity-50\" />\n            <p className=\"text-muted-foreground\">Nenhuma filial encontrada</p>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","size_bytes":5321},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1202},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/hooks/use-websocket.tsx":{"content":"import { useEffect, useRef, useCallback } from \"react\";\nimport { useQueryClient } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ntype WebSocketMessage = {\n  type: string;\n  data: any;\n};\n\nexport function useWebSocket() {\n  const wsRef = useRef<WebSocket | null>(null);\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n  const reconnectTimeoutRef = useRef<NodeJS.Timeout>();\n  const reconnectAttemptsRef = useRef(0);\n  const maxReconnectAttempts = 5;\n\n  const connect = useCallback(() => {\n    if (wsRef.current?.readyState === WebSocket.OPEN) {\n      return;\n    }\n\n    try {\n      const protocol = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n      const filialId = localStorage.getItem(\"selected_filial\");\n      \n      if (!filialId) {\n        console.log(\"Cannot connect WebSocket: no filial selected\");\n        return;\n      }\n      \n      const wsUrl = `${protocol}//${window.location.host}/ws?filialId=${encodeURIComponent(filialId)}`;\n      \n      console.log(\"Connecting to WebSocket:\", wsUrl);\n      const ws = new WebSocket(wsUrl);\n\n      ws.onopen = () => {\n        console.log(\"WebSocket connected\");\n        reconnectAttemptsRef.current = 0;\n      };\n\n      ws.onmessage = (event) => {\n        try {\n          const message: WebSocketMessage = JSON.parse(event.data);\n          console.log(\"WebSocket message received:\", message.type, message.data);\n\n          // Get current filialId for query invalidation\n          const currentFilialId = localStorage.getItem(\"selected_filial\");\n\n          // Invalidate relevant queries based on event type\n          switch (message.type) {\n            case \"veiculo_entrada\":\n            case \"veiculo_saida\":\n              queryClient.invalidateQueries({ queryKey: [\"/api/veiculos\", currentFilialId] });\n              queryClient.invalidateQueries({ queryKey: [\"/api/veiculos\"] });\n              queryClient.invalidateQueries({ queryKey: [\"/api/vagas\", currentFilialId] });\n              queryClient.invalidateQueries({ queryKey: [\"/api/vagas\"] });\n              \n              if (message.type === \"veiculo_entrada\") {\n                toast({\n                  title: \"Nova Entrada\",\n                  description: `Veículo ${message.data.placaCavalo} registrado`,\n                });\n              }\n              break;\n\n            case \"vaga_updated\":\n              queryClient.invalidateQueries({ queryKey: [\"/api/vagas\", currentFilialId] });\n              queryClient.invalidateQueries({ queryKey: [\"/api/vagas\"] });\n              break;\n\n            case \"visitante_novo\":\n              queryClient.invalidateQueries({ queryKey: [\"/api/visitantes\", currentFilialId] });\n              queryClient.invalidateQueries({ queryKey: [\"/api/visitantes\"] });\n              toast({\n                title: \"Novo Visitante\",\n                description: `${message.data.nome} aguardando aprovação`,\n              });\n              break;\n\n            case \"visitante_aprovado\":\n              queryClient.invalidateQueries({ queryKey: [\"/api/visitantes\", currentFilialId] });\n              queryClient.invalidateQueries({ queryKey: [\"/api/visitantes\"] });\n              toast({\n                title: \"Visitante Aprovado ✓\",\n                description: `${message.data.nome} foi aprovado para entrada`,\n                duration: 5000,\n              });\n              break;\n\n            case \"visitante_entrada\":\n            case \"visitante_saida\":\n              queryClient.invalidateQueries({ queryKey: [\"/api/visitantes\", currentFilialId] });\n              queryClient.invalidateQueries({ queryKey: [\"/api/visitantes\"] });\n              break;\n\n            case \"chamada_nova\":\n              queryClient.invalidateQueries({ queryKey: [\"/api/chamadas\", currentFilialId] });\n              queryClient.invalidateQueries({ queryKey: [\"/api/chamadas\"] });\n              toast({\n                title: \"Nova Chamada\",\n                description: message.data.motivo,\n                variant: \"default\",\n              });\n              break;\n\n            case \"chamada_atendida\":\n              queryClient.invalidateQueries({ queryKey: [\"/api/chamadas\", currentFilialId] });\n              queryClient.invalidateQueries({ queryKey: [\"/api/chamadas\"] });\n              break;\n\n            default:\n              console.log(\"Unknown WebSocket message type:\", message.type);\n          }\n        } catch (error) {\n          console.error(\"Error parsing WebSocket message:\", error);\n        }\n      };\n\n      ws.onerror = (error) => {\n        console.error(\"WebSocket error:\", error);\n      };\n\n      ws.onclose = () => {\n        console.log(\"WebSocket disconnected\");\n        wsRef.current = null;\n\n        // Attempt to reconnect with exponential backoff\n        if (reconnectAttemptsRef.current < maxReconnectAttempts) {\n          const delay = Math.min(1000 * Math.pow(2, reconnectAttemptsRef.current), 30000);\n          console.log(`Reconnecting in ${delay}ms (attempt ${reconnectAttemptsRef.current + 1}/${maxReconnectAttempts})`);\n          \n          reconnectTimeoutRef.current = setTimeout(() => {\n            reconnectAttemptsRef.current++;\n            connect();\n          }, delay);\n        }\n      };\n\n      wsRef.current = ws;\n    } catch (error) {\n      console.error(\"Failed to create WebSocket connection:\", error);\n    }\n  }, [queryClient, toast]);\n\n  useEffect(() => {\n    connect();\n\n    return () => {\n      if (reconnectTimeoutRef.current) {\n        clearTimeout(reconnectTimeoutRef.current);\n      }\n      if (wsRef.current) {\n        wsRef.current.close();\n        wsRef.current = null;\n      }\n    };\n  }, [connect]);\n\n  return {\n    isConnected: wsRef.current?.readyState === WebSocket.OPEN,\n  };\n}\n","size_bytes":5737},"client/src/components/notification-center.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Bell, Check, X } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport { ptBR } from \"date-fns/locale\";\nimport type { Notification } from \"@shared/schema\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { useLocation } from \"wouter\";\n\nexport function NotificationCenter() {\n  const [, setLocation] = useLocation();\n  const [open, setOpen] = useState(false);\n\n  // Poll for unread count every 10 seconds\n  const { data: unreadCountData } = useQuery<{ count: number }>({\n    queryKey: [\"/api/notifications/unread-count\"],\n    refetchInterval: 10000, // 10 seconds\n  });\n\n  // Get all notifications when dropdown is opened\n  const { data: notifications = [] } = useQuery<Notification[]>({\n    queryKey: [\"/api/notifications\"],\n    enabled: open,\n  });\n\n  const markAsReadMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const res = await apiRequest(\"PATCH\", `/api/notifications/${id}/read`);\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications/unread-count\"] });\n    },\n  });\n\n  const markAllAsReadMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"PATCH\", \"/api/notifications/read-all\");\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications/unread-count\"] });\n    },\n  });\n\n  const deleteNotificationMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const res = await apiRequest(\"DELETE\", `/api/notifications/${id}`);\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications/unread-count\"] });\n    },\n  });\n\n  const handleNotificationClick = (notification: Notification) => {\n    // Mark as read if not already\n    if (notification.status === \"nao_lida\") {\n      markAsReadMutation.mutate(notification.id);\n    }\n\n    // Navigate to action URL if provided\n    if (notification.actionUrl) {\n      setLocation(notification.actionUrl);\n      setOpen(false);\n    }\n  };\n\n  const unreadCount = unreadCountData?.count || 0;\n\n  return (\n    <DropdownMenu open={open} onOpenChange={setOpen}>\n      <DropdownMenuTrigger asChild>\n        <Button \n          variant=\"ghost\" \n          size=\"icon\" \n          className=\"relative\"\n          data-testid=\"button-notifications\"\n        >\n          <Bell className=\"h-5 w-5\" />\n          {unreadCount > 0 && (\n            <Badge \n              variant=\"destructive\" \n              className=\"absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center p-0 text-xs\"\n              data-testid=\"badge-unread-count\"\n            >\n              {unreadCount > 9 ? \"9+\" : unreadCount}\n            </Badge>\n          )}\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent align=\"end\" className=\"w-96\">\n        <div className=\"flex items-center justify-between p-3 border-b\">\n          <h3 className=\"font-semibold\">Notificações</h3>\n          {unreadCount > 0 && (\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => markAllAsReadMutation.mutate()}\n              disabled={markAllAsReadMutation.isPending}\n              data-testid=\"button-mark-all-read\"\n            >\n              <Check className=\"h-4 w-4 mr-1\" />\n              Marcar todas como lidas\n            </Button>\n          )}\n        </div>\n\n        <ScrollArea className=\"h-[400px]\">\n          {notifications.length === 0 ? (\n            <div className=\"p-8 text-center text-muted-foreground\">\n              <Bell className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n              <p>Nenhuma notificação</p>\n            </div>\n          ) : (\n            <div className=\"divide-y\">\n              {notifications.map((notification) => (\n                <div\n                  key={notification.id}\n                  className={`p-3 hover-elevate cursor-pointer relative ${\n                    notification.status === \"nao_lida\" ? \"bg-accent/50\" : \"\"\n                  }`}\n                  onClick={() => handleNotificationClick(notification)}\n                  data-testid={`notification-${notification.id}`}\n                >\n                  <div className=\"flex items-start gap-3\">\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-center gap-2\">\n                        <p className=\"font-medium text-sm truncate\">\n                          {notification.titulo}\n                        </p>\n                        {notification.status === \"nao_lida\" && (\n                          <div className=\"h-2 w-2 rounded-full bg-primary flex-shrink-0\" />\n                        )}\n                      </div>\n                      <p className=\"text-sm text-muted-foreground line-clamp-2 mt-1\">\n                        {notification.mensagem}\n                      </p>\n                      <p className=\"text-xs text-muted-foreground mt-2\">\n                        {formatDistanceToNow(new Date(notification.createdAt), {\n                          addSuffix: true,\n                          locale: ptBR,\n                        })}\n                      </p>\n                    </div>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      className=\"h-6 w-6 flex-shrink-0\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        deleteNotificationMutation.mutate(notification.id);\n                      }}\n                      data-testid={`button-delete-${notification.id}`}\n                    >\n                      <X className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </ScrollArea>\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}\n","size_bytes":6550},"client/src/pages/motoristas-page.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { User, Plus, Loader2, Edit, Trash2 } from \"lucide-react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Motorista } from \"@shared/schema\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nexport default function MotoristasPage() {\n  const { toast } = useToast();\n  const selectedFilial = localStorage.getItem(\"selected_filial\");\n\n  const [showNewDialog, setShowNewDialog] = useState(false);\n  const [showEditDialog, setShowEditDialog] = useState(false);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [editingMotorista, setEditingMotorista] = useState<Motorista | null>(null);\n\n  const [formData, setFormData] = useState({\n    nome: \"\",\n    cpf: \"\",\n    tipo: \"terceiro\" as \"terceiro\" | \"agregado\" | \"frota\",\n    ativo: true,\n  });\n\n  const { data: motoristas, isLoading } = useQuery<Motorista[]>({\n    queryKey: [\"/api/motoristas\", selectedFilial],\n    enabled: !!selectedFilial,\n  });\n\n  const createMotoristaMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const res = await apiRequest(\"POST\", \"/api/motoristas\", data);\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/motoristas\", selectedFilial] });\n      toast({\n        title: \"Motorista criado\",\n        description: \"Novo motorista adicionado com sucesso\",\n      });\n      setFormData({ nome: \"\", cpf: \"\", tipo: \"terceiro\", ativo: true });\n      setShowNewDialog(false);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro ao criar motorista\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMotoristaMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<Motorista> }) => {\n      const res = await apiRequest(\"PATCH\", `/api/motoristas/${id}`, data);\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/motoristas\", selectedFilial] });\n      toast({\n        title: \"Motorista atualizado\",\n        description: \"Dados do motorista atualizados com sucesso\",\n      });\n      setShowEditDialog(false);\n      setEditingMotorista(null);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro ao atualizar motorista\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteMotoristaMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const res = await apiRequest(\"DELETE\", `/api/motoristas/${id}`);\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/motoristas\", selectedFilial] });\n      toast({\n        title: \"Motorista removido\",\n        description: \"Motorista removido com sucesso\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro ao remover motorista\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    createMotoristaMutation.mutate(formData);\n  };\n\n  const handleEdit = (motorista: Motorista) => {\n    setEditingMotorista(motorista);\n    setShowEditDialog(true);\n  };\n\n  const handleEditSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (editingMotorista) {\n      updateMotoristaMutation.mutate({\n        id: editingMotorista.id,\n        data: {\n          nome: editingMotorista.nome,\n          cpf: editingMotorista.cpf,\n          tipo: editingMotorista.tipo,\n          ativo: editingMotorista.ativo,\n        },\n      });\n    }\n  };\n\n  const handleDelete = (id: string) => {\n    if (confirm(\"Tem certeza que deseja remover este motorista?\")) {\n      deleteMotoristaMutation.mutate(id);\n    }\n  };\n\n  const filteredMotoristas = motoristas?.filter((m) =>\n    m.nome.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    m.cpf.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  const motoristasAtivos = motoristas?.filter((m) => m.ativo).length || 0;\n  const motoristasInativos = motoristas?.filter((m) => !m.ativo).length || 0;\n\n  if (!selectedFilial) {\n    return (\n      <div className=\"p-6\">\n        <Card>\n          <CardHeader>\n            <CardTitle>Nenhuma filial selecionada</CardTitle>\n            <CardDescription>Selecione uma filial para gerenciar motoristas</CardDescription>\n          </CardHeader>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">Motoristas</h1>\n          <p className=\"text-muted-foreground\">Gerencie os motoristas cadastrados</p>\n        </div>\n        <Button onClick={() => setShowNewDialog(true)} data-testid=\"button-novo-motorista\">\n          <Plus className=\"mr-2 h-4 w-4\" />\n          Novo Motorista\n        </Button>\n      </div>\n\n      {/* Stats */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Total de Motoristas</CardDescription>\n            <CardTitle className=\"text-3xl\">{motoristas?.length || 0}</CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Motoristas Ativos</CardDescription>\n            <CardTitle className=\"text-3xl text-emerald-600\">{motoristasAtivos}</CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Motoristas Inativos</CardDescription>\n            <CardTitle className=\"text-3xl text-gray-500\">{motoristasInativos}</CardTitle>\n          </CardHeader>\n        </Card>\n      </div>\n\n      {/* Search */}\n      <div className=\"flex gap-4\">\n        <div className=\"flex-1\">\n          <Input\n            placeholder=\"Buscar motoristas...\"\n            data-testid=\"input-search-motoristas\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n          />\n        </div>\n      </div>\n\n      {/* Motoristas List */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Lista de Motoristas</CardTitle>\n          <CardDescription>{filteredMotoristas?.length || 0} motoristas encontrados</CardDescription>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"flex justify-center py-8\">\n              <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n            </div>\n          ) : filteredMotoristas && filteredMotoristas.length > 0 ? (\n            <div className=\"space-y-2\">\n              {filteredMotoristas.map((motorista) => (\n                <div\n                  key={motorista.id}\n                  className=\"flex items-center justify-between p-4 border rounded-lg hover-elevate\"\n                  data-testid={`motorista-${motorista.id}`}\n                >\n                  <div className=\"flex-1 space-y-1\">\n                    <div className=\"flex items-center gap-2\">\n                      <User className=\"h-4 w-4 text-muted-foreground\" />\n                      <span className=\"font-medium\">{motorista.nome}</span>\n                      <Badge variant=\"outline\">\n                        {motorista.tipo === \"terceiro\" ? \"Terceiro\" : motorista.tipo === \"agregado\" ? \"Agregado\" : \"Frota\"}\n                      </Badge>\n                      {motorista.ativo ? (\n                        <Badge variant=\"outline\" className=\"bg-emerald-100 text-emerald-800 border-emerald-200 dark:bg-emerald-950 dark:text-emerald-200 dark:border-emerald-800\">\n                          Ativo\n                        </Badge>\n                      ) : (\n                        <Badge variant=\"outline\" className=\"bg-gray-100 text-gray-800 border-gray-200 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700\">\n                          Inativo\n                        </Badge>\n                      )}\n                    </div>\n                    <div className=\"text-sm text-muted-foreground\">CPF: {motorista.cpf}</div>\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => handleEdit(motorista)}\n                      data-testid={`button-edit-${motorista.id}`}\n                    >\n                      <Edit className=\"h-4 w-4\" />\n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => handleDelete(motorista.id)}\n                      disabled={deleteMotoristaMutation.isPending}\n                      data-testid={`button-delete-${motorista.id}`}\n                    >\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <div className=\"text-center py-8\">\n              <User className=\"h-12 w-12 text-muted-foreground mx-auto mb-4 opacity-50\" />\n              <p className=\"text-muted-foreground\">Nenhum motorista encontrado</p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Dialog Novo Motorista */}\n      <Dialog open={showNewDialog} onOpenChange={setShowNewDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Criar Novo Motorista</DialogTitle>\n            <DialogDescription>Preencha os dados do novo motorista</DialogDescription>\n          </DialogHeader>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"nome\">Nome Completo *</Label>\n              <Input\n                id=\"nome\"\n                data-testid=\"input-nome\"\n                placeholder=\"João Silva\"\n                value={formData.nome}\n                onChange={(e) => setFormData({ ...formData, nome: e.target.value })}\n                required\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"cpf\">CPF *</Label>\n              <Input\n                id=\"cpf\"\n                data-testid=\"input-cpf\"\n                placeholder=\"000.000.000-00\"\n                value={formData.cpf}\n                onChange={(e) => setFormData({ ...formData, cpf: e.target.value })}\n                required\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"tipo\">Tipo *</Label>\n              <Select\n                value={formData.tipo}\n                onValueChange={(value) => setFormData({ ...formData, tipo: value as typeof formData.tipo })}\n              >\n                <SelectTrigger data-testid=\"select-tipo\">\n                  <SelectValue placeholder=\"Selecione o tipo\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"terceiro\">Terceiro</SelectItem>\n                  <SelectItem value=\"agregado\">Agregado</SelectItem>\n                  <SelectItem value=\"frota\">Frota</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <DialogFooter>\n              <Button type=\"button\" variant=\"outline\" onClick={() => setShowNewDialog(false)}>\n                Cancelar\n              </Button>\n              <Button type=\"submit\" disabled={createMotoristaMutation.isPending} data-testid=\"button-submit-motorista\">\n                {createMotoristaMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                Criar Motorista\n              </Button>\n            </DialogFooter>\n          </form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Dialog Editar Motorista */}\n      <Dialog open={showEditDialog} onOpenChange={setShowEditDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Editar Motorista</DialogTitle>\n            <DialogDescription>Atualize os dados do motorista</DialogDescription>\n          </DialogHeader>\n          {editingMotorista && (\n            <form onSubmit={handleEditSubmit} className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"edit-nome\">Nome Completo *</Label>\n                <Input\n                  id=\"edit-nome\"\n                  data-testid=\"input-edit-nome\"\n                  value={editingMotorista.nome}\n                  onChange={(e) => setEditingMotorista({ ...editingMotorista, nome: e.target.value })}\n                  required\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"edit-cpf\">CPF *</Label>\n                <Input\n                  id=\"edit-cpf\"\n                  data-testid=\"input-edit-cpf\"\n                  value={editingMotorista.cpf}\n                  onChange={(e) => setEditingMotorista({ ...editingMotorista, cpf: e.target.value })}\n                  required\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"edit-tipo\">Tipo *</Label>\n                <Select\n                  value={editingMotorista.tipo}\n                  onValueChange={(value) => setEditingMotorista({ ...editingMotorista, tipo: value as typeof editingMotorista.tipo })}\n                >\n                  <SelectTrigger data-testid=\"select-edit-tipo\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"terceiro\">Terceiro</SelectItem>\n                    <SelectItem value=\"agregado\">Agregado</SelectItem>\n                    <SelectItem value=\"frota\">Frota</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"edit-ativo\">Status *</Label>\n                <Select\n                  value={editingMotorista.ativo ? \"true\" : \"false\"}\n                  onValueChange={(value) => setEditingMotorista({ ...editingMotorista, ativo: value === \"true\" })}\n                >\n                  <SelectTrigger data-testid=\"select-edit-ativo\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"true\">Ativo</SelectItem>\n                    <SelectItem value=\"false\">Inativo</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <DialogFooter>\n                <Button type=\"button\" variant=\"outline\" onClick={() => setShowEditDialog(false)}>\n                  Cancelar\n                </Button>\n                <Button type=\"submit\" disabled={updateMotoristaMutation.isPending} data-testid=\"button-submit-edit-motorista\">\n                  {updateMotoristaMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                  Salvar Alterações\n                </Button>\n              </DialogFooter>\n            </form>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":15844},"client/src/pages/status-caminhao-page.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Tag, Plus, Loader2, Edit, Trash2 } from \"lucide-react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { StatusCaminhao } from \"@shared/schema\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\n\nexport default function StatusCaminhaoPage() {\n  const { toast } = useToast();\n  \n  \n  const selectedFilial = localStorage.getItem(\"selected_filial\");\n\n  const [showNewDialog, setShowNewDialog] = useState(false);\n  const [showEditDialog, setShowEditDialog] = useState(false);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [editingStatus, setEditingStatus] = useState<StatusCaminhao | null>(null);\n\n  const [formData, setFormData] = useState({\n    descricao: \"\",\n    cor: \"#3B82F6\",\n    ordem: 0,\n    ativo: true,\n});\n\n  const { data: statusList, isLoading } = useQuery<StatusCaminhao[]>({\n    queryKey: [\"/api/status-caminhao\", selectedFilial],\n    enabled: !!selectedFilial,\n});\n\n  const createStatusMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const res = await apiRequest(\"POST\", \"/api/status-caminhao\", data);\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/status-caminhao\", selectedFilial] });\n      toast({\n        title: \"Status criado\",\n        description: \"Novo status adicionado com sucesso\",\n    });\n      setFormData({ descricao: \"\", cor: \"#3B82F6\", ordem: 0, ativo: true });\n      setShowNewDialog(false);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro ao criar status\",\n        description: error.message,\n        variant: \"destructive\",\n    });\n    },\n});\n\n  const updateStatusMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<StatusCaminhao> }) => {\n      const res = await apiRequest(\"PATCH\", `/api/status-caminhao/${id}`, data);\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/status-caminhao\", selectedFilial] });\n      toast({\n        title: \"Status atualizado\",\n        description: \"Dados do status atualizados com sucesso\",\n    });\n      setShowEditDialog(false);\n      setEditingStatus(null);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro ao atualizar status\",\n        description: error.message,\n        variant: \"destructive\",\n    });\n    },\n});\n\n  const deleteStatusMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const res = await apiRequest(\"DELETE\", `/api/status-caminhao/${id}`, undefined);\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/status-caminhao\", selectedFilial] });\n      toast({\n        title: \"Status removido\",\n        description: \"Status removido com sucesso\",\n    });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro ao remover status\",\n        description: error.message,\n        variant: \"destructive\",\n    });\n    },\n});\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    createStatusMutation.mutate(formData);\n  };\n\n  const handleEdit = (status: StatusCaminhao) => {\n    setEditingStatus(status);\n    setShowEditDialog(true);\n  };\n\n  const handleEditSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (editingStatus) {\n      updateStatusMutation.mutate({\n        id: editingStatus.id,\n        data: {\n          descricao: editingStatus.descricao,\n          cor: editingStatus.cor,\n          ordem: editingStatus.ordem,\n          ativo: editingStatus.ativo,\n        },\n    });\n    }\n  };\n\n  const handleDelete = (id: string) => {\n    if (confirm(\"Tem certeza que deseja remover este status?\")) {\n      deleteStatusMutation.mutate(id);\n    }\n  };\n\n  const filteredStatus = statusList?.filter((s) =>\n    s.descricao.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  const sortedStatus = filteredStatus?.sort((a, b) => a.ordem - b.ordem);\n\n  const statusAtivos = statusList?.filter((s) => s.ativo).length || 0;\n  const statusInativos = statusList?.filter((s) => !s.ativo).length || 0;\n\n  if (!selectedFilial) {\n    return (\n      <div className=\"p-6\">\n        <Card>\n          <CardHeader>\n            <CardTitle>Nenhuma filial selecionada</CardTitle>\n            <CardDescription>Selecione uma filial para gerenciar status de caminhão</CardDescription>\n          </CardHeader>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">Status de Caminhão</h1>\n          <p className=\"text-muted-foreground\">Gerencie os status de caminhão</p>\n        </div>\n        <Button onClick={() => setShowNewDialog(true)} data-testid=\"button-novo-status\">\n          <Plus className=\"mr-2 h-4 w-4\" />\n          Novo Status\n        </Button>\n      </div>\n\n      {/* Stats */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Total de Status</CardDescription>\n            <CardTitle className=\"text-3xl\">{statusList?.length || 0}</CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Status Ativos</CardDescription>\n            <CardTitle className=\"text-3xl text-emerald-600\">{statusAtivos}</CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Status Inativos</CardDescription>\n            <CardTitle className=\"text-3xl text-gray-500\">{statusInativos}</CardTitle>\n          </CardHeader>\n        </Card>\n      </div>\n\n      {/* Search */}\n      <div className=\"flex gap-4\">\n        <div className=\"flex-1\">\n          <Input\n            placeholder=\"Buscar status...\"\n            data-testid=\"input-search-status\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n          />\n        </div>\n      </div>\n\n      {/* Status List */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Lista de Status</CardTitle>\n          <CardDescription>{sortedStatus?.length || 0} status encontrados</CardDescription>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"flex justify-center py-8\">\n              <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n            </div>\n          ) : sortedStatus && sortedStatus.length > 0 ? (\n            <div className=\"space-y-2\">\n              {sortedStatus.map((status) => (\n                <div\n                  key={status.id}\n                  className=\"flex items-center justify-between p-4 border rounded-lg hover-elevate\"\n                  data-testid={`status-${status.id}`}\n                >\n                  <div className=\"flex-1 space-y-1\">\n                    <div className=\"flex items-center gap-2\">\n                      <Tag className=\"h-4 w-4 text-muted-foreground\" />\n                      <span className=\"font-medium\">{status.descricao}</span>\n                      <Badge \n                        variant=\"outline\" \n                        style={{ \n                          backgroundColor: status.cor + '20', \n                          borderColor: status.cor, \n                          color: status.cor \n                        }}\n                      >\n                        Cor\n                      </Badge>\n                      <Badge variant=\"outline\">\n                        Ordem: {status.ordem}\n                      </Badge>\n                      {status.ativo ? (\n                        <Badge variant=\"outline\" className=\"bg-emerald-100 text-emerald-800 border-emerald-200 dark:bg-emerald-950 dark:text-emerald-200 dark:border-emerald-800\">\n                          Ativo\n                        </Badge>\n                      ) : (\n                        <Badge variant=\"outline\" className=\"bg-gray-100 text-gray-800 border-gray-200 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700\">\n                          Inativo\n                        </Badge>\n                      )}\n                    </div>\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => handleEdit(status)}\n                      data-testid={`button-edit-${status.id}`}\n                    >\n                      <Edit className=\"h-4 w-4\" />\n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => handleDelete(status.id)}\n                      disabled={deleteStatusMutation.isPending}\n                      data-testid={`button-delete-${status.id}`}\n                    >\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <div className=\"text-center py-8\">\n              <Tag className=\"h-12 w-12 text-muted-foreground mx-auto mb-4 opacity-50\" />\n              <p className=\"text-muted-foreground\">Nenhum status encontrado</p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Dialog Novo Status */}\n      <Dialog open={showNewDialog} onOpenChange={setShowNewDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Criar Novo Status</DialogTitle>\n            <DialogDescription>Preencha os dados do novo status</DialogDescription>\n          </DialogHeader>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"descricao\">Descrição *</Label>\n              <Input\n                id=\"descricao\"\n                data-testid=\"input-descricao\"\n                placeholder=\"Em trânsito\"\n                value={formData.descricao}\n                onChange={(e) => setFormData({ ...formData, descricao: e.target.value })}\n                required\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"cor\">Cor *</Label>\n              <div className=\"flex gap-2\">\n                <Input\n                  id=\"cor\"\n                  type=\"color\"\n                  data-testid=\"input-cor\"\n                  value={formData.cor}\n                  onChange={(e) => setFormData({ ...formData, cor: e.target.value })}\n                  className=\"w-20\"\n                  required\n                />\n                <Input\n                  type=\"text\"\n                  placeholder=\"#3B82F6\"\n                  value={formData.cor}\n                  onChange={(e) => setFormData({ ...formData, cor: e.target.value })}\n                  required\n                />\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"ordem\">Ordem *</Label>\n              <Input\n                id=\"ordem\"\n                type=\"number\"\n                data-testid=\"input-ordem\"\n                placeholder=\"0\"\n                value={formData.ordem}\n                onChange={(e) => setFormData({ ...formData, ordem: parseInt(e.target.value) || 0 })}\n                required\n              />\n            </div>\n            <DialogFooter>\n              <Button type=\"button\" variant=\"outline\" onClick={() => setShowNewDialog(false)}>\n                Cancelar\n              </Button>\n              <Button type=\"submit\" disabled={createStatusMutation.isPending} data-testid=\"button-submit-status\">\n                {createStatusMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                Criar Status\n              </Button>\n            </DialogFooter>\n          </form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Dialog Editar Status */}\n      <Dialog open={showEditDialog} onOpenChange={setShowEditDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Editar Status</DialogTitle>\n            <DialogDescription>Atualize os dados do status</DialogDescription>\n          </DialogHeader>\n          {editingStatus && (\n            <form onSubmit={handleEditSubmit} className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"edit-descricao\">Descrição *</Label>\n                <Input\n                  id=\"edit-descricao\"\n                  data-testid=\"input-edit-descricao\"\n                  value={editingStatus.descricao}\n                  onChange={(e) => setEditingStatus({ ...editingStatus, descricao: e.target.value })}\n                  required\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"edit-cor\">Cor *</Label>\n                <div className=\"flex gap-2\">\n                  <Input\n                    id=\"edit-cor\"\n                    type=\"color\"\n                    data-testid=\"input-edit-cor\"\n                    value={editingStatus.cor}\n                    onChange={(e) => setEditingStatus({ ...editingStatus, cor: e.target.value })}\n                    className=\"w-20\"\n                    required\n                  />\n                  <Input\n                    type=\"text\"\n                    value={editingStatus.cor}\n                    onChange={(e) => setEditingStatus({ ...editingStatus, cor: e.target.value })}\n                    required\n                  />\n                </div>\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"edit-ordem\">Ordem *</Label>\n                <Input\n                  id=\"edit-ordem\"\n                  type=\"number\"\n                  data-testid=\"input-edit-ordem\"\n                  value={editingStatus.ordem}\n                  onChange={(e) => setEditingStatus({ ...editingStatus, ordem: parseInt(e.target.value) || 0 })}\n                  required\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"edit-ativo\">Status *</Label>\n                <Select\n                  value={editingStatus.ativo ? \"true\" : \"false\"}\n                  onValueChange={(value) => setEditingStatus({ ...editingStatus, ativo: value === \"true\" })}\n                >\n                  <SelectTrigger data-testid=\"select-edit-ativo\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"true\">Ativo</SelectItem>\n                    <SelectItem value=\"false\">Inativo</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <DialogFooter>\n                <Button type=\"button\" variant=\"outline\" onClick={() => setShowEditDialog(false)}>\n                  Cancelar\n                </Button>\n                <Button type=\"submit\" disabled={updateStatusMutation.isPending} data-testid=\"button-submit-edit-status\">\n                  {updateStatusMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                  Salvar Alterações\n                </Button>\n              </DialogFooter>\n            </form>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":16054},"client/src/pages/veiculos-cadastro-page.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Truck, Plus, Loader2, Edit, Trash2 } from \"lucide-react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { VeiculoCadastro } from \"@shared/schema\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\n\nexport default function VeiculosCadastroPage() {\n  const { toast } = useToast();\n  \n  \n  const selectedFilial = localStorage.getItem(\"selected_filial\");\n\n  const [showNewDialog, setShowNewDialog] = useState(false);\n  const [showEditDialog, setShowEditDialog] = useState(false);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [editingVeiculo, setEditingVeiculo] = useState<VeiculoCadastro | null>(null);\n\n  const [formData, setFormData] = useState({\n    tipo: \"cavalo_carreta\" as \"carro\" | \"moto\" | \"cavalo\" | \"cavalo_carreta\",\n    placa: \"\",\n    statusCarga: undefined as \"carregado\" | \"descarregado\" | \"pernoite\" | \"manutencao\" | undefined,\n    ativo: true,\n});\n\n  const { data: veiculos, isLoading } = useQuery<VeiculoCadastro[]>({\n    queryKey: [\"/api/veiculos-cadastro\", selectedFilial],\n    enabled: !!selectedFilial,\n});\n\n  const createVeiculoMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const res = await apiRequest(\"POST\", \"/api/veiculos-cadastro\", data);\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/veiculos-cadastro\", selectedFilial] });\n      toast({\n        title: \"Veículo criado\",\n        description: \"Novo veículo adicionado com sucesso\",\n    });\n      setFormData({ tipo: \"cavalo_carreta\", placa: \"\", statusCarga: undefined, ativo: true });\n      setShowNewDialog(false);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro ao criar veículo\",\n        description: error.message,\n        variant: \"destructive\",\n    });\n    },\n});\n\n  const updateVeiculoMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<VeiculoCadastro> }) => {\n      const res = await apiRequest(\"PATCH\", `/api/veiculos-cadastro/${id}`, data);\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/veiculos-cadastro\", selectedFilial] });\n      toast({\n        title: \"Veículo atualizado\",\n        description: \"Dados do veículo atualizados com sucesso\",\n    });\n      setShowEditDialog(false);\n      setEditingVeiculo(null);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro ao atualizar veículo\",\n        description: error.message,\n        variant: \"destructive\",\n    });\n    },\n});\n\n  const deleteVeiculoMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const res = await apiRequest(\"DELETE\", `/api/veiculos-cadastro/${id}`, undefined);\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/veiculos-cadastro\", selectedFilial] });\n      toast({\n        title: \"Veículo removido\",\n        description: \"Veículo removido com sucesso\",\n    });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro ao remover veículo\",\n        description: error.message,\n        variant: \"destructive\",\n    });\n    },\n});\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    createVeiculoMutation.mutate(formData);\n  };\n\n  const handleEdit = (veiculo: VeiculoCadastro) => {\n    setEditingVeiculo(veiculo);\n    setShowEditDialog(true);\n  };\n\n  const handleEditSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (editingVeiculo) {\n      updateVeiculoMutation.mutate({\n        id: editingVeiculo.id,\n        data: {\n          tipo: editingVeiculo.tipo,\n          placa: editingVeiculo.placa,\n          statusCarga: editingVeiculo.statusCarga,\n          ativo: editingVeiculo.ativo,\n        },\n    });\n    }\n  };\n\n  const handleDelete = (id: string) => {\n    if (confirm(\"Tem certeza que deseja remover este veículo?\")) {\n      deleteVeiculoMutation.mutate(id);\n    }\n  };\n\n  const getTipoLabel = (tipo: string) => {\n    switch (tipo) {\n      case \"cavalo_carreta\": return \"Carreta\";\n      case \"cavalo\": return \"Caminhão\";\n      case \"carro\": return \"Carro\";\n      case \"moto\": return \"Moto\";\n      default: return tipo;\n    }\n  };\n\n  const getStatusCargaLabel = (status: string) => {\n    switch (status) {\n      case \"carregado\": return \"Carregado\";\n      case \"descarregado\": return \"Descarregado\";\n      case \"pernoite\": return \"Pernoite\";\n      case \"manutencao\": return \"Manutenção\";\n      default: return status;\n    }\n  };\n\n  const filteredVeiculos = veiculos?.filter((v) =>\n    v.placa.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  const veiculosAtivos = veiculos?.filter((v) => v.ativo).length || 0;\n  const veiculosInativos = veiculos?.filter((v) => !v.ativo).length || 0;\n\n  if (!selectedFilial) {\n    return (\n      <div className=\"p-6\">\n        <Card>\n          <CardHeader>\n            <CardTitle>Nenhuma filial selecionada</CardTitle>\n            <CardDescription>Selecione uma filial para gerenciar veículos</CardDescription>\n          </CardHeader>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">Veículos Cadastrados</h1>\n          <p className=\"text-muted-foreground\">Gerencie os veículos cadastrados</p>\n        </div>\n        <Button onClick={() => setShowNewDialog(true)} data-testid=\"button-novo-veiculo\">\n          <Plus className=\"mr-2 h-4 w-4\" />\n          Novo Veículo\n        </Button>\n      </div>\n\n      {/* Stats */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Total de Veículos</CardDescription>\n            <CardTitle className=\"text-3xl\">{veiculos?.length || 0}</CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Veículos Ativos</CardDescription>\n            <CardTitle className=\"text-3xl text-emerald-600\">{veiculosAtivos}</CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Veículos Inativos</CardDescription>\n            <CardTitle className=\"text-3xl text-gray-500\">{veiculosInativos}</CardTitle>\n          </CardHeader>\n        </Card>\n      </div>\n\n      {/* Search */}\n      <div className=\"flex gap-4\">\n        <div className=\"flex-1\">\n          <Input\n            placeholder=\"Buscar veículos...\"\n            data-testid=\"input-search-veiculos\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n          />\n        </div>\n      </div>\n\n      {/* Veiculos List */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Lista de Veículos</CardTitle>\n          <CardDescription>{filteredVeiculos?.length || 0} veículos encontrados</CardDescription>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"flex justify-center py-8\">\n              <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n            </div>\n          ) : filteredVeiculos && filteredVeiculos.length > 0 ? (\n            <div className=\"space-y-2\">\n              {filteredVeiculos.map((veiculo) => (\n                <div\n                  key={veiculo.id}\n                  className=\"flex items-center justify-between p-4 border rounded-lg hover-elevate\"\n                  data-testid={`veiculo-${veiculo.id}`}\n                >\n                  <div className=\"flex-1 space-y-1\">\n                    <div className=\"flex items-center gap-2\">\n                      <Truck className=\"h-4 w-4 text-muted-foreground\" />\n                      <span className=\"font-medium\">{veiculo.placa}</span>\n                      <Badge variant=\"outline\">\n                        {getTipoLabel(veiculo.tipo)}\n                      </Badge>\n                      {veiculo.statusCarga && (\n                        <Badge variant=\"outline\">\n                          {getStatusCargaLabel(veiculo.statusCarga)}\n                        </Badge>\n                      )}\n                      {veiculo.ativo ? (\n                        <Badge variant=\"outline\" className=\"bg-emerald-100 text-emerald-800 border-emerald-200 dark:bg-emerald-950 dark:text-emerald-200 dark:border-emerald-800\">\n                          Ativo\n                        </Badge>\n                      ) : (\n                        <Badge variant=\"outline\" className=\"bg-gray-100 text-gray-800 border-gray-200 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700\">\n                          Inativo\n                        </Badge>\n                      )}\n                    </div>\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => handleEdit(veiculo)}\n                      data-testid={`button-edit-${veiculo.id}`}\n                    >\n                      <Edit className=\"h-4 w-4\" />\n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => handleDelete(veiculo.id)}\n                      disabled={deleteVeiculoMutation.isPending}\n                      data-testid={`button-delete-${veiculo.id}`}\n                    >\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <div className=\"text-center py-8\">\n              <Truck className=\"h-12 w-12 text-muted-foreground mx-auto mb-4 opacity-50\" />\n              <p className=\"text-muted-foreground\">Nenhum veículo encontrado</p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Dialog Novo Veículo */}\n      <Dialog open={showNewDialog} onOpenChange={setShowNewDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Criar Novo Veículo</DialogTitle>\n            <DialogDescription>Preencha os dados do novo veículo</DialogDescription>\n          </DialogHeader>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"placa\">Placa *</Label>\n              <Input\n                id=\"placa\"\n                data-testid=\"input-placa\"\n                placeholder=\"ABC-1234\"\n                value={formData.placa}\n                onChange={(e) => setFormData({ ...formData, placa: e.target.value })}\n                required\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"tipo\">Tipo *</Label>\n              <Select\n                value={formData.tipo}\n                onValueChange={(value) => setFormData({ ...formData, tipo: value as typeof formData.tipo })}\n              >\n                <SelectTrigger data-testid=\"select-tipo\">\n                  <SelectValue placeholder=\"Selecione o tipo\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"cavalo_carreta\">Carreta</SelectItem>\n                  <SelectItem value=\"cavalo\">Caminhão</SelectItem>\n                  <SelectItem value=\"carro\">Carro</SelectItem>\n                  <SelectItem value=\"moto\">Moto</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"statusCarga\">Status de Carga</Label>\n              <Select\n                value={formData.statusCarga || \"\"}\n                onValueChange={(value) => setFormData({ ...formData, statusCarga: value as typeof formData.statusCarga })}\n              >\n                <SelectTrigger data-testid=\"select-status-carga\">\n                  <SelectValue placeholder=\"Selecione o status (opcional)\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"carregado\">Carregado</SelectItem>\n                  <SelectItem value=\"descarregado\">Descarregado</SelectItem>\n                  <SelectItem value=\"pernoite\">Pernoite</SelectItem>\n                  <SelectItem value=\"manutencao\">Manutenção</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <DialogFooter>\n              <Button type=\"button\" variant=\"outline\" onClick={() => setShowNewDialog(false)}>\n                Cancelar\n              </Button>\n              <Button type=\"submit\" disabled={createVeiculoMutation.isPending} data-testid=\"button-submit-veiculo\">\n                {createVeiculoMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                Criar Veículo\n              </Button>\n            </DialogFooter>\n          </form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Dialog Editar Veículo */}\n      <Dialog open={showEditDialog} onOpenChange={setShowEditDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Editar Veículo</DialogTitle>\n            <DialogDescription>Atualize os dados do veículo</DialogDescription>\n          </DialogHeader>\n          {editingVeiculo && (\n            <form onSubmit={handleEditSubmit} className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"edit-placa\">Placa *</Label>\n                <Input\n                  id=\"edit-placa\"\n                  data-testid=\"input-edit-placa\"\n                  value={editingVeiculo.placa}\n                  onChange={(e) => setEditingVeiculo({ ...editingVeiculo, placa: e.target.value })}\n                  required\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"edit-tipo\">Tipo *</Label>\n                <Select\n                  value={editingVeiculo.tipo}\n                  onValueChange={(value) => setEditingVeiculo({ ...editingVeiculo, tipo: value as typeof editingVeiculo.tipo })}\n                >\n                  <SelectTrigger data-testid=\"select-edit-tipo\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"cavalo_carreta\">Carreta</SelectItem>\n                    <SelectItem value=\"cavalo\">Caminhão</SelectItem>\n                    <SelectItem value=\"carro\">Carro</SelectItem>\n                    <SelectItem value=\"moto\">Moto</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"edit-statusCarga\">Status de Carga</Label>\n                <Select\n                  value={editingVeiculo.statusCarga || \"\"}\n                  onValueChange={(value) => setEditingVeiculo({ ...editingVeiculo, statusCarga: value as typeof editingVeiculo.statusCarga })}\n                >\n                  <SelectTrigger data-testid=\"select-edit-status-carga\">\n                    <SelectValue placeholder=\"Selecione o status (opcional)\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"carregado\">Carregado</SelectItem>\n                    <SelectItem value=\"descarregado\">Descarregado</SelectItem>\n                    <SelectItem value=\"pernoite\">Pernoite</SelectItem>\n                    <SelectItem value=\"manutencao\">Manutenção</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"edit-ativo\">Status *</Label>\n                <Select\n                  value={editingVeiculo.ativo ? \"true\" : \"false\"}\n                  onValueChange={(value) => setEditingVeiculo({ ...editingVeiculo, ativo: value === \"true\" })}\n                >\n                  <SelectTrigger data-testid=\"select-edit-ativo\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"true\">Ativo</SelectItem>\n                    <SelectItem value=\"false\">Inativo</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <DialogFooter>\n                <Button type=\"button\" variant=\"outline\" onClick={() => setShowEditDialog(false)}>\n                  Cancelar\n                </Button>\n                <Button type=\"submit\" disabled={updateVeiculoMutation.isPending} data-testid=\"button-submit-edit-veiculo\">\n                  {updateVeiculoMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                  Salvar Alterações\n                </Button>\n              </DialogFooter>\n            </form>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":17657},"client/src/pages/fornecedores-page.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Building2, Plus, Loader2, Edit, Trash2 } from \"lucide-react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Fornecedor } from \"@shared/schema\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\n\nexport default function FornecedoresPage() {\n  const { toast } = useToast();\n  \n  \n  const selectedFilial = localStorage.getItem(\"selected_filial\");\n\n  const [showNewDialog, setShowNewDialog] = useState(false);\n  const [showEditDialog, setShowEditDialog] = useState(false);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [editingFornecedor, setEditingFornecedor] = useState<Fornecedor | null>(null);\n\n  const [formData, setFormData] = useState({\n    nome: \"\",\n    cnpj: \"\",\n    ativo: true,\n});\n\n  const { data: fornecedores, isLoading } = useQuery<Fornecedor[]>({\n    queryKey: [\"/api/fornecedores\", selectedFilial],\n    enabled: !!selectedFilial,\n});\n\n  const createFornecedorMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const res = await apiRequest(\"POST\", \"/api/fornecedores\", data);\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/fornecedores\", selectedFilial] });\n      toast({\n        title: \"Fornecedor criado\",\n        description: \"Novo fornecedor adicionado com sucesso\",\n    });\n      setFormData({ nome: \"\", cnpj: \"\", ativo: true });\n      setShowNewDialog(false);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro ao criar fornecedor\",\n        description: error.message,\n        variant: \"destructive\",\n    });\n    },\n});\n\n  const updateFornecedorMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<Fornecedor> }) => {\n      const res = await apiRequest(\"PATCH\", `/api/fornecedores/${id}`, data);\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/fornecedores\", selectedFilial] });\n      toast({\n        title: \"Fornecedor atualizado\",\n        description: \"Dados do fornecedor atualizados com sucesso\",\n    });\n      setShowEditDialog(false);\n      setEditingFornecedor(null);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro ao atualizar fornecedor\",\n        description: error.message,\n        variant: \"destructive\",\n    });\n    },\n});\n\n  const deleteFornecedorMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const res = await apiRequest(\"DELETE\", `/api/fornecedores/${id}`, undefined);\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/fornecedores\", selectedFilial] });\n      toast({\n        title: \"Fornecedor removido\",\n        description: \"Fornecedor removido com sucesso\",\n    });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro ao remover fornecedor\",\n        description: error.message,\n        variant: \"destructive\",\n    });\n    },\n});\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    createFornecedorMutation.mutate(formData);\n  };\n\n  const handleEdit = (fornecedor: Fornecedor) => {\n    setEditingFornecedor(fornecedor);\n    setShowEditDialog(true);\n  };\n\n  const handleEditSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (editingFornecedor) {\n      updateFornecedorMutation.mutate({\n        id: editingFornecedor.id,\n        data: {\n          nome: editingFornecedor.nome,\n          cnpj: editingFornecedor.cnpj,\n          ativo: editingFornecedor.ativo,\n        },\n    });\n    }\n  };\n\n  const handleDelete = (id: string) => {\n    if (confirm(\"Tem certeza que deseja remover este fornecedor?\")) {\n      deleteFornecedorMutation.mutate(id);\n    }\n  };\n\n  const filteredFornecedores = fornecedores?.filter((f) =>\n    f.nome.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    f.cnpj.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  const fornecedoresAtivos = fornecedores?.filter((f) => f.ativo).length || 0;\n  const fornecedoresInativos = fornecedores?.filter((f) => !f.ativo).length || 0;\n\n  if (!selectedFilial) {\n    return (\n      <div className=\"p-6\">\n        <Card>\n          <CardHeader>\n            <CardTitle>Nenhuma filial selecionada</CardTitle>\n            <CardDescription>Selecione uma filial para gerenciar fornecedores</CardDescription>\n          </CardHeader>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">Fornecedores</h1>\n          <p className=\"text-muted-foreground\">Gerencie os fornecedores cadastrados</p>\n        </div>\n        <Button onClick={() => setShowNewDialog(true)} data-testid=\"button-novo-fornecedor\">\n          <Plus className=\"mr-2 h-4 w-4\" />\n          Novo Fornecedor\n        </Button>\n      </div>\n\n      {/* Stats */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Total de Fornecedores</CardDescription>\n            <CardTitle className=\"text-3xl\">{fornecedores?.length || 0}</CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Fornecedores Ativos</CardDescription>\n            <CardTitle className=\"text-3xl text-emerald-600\">{fornecedoresAtivos}</CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Fornecedores Inativos</CardDescription>\n            <CardTitle className=\"text-3xl text-gray-500\">{fornecedoresInativos}</CardTitle>\n          </CardHeader>\n        </Card>\n      </div>\n\n      {/* Search */}\n      <div className=\"flex gap-4\">\n        <div className=\"flex-1\">\n          <Input\n            placeholder=\"Buscar fornecedores...\"\n            data-testid=\"input-search-fornecedores\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n          />\n        </div>\n      </div>\n\n      {/* Fornecedores List */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Lista de Fornecedores</CardTitle>\n          <CardDescription>{filteredFornecedores?.length || 0} fornecedores encontrados</CardDescription>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"flex justify-center py-8\">\n              <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n            </div>\n          ) : filteredFornecedores && filteredFornecedores.length > 0 ? (\n            <div className=\"space-y-2\">\n              {filteredFornecedores.map((fornecedor) => (\n                <div\n                  key={fornecedor.id}\n                  className=\"flex items-center justify-between p-4 border rounded-lg hover-elevate\"\n                  data-testid={`fornecedor-${fornecedor.id}`}\n                >\n                  <div className=\"flex-1 space-y-1\">\n                    <div className=\"flex items-center gap-2\">\n                      <Building2 className=\"h-4 w-4 text-muted-foreground\" />\n                      <span className=\"font-medium\">{fornecedor.nome}</span>\n                      {fornecedor.ativo ? (\n                        <Badge variant=\"outline\" className=\"bg-emerald-100 text-emerald-800 border-emerald-200 dark:bg-emerald-950 dark:text-emerald-200 dark:border-emerald-800\">\n                          Ativo\n                        </Badge>\n                      ) : (\n                        <Badge variant=\"outline\" className=\"bg-gray-100 text-gray-800 border-gray-200 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700\">\n                          Inativo\n                        </Badge>\n                      )}\n                    </div>\n                    <div className=\"text-sm text-muted-foreground\">CNPJ: {fornecedor.cnpj}</div>\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => handleEdit(fornecedor)}\n                      data-testid={`button-edit-${fornecedor.id}`}\n                    >\n                      <Edit className=\"h-4 w-4\" />\n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => handleDelete(fornecedor.id)}\n                      disabled={deleteFornecedorMutation.isPending}\n                      data-testid={`button-delete-${fornecedor.id}`}\n                    >\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <div className=\"text-center py-8\">\n              <Building2 className=\"h-12 w-12 text-muted-foreground mx-auto mb-4 opacity-50\" />\n              <p className=\"text-muted-foreground\">Nenhum fornecedor encontrado</p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Dialog Novo Fornecedor */}\n      <Dialog open={showNewDialog} onOpenChange={setShowNewDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Criar Novo Fornecedor</DialogTitle>\n            <DialogDescription>Preencha os dados do novo fornecedor</DialogDescription>\n          </DialogHeader>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"nome\">Nome *</Label>\n              <Input\n                id=\"nome\"\n                data-testid=\"input-nome\"\n                placeholder=\"Empresa ABC Ltda\"\n                value={formData.nome}\n                onChange={(e) => setFormData({ ...formData, nome: e.target.value })}\n                required\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"cnpj\">CNPJ *</Label>\n              <Input\n                id=\"cnpj\"\n                data-testid=\"input-cnpj\"\n                placeholder=\"00.000.000/0000-00\"\n                value={formData.cnpj}\n                onChange={(e) => setFormData({ ...formData, cnpj: e.target.value })}\n                required\n              />\n            </div>\n            <DialogFooter>\n              <Button type=\"button\" variant=\"outline\" onClick={() => setShowNewDialog(false)}>\n                Cancelar\n              </Button>\n              <Button type=\"submit\" disabled={createFornecedorMutation.isPending} data-testid=\"button-submit-fornecedor\">\n                {createFornecedorMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                Criar Fornecedor\n              </Button>\n            </DialogFooter>\n          </form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Dialog Editar Fornecedor */}\n      <Dialog open={showEditDialog} onOpenChange={setShowEditDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Editar Fornecedor</DialogTitle>\n            <DialogDescription>Atualize os dados do fornecedor</DialogDescription>\n          </DialogHeader>\n          {editingFornecedor && (\n            <form onSubmit={handleEditSubmit} className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"edit-nome\">Nome *</Label>\n                <Input\n                  id=\"edit-nome\"\n                  data-testid=\"input-edit-nome\"\n                  value={editingFornecedor.nome}\n                  onChange={(e) => setEditingFornecedor({ ...editingFornecedor, nome: e.target.value })}\n                  required\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"edit-cnpj\">CNPJ *</Label>\n                <Input\n                  id=\"edit-cnpj\"\n                  data-testid=\"input-edit-cnpj\"\n                  value={editingFornecedor.cnpj}\n                  onChange={(e) => setEditingFornecedor({ ...editingFornecedor, cnpj: e.target.value })}\n                  required\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"edit-ativo\">Status *</Label>\n                <Select\n                  value={editingFornecedor.ativo ? \"true\" : \"false\"}\n                  onValueChange={(value) => setEditingFornecedor({ ...editingFornecedor, ativo: value === \"true\" })}\n                >\n                  <SelectTrigger data-testid=\"select-edit-ativo\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"true\">Ativo</SelectItem>\n                    <SelectItem value=\"false\">Inativo</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <DialogFooter>\n                <Button type=\"button\" variant=\"outline\" onClick={() => setShowEditDialog(false)}>\n                  Cancelar\n                </Button>\n                <Button type=\"submit\" disabled={updateFornecedorMutation.isPending} data-testid=\"button-submit-edit-fornecedor\">\n                  {updateFornecedorMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                  Salvar Alterações\n                </Button>\n              </DialogFooter>\n            </form>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":14155},"client/src/pages/tv-display-page.tsx":{"content":"import { useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { useWebSocket } from \"@/hooks/use-websocket\";\nimport { Bell, TruckIcon } from \"lucide-react\";\nimport type { Chamada, Veiculo } from \"@shared/schema\";\nimport { format } from \"date-fns\";\nimport { ptBR } from \"date-fns/locale\";\n\nexport default function TVDisplayPage() {\n  const filialId = localStorage.getItem(\"selected_filial\");\n\n  // WebSocket para atualizações em tempo real\n  useWebSocket();\n\n  // Buscar chamadas pendentes\n  const { data: chamadas = [], refetch } = useQuery<Chamada[]>({\n    queryKey: [\"/api/chamadas\", filialId],\n    enabled: !!filialId,\n    refetchInterval: 10000, // Atualizar a cada 10 segundos como backup\n  });\n\n  // Buscar veículos\n  const { data: veiculos = [] } = useQuery<Veiculo[]>({\n    queryKey: [\"/api/veiculos\", filialId],\n    enabled: !!filialId,\n  });\n\n  const chamadasPendentes = chamadas.filter(c => c.status === \"pendente\");\n\n  // Auto-refresh da página a cada 30 segundos\n  useEffect(() => {\n    const interval = setInterval(() => {\n      refetch();\n    }, 30000);\n    return () => clearInterval(interval);\n  }, [refetch]);\n\n  return (\n    <div className=\"min-h-screen bg-black p-8 relative overflow-hidden\">\n      {/* Background gradient */}\n      <div className=\"absolute inset-0 bg-gradient-to-br from-red-600/20 via-orange-500/20 to-yellow-500/20\"></div>\n      \n      {/* Header */}\n      <div className=\"text-center mb-12 relative z-10\">\n        <h1 className=\"text-7xl font-bold text-white mb-4 tracking-tight\" data-testid=\"text-title\">\n          CHAMADAS DE MOTORISTAS\n        </h1>\n        <div className=\"flex items-center justify-center gap-4 text-white/80 text-2xl\">\n          <Bell className=\"h-8 w-8 text-red-500\" />\n          <span data-testid=\"text-time\">{format(new Date(), \"HH:mm:ss\", { locale: ptBR })}</span>\n        </div>\n      </div>\n\n      {/* Chamadas Pendentes */}\n      {chamadasPendentes.length === 0 ? (\n        <div className=\"flex flex-col items-center justify-center min-h-[60vh]\">\n          <Bell className=\"h-32 w-32 text-white/30 mb-8\" />\n          <p className=\"text-5xl text-white/50 font-medium\">Nenhuma chamada no momento</p>\n        </div>\n      ) : (\n        <div className=\"grid gap-6 max-w-7xl mx-auto relative z-10\">\n          {chamadasPendentes.map((chamada, index) => {\n            const veiculo = veiculos.find(v => v.id === chamada.veiculoId);\n            return (\n              <Card\n                key={chamada.id}\n                className=\"bg-white/95 backdrop-blur-sm border-4 border-red-500 shadow-2xl animate-pulse\"\n                data-testid={`chamada-card-${chamada.id}`}\n              >\n                <CardContent className=\"p-8\">\n                  <div className=\"flex items-center gap-8\">\n                    {/* Número da Chamada */}\n                    <div className=\"flex-shrink-0 w-24 h-24 bg-red-500 rounded-full flex items-center justify-center\">\n                      <span className=\"text-5xl font-bold text-white\" data-testid={`text-numero-${chamada.id}`}>\n                        {index + 1}\n                      </span>\n                    </div>\n\n                    {/* Informações do Veículo */}\n                    <div className=\"flex-1 space-y-3\">\n                      <div className=\"flex items-center gap-4\">\n                        <TruckIcon className=\"h-12 w-12 text-red-600\" />\n                        <div>\n                          <p className=\"text-3xl font-bold text-gray-900\" data-testid={`text-motorista-${chamada.id}`}>\n                            {veiculo?.motorista || \"Motorista não identificado\"}\n                          </p>\n                          <div className=\"flex items-center gap-4 mt-2\">\n                            <span className=\"text-4xl font-mono font-bold text-red-600\" data-testid={`text-placa-${chamada.id}`}>\n                              {veiculo?.placaCavalo}\n                            </span>\n                            {veiculo?.placaCarreta && (\n                              <>\n                                <span className=\"text-2xl text-orange-400\">+</span>\n                                <span className=\"text-3xl font-mono font-bold text-orange-600\" data-testid={`text-placa-carreta-${chamada.id}`}>\n                                  {veiculo.placaCarreta}\n                                </span>\n                              </>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n\n                      {/* Motivo da Chamada */}\n                      <div className=\"bg-red-50 border-l-4 border-red-500 p-4 rounded\">\n                        <p className=\"text-2xl text-gray-900 font-medium\" data-testid={`text-motivo-${chamada.id}`}>\n                          {chamada.motivo}\n                        </p>\n                      </div>\n\n                      {/* Timestamp */}\n                      <p className=\"text-xl text-gray-500\" data-testid={`text-horario-${chamada.id}`}>\n                        Chamada às {format(new Date(chamada.createdAt), \"HH:mm\", { locale: ptBR })}\n                      </p>\n                    </div>\n\n                    {/* Status Animado */}\n                    <div className=\"flex-shrink-0\">\n                      <div className=\"flex flex-col items-center gap-2\">\n                        <Bell className=\"h-16 w-16 text-red-500 animate-bounce\" />\n                        <span className=\"text-2xl font-bold text-red-600 uppercase\">\n                          Aguardando\n                        </span>\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            );\n          })}\n        </div>\n      )}\n\n      {/* Footer */}\n      <div className=\"fixed bottom-8 left-0 right-0 text-center\">\n        <p className=\"text-white/60 text-xl\">\n          Última atualização: {format(new Date(), \"dd/MM/yyyy HH:mm:ss\", { locale: ptBR })}\n        </p>\n      </div>\n    </div>\n  );\n}\n","size_bytes":6115},"client/src/pages/cliente-chamadas-page.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { PhoneCall, Truck, Loader2, X, Search } from \"lucide-react\";\nimport { StatusBadge } from \"@/components/status-badge\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { format } from \"date-fns\";\nimport { ptBR } from \"date-fns/locale\";\nimport type { Veiculo, Filial } from \"@shared/schema\";\n\nexport default function ClienteChamadasPage() {\n  const { toast } = useToast();\n  const filialId = localStorage.getItem(\"selected_filial\");\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [selectedVeiculo, setSelectedVeiculo] = useState<Veiculo | null>(null);\n  const [motivo, setMotivo] = useState(\"\");\n  const [dialogOpen, setDialogOpen] = useState(false);\n\n  // Check if current filial is Costeira\n  const { data: filiais } = useQuery<Filial[]>({\n    queryKey: [\"/api/filiais\"],\n    enabled: !!filialId,\n  });\n  \n  const filial = filiais?.find(f => f.id === filialId);\n\n  const { data: veiculos, isLoading } = useQuery<Veiculo[]>({\n    queryKey: [\"/api/veiculos\", filialId],\n    enabled: !!filialId,\n  });\n\n  const createChamadaMutation = useMutation({\n    mutationFn: async (data: { veiculoId: string; motivo: string }) => {\n      const res = await apiRequest(\"POST\", \"/api/chamadas\", {\n        ...data,\n        filialId,\n      });\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/chamadas\", filialId] });\n      toast({\n        title: \"Chamada criada\",\n        description: \"O motorista será notificado\",\n      });\n      setDialogOpen(false);\n      setSelectedVeiculo(null);\n      setMotivo(\"\");\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro ao criar chamada\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleChamar = (veiculo: Veiculo) => {\n    setSelectedVeiculo(veiculo);\n    setDialogOpen(true);\n  };\n\n  const handleSubmit = () => {\n    if (!selectedVeiculo || !motivo.trim()) {\n      toast({\n        title: \"Campos obrigatórios\",\n        description: \"Por favor, preencha o motivo da chamada\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    createChamadaMutation.mutate({\n      veiculoId: selectedVeiculo.id,\n      motivo: motivo.trim(),\n    });\n  };\n\n  // Filter vehicles in patio (not finished)\n  const veiculosNoPatio = veiculos?.filter((v) => !v.dataSaida) || [];\n\n  // Filter by search term\n  const filteredVeiculos = veiculosNoPatio.filter((v) =>\n    v.placaCavalo.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    v.motorista.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    (v.transportadora ?? \"\").toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  // Check if filial is Costeira\n  const isFilialCosteira = filial?.codigo === \"costeira\";\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Header */}\n      <div>\n        <h1 className=\"text-3xl font-bold text-foreground\">Chamadas de Motoristas</h1>\n        <p className=\"text-muted-foreground\">Chame motoristas para carregar ou descarregar</p>\n      </div>\n\n      {/* Filial Restriction Message */}\n      {filial && !isFilialCosteira && (\n        <Card className=\"border-yellow-500 bg-yellow-50 dark:bg-yellow-950\">\n          <CardHeader>\n            <CardTitle className=\"text-yellow-800 dark:text-yellow-200\">\n              Funcionalidade Disponível Apenas para Filial Costeira\n            </CardTitle>\n            <CardDescription className=\"text-yellow-700 dark:text-yellow-300\">\n              Esta funcionalidade de chamadas de motoristas está disponível apenas para a filial Costeira.\n              Você está atualmente conectado à filial: <strong>{filial.nome}</strong>\n            </CardDescription>\n          </CardHeader>\n        </Card>\n      )}\n\n      {/* Only show content if Costeira */}\n      {isFilialCosteira && (\n        <>\n\n      {/* Search */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Buscar Veículo</CardTitle>\n          <CardDescription>Pesquise por placa, motorista ou transportadora</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n            <Input\n              placeholder=\"Digite para buscar...\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              className=\"pl-10\"\n              data-testid=\"input-search-veiculo\"\n            />\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Vehicles List */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Veículos no Pátio ({filteredVeiculos.length})</CardTitle>\n          <CardDescription>Selecione um veículo para chamar o motorista</CardDescription>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"flex items-center justify-center py-12\">\n              <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n            </div>\n          ) : filteredVeiculos.length > 0 ? (\n            <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n              {filteredVeiculos.map((veiculo) => (\n                <Card key={veiculo.id} className=\"hover-elevate\" data-testid={`card-veiculo-${veiculo.id}`}>\n                  <CardHeader className=\"pb-3\">\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex items-center gap-2\">\n                        <Truck className=\"h-5 w-5 text-primary\" />\n                        <CardTitle className=\"text-base\">\n                          {veiculo.placaCarreta\n                            ? `${veiculo.placaCavalo} + ${veiculo.placaCarreta}`\n                            : veiculo.placaCavalo}\n                        </CardTitle>\n                      </div>\n                      <StatusBadge status={veiculo.situacao} />\n                    </div>\n                  </CardHeader>\n                  <CardContent className=\"space-y-2\">\n                    <div>\n                      <p className=\"text-sm font-medium\">Motorista</p>\n                      <p className=\"text-sm text-muted-foreground\">{veiculo.motorista}</p>\n                    </div>\n                    {veiculo.transportadora && (\n                      <div>\n                        <p className=\"text-sm font-medium\">Transportadora</p>\n                        <p className=\"text-sm text-muted-foreground\">{veiculo.transportadora}</p>\n                      </div>\n                    )}\n                    {veiculo.cliente && (\n                      <div>\n                        <p className=\"text-sm font-medium\">Cliente</p>\n                        <p className=\"text-sm text-muted-foreground\">{veiculo.cliente}</p>\n                      </div>\n                    )}\n                    {veiculo.statusCarga && (\n                      <div>\n                        <p className=\"text-sm font-medium\">Status Carga</p>\n                        <p className=\"text-sm text-muted-foreground capitalize\">{veiculo.statusCarga}</p>\n                      </div>\n                    )}\n                    <div>\n                      <p className=\"text-sm font-medium\">Entrada</p>\n                      <p className=\"text-sm text-muted-foreground\">\n                        {format(new Date(veiculo.dataEntrada), \"dd/MM/yyyy HH:mm\", { locale: ptBR })}\n                      </p>\n                    </div>\n                    <Button\n                      className=\"w-full mt-3\"\n                      onClick={() => handleChamar(veiculo)}\n                      data-testid={`button-chamar-${veiculo.id}`}\n                    >\n                      <PhoneCall className=\"mr-2 h-4 w-4\" />\n                      Chamar Motorista\n                    </Button>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          ) : (\n            <div className=\"text-center py-12\">\n              <Truck className=\"h-12 w-12 text-muted-foreground mx-auto mb-4 opacity-50\" />\n              <p className=\"text-muted-foreground\">\n                {searchTerm ? \"Nenhum veículo encontrado\" : \"Nenhum veículo no pátio\"}\n              </p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n      </>\n      )}\n\n      {/* Call Dialog */}\n      <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n        <DialogContent data-testid=\"dialog-chamar-motorista\">\n          <DialogHeader>\n            <DialogTitle>Chamar Motorista</DialogTitle>\n            <DialogDescription>\n              Informe o motivo da chamada para o motorista\n            </DialogDescription>\n          </DialogHeader>\n          {selectedVeiculo && (\n            <div className=\"space-y-4\">\n              <div className=\"rounded-lg bg-muted p-4 space-y-2\">\n                <div className=\"flex items-center gap-2\">\n                  <Truck className=\"h-4 w-4 text-muted-foreground\" />\n                  <span className=\"font-medium\">\n                    {selectedVeiculo.placaCarreta\n                      ? `${selectedVeiculo.placaCavalo} + ${selectedVeiculo.placaCarreta}`\n                      : selectedVeiculo.placaCavalo}\n                  </span>\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Motorista: <span className=\"text-foreground\">{selectedVeiculo.motorista}</span>\n                  </p>\n                </div>\n                {selectedVeiculo.transportadora && (\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Transportadora:{\" \"}\n                      <span className=\"text-foreground\">{selectedVeiculo.transportadora}</span>\n                    </p>\n                  </div>\n                )}\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"motivo\">Motivo da Chamada *</Label>\n                <Textarea\n                  id=\"motivo\"\n                  data-testid=\"textarea-motivo\"\n                  placeholder=\"Ex: Carregar mercadoria na Doca 5\"\n                  value={motivo}\n                  onChange={(e) => setMotivo(e.target.value)}\n                  rows={4}\n                />\n              </div>\n            </div>\n          )}\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setDialogOpen(false);\n                setSelectedVeiculo(null);\n                setMotivo(\"\");\n              }}\n              data-testid=\"button-cancelar-chamada\"\n            >\n              Cancelar\n            </Button>\n            <Button\n              onClick={handleSubmit}\n              disabled={createChamadaMutation.isPending || !motivo.trim()}\n              data-testid=\"button-confirmar-chamada\"\n            >\n              {createChamadaMutation.isPending ? (\n                <>\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  Criando...\n                </>\n              ) : (\n                <>\n                  <PhoneCall className=\"mr-2 h-4 w-4\" />\n                  Criar Chamada\n                </>\n              )}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":11908},"client/src/pages/vagas-admin-page.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { ParkingSquare, Plus, Loader2, Edit, Trash2, Search } from \"lucide-react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Vaga, Filial } from \"@shared/schema\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Badge } from \"@/components/ui/badge\";\n\nexport default function VagasAdminPage() {\n  const { toast } = useToast();\n  const [showNewDialog, setShowNewDialog] = useState(false);\n  const [showEditDialog, setShowEditDialog] = useState(false);\n  const [showDeleteDialog, setShowDeleteDialog] = useState(false);\n  const [editingVaga, setEditingVaga] = useState<Vaga | null>(null);\n  const [deletingVaga, setDeletingVaga] = useState<Vaga | null>(null);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [selectedFilialFilter, setSelectedFilialFilter] = useState<string>(\"all\");\n\n  const [formData, setFormData] = useState({\n    filialId: \"\",\n    numero: \"\",\n    descricao: \"\",\n  });\n\n  const [editFormData, setEditFormData] = useState({\n    numero: \"\",\n    descricao: \"\",\n  });\n\n  const { data: vagas, isLoading } = useQuery<Vaga[]>({\n    queryKey: [\"/api/vagas/all\"],\n  });\n\n  const { data: filiais } = useQuery<Filial[]>({\n    queryKey: [\"/api/filiais\"],\n  });\n\n  const createVagaMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const res = await apiRequest(\"POST\", \"/api/vagas\", data, {\n        headers: {\n          \"X-Filial\": data.filialId,\n        },\n      });\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/vagas/all\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/vagas\"] });\n      toast({\n        title: \"Vaga criada\",\n        description: \"Nova vaga adicionada com sucesso\",\n      });\n      setFormData({\n        filialId: \"\",\n        numero: \"\",\n        descricao: \"\",\n      });\n      setShowNewDialog(false);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro ao criar vaga\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateVagaMutation = useMutation({\n    mutationFn: async ({ vagaId, filialId, ...data }: { vagaId: string; filialId: string; numero: string; descricao: string }) => {\n      const res = await apiRequest(\"PATCH\", `/api/vagas/${vagaId}`, data, {\n        headers: {\n          \"X-Filial\": filialId,\n        },\n      });\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/vagas/all\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/vagas\"] });\n      toast({\n        title: \"Vaga atualizada\",\n        description: \"Vaga atualizada com sucesso\",\n      });\n      setShowEditDialog(false);\n      setEditingVaga(null);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro ao atualizar vaga\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteVagaMutation = useMutation({\n    mutationFn: async ({ vagaId, filialId }: { vagaId: string; filialId: string }) => {\n      await apiRequest(\"DELETE\", `/api/vagas/${vagaId}`, undefined, {\n        headers: {\n          \"X-Filial\": filialId,\n        },\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/vagas/all\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/vagas\"] });\n      toast({\n        title: \"Vaga deletada\",\n        description: \"Vaga removida com sucesso\",\n      });\n      setShowDeleteDialog(false);\n      setDeletingVaga(null);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro ao deletar vaga\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    createVagaMutation.mutate(formData);\n  };\n\n  const handleEditSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (editingVaga) {\n      updateVagaMutation.mutate({\n        vagaId: editingVaga.id,\n        filialId: editingVaga.filialId,\n        numero: editFormData.numero,\n        descricao: editFormData.descricao,\n      });\n    }\n  };\n\n  const handleDeleteConfirm = () => {\n    if (deletingVaga) {\n      deleteVagaMutation.mutate({\n        vagaId: deletingVaga.id,\n        filialId: deletingVaga.filialId,\n      });\n    }\n  };\n\n  const openEditDialog = (vaga: Vaga) => {\n    setEditingVaga(vaga);\n    setEditFormData({\n      numero: vaga.numero,\n      descricao: vaga.descricao || \"\",\n    });\n    setShowEditDialog(true);\n  };\n\n  const openDeleteDialog = (vaga: Vaga) => {\n    setDeletingVaga(vaga);\n    setShowDeleteDialog(true);\n  };\n\n  const filteredVagas = vagas?.filter((vaga) => {\n    const matchesSearch = vaga.numero.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      (vaga.descricao?.toLowerCase().includes(searchTerm.toLowerCase()) ?? false);\n    const matchesFilial = selectedFilialFilter === \"all\" || vaga.filialId === selectedFilialFilter;\n    return matchesSearch && matchesFilial;\n  });\n\n  const getFilialNome = (filialId: string) => {\n    return filiais?.find((f) => f.id === filialId)?.nome || \"Desconhecida\";\n  };\n\n  const vagasPorFilial = filiais?.map((filial) => ({\n    filial,\n    count: vagas?.filter((v) => v.filialId === filial.id).length || 0,\n    livres: vagas?.filter((v) => v.filialId === filial.id && v.status === \"livre\").length || 0,\n    ocupadas: vagas?.filter((v) => v.filialId === filial.id && v.status === \"ocupada\").length || 0,\n  }));\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">Gestão de Vagas</h1>\n          <p className=\"text-muted-foreground\">Gerencie as vagas de estacionamento de todas as filiais</p>\n        </div>\n        <Button\n          onClick={() => setShowNewDialog(true)}\n          data-testid=\"button-nova-vaga\"\n        >\n          <Plus className=\"mr-2 h-4 w-4\" />\n          Nova Vaga\n        </Button>\n      </div>\n\n      {/* Stats Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Total de Vagas</CardDescription>\n            <CardTitle className=\"text-3xl\">{vagas?.length || 0}</CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Vagas Livres</CardDescription>\n            <CardTitle className=\"text-3xl text-green-600\">\n              {vagas?.filter((v) => v.status === \"livre\").length || 0}\n            </CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Vagas Ocupadas</CardDescription>\n            <CardTitle className=\"text-3xl text-primary\">\n              {vagas?.filter((v) => v.status === \"ocupada\").length || 0}\n            </CardTitle>\n          </CardHeader>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardDescription>Filiais com Vagas</CardDescription>\n            <CardTitle className=\"text-3xl\">\n              {new Set(vagas?.map((v) => v.filialId)).size || 0}\n            </CardTitle>\n          </CardHeader>\n        </Card>\n      </div>\n\n      {/* Vagas por Filial */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Vagas por Filial</CardTitle>\n          <CardDescription>Distribuição de vagas por filial</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-4\">\n            {vagasPorFilial?.map(({ filial, count, livres, ocupadas }) => (\n              <div key={filial.id} className=\"flex items-center justify-between p-4 border rounded-lg\">\n                <div className=\"flex-1\">\n                  <div className=\"flex items-center gap-2\">\n                    <h3 className=\"font-semibold\">{filial.nome}</h3>\n                    <Badge variant={filial.ativo ? \"default\" : \"secondary\"}>\n                      {filial.ativo ? \"Ativa\" : \"Inativa\"}\n                    </Badge>\n                  </div>\n                  <p className=\"text-sm text-muted-foreground\">{filial.codigo}</p>\n                </div>\n                <div className=\"flex items-center gap-4\">\n                  <div className=\"text-right\">\n                    <p className=\"text-sm text-muted-foreground\">Total</p>\n                    <p className=\"text-2xl font-bold\">{count}</p>\n                  </div>\n                  <div className=\"text-right\">\n                    <p className=\"text-sm text-muted-foreground\">Livres</p>\n                    <p className=\"text-2xl font-bold text-green-600\">{livres}</p>\n                  </div>\n                  <div className=\"text-right\">\n                    <p className=\"text-sm text-muted-foreground\">Ocupadas</p>\n                    <p className=\"text-2xl font-bold text-primary\">{ocupadas}</p>\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Filters */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Filtros</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"search\">Buscar</Label>\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-3 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  id=\"search\"\n                  placeholder=\"Número ou descrição da vaga...\"\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  className=\"pl-9\"\n                  data-testid=\"input-search-vaga\"\n                />\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"filial-filter\">Filial</Label>\n              <Select value={selectedFilialFilter} onValueChange={setSelectedFilialFilter}>\n                <SelectTrigger id=\"filial-filter\" data-testid=\"select-filial-filter\">\n                  <SelectValue placeholder=\"Todas as filiais\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">Todas as filiais</SelectItem>\n                  {filiais?.map((filial) => (\n                    <SelectItem key={filial.id} value={filial.id}>\n                      {filial.nome}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Vagas Table */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Todas as Vagas</CardTitle>\n          <CardDescription>\n            {filteredVagas?.length || 0} vaga(s) encontrada(s)\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"flex items-center justify-center py-12\">\n              <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n            </div>\n          ) : filteredVagas && filteredVagas.length > 0 ? (\n            <div className=\"space-y-2\">\n              {filteredVagas.map((vaga) => (\n                <div\n                  key={vaga.id}\n                  className=\"flex items-center justify-between p-4 border rounded-lg hover-elevate\"\n                  data-testid={`vaga-item-${vaga.id}`}\n                >\n                  <div className=\"flex items-center gap-4 flex-1\">\n                    <div className=\"p-2 bg-primary/10 rounded-lg\">\n                      <ParkingSquare className=\"h-6 w-6 text-primary\" />\n                    </div>\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-2\">\n                        <h3 className=\"font-semibold\">Vaga {vaga.numero}</h3>\n                        <Badge variant={vaga.status === \"livre\" ? \"default\" : \"secondary\"}>\n                          {vaga.status === \"livre\" ? \"Livre\" : \"Ocupada\"}\n                        </Badge>\n                      </div>\n                      <p className=\"text-sm text-muted-foreground\">\n                        {getFilialNome(vaga.filialId)}\n                      </p>\n                      {vaga.descricao && (\n                        <p className=\"text-sm text-muted-foreground mt-1\">{vaga.descricao}</p>\n                      )}\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"icon\"\n                      onClick={() => openEditDialog(vaga)}\n                      data-testid={`button-edit-vaga-${vaga.id}`}\n                    >\n                      <Edit className=\"h-4 w-4\" />\n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      size=\"icon\"\n                      onClick={() => openDeleteDialog(vaga)}\n                      disabled={vaga.status === \"ocupada\"}\n                      data-testid={`button-delete-vaga-${vaga.id}`}\n                    >\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <div className=\"text-center py-12\">\n              <ParkingSquare className=\"h-12 w-12 text-muted-foreground mx-auto mb-4 opacity-50\" />\n              <p className=\"text-muted-foreground\">Nenhuma vaga encontrada</p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* New Vaga Dialog */}\n      <Dialog open={showNewDialog} onOpenChange={setShowNewDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Nova Vaga</DialogTitle>\n            <DialogDescription>\n              Adicione uma nova vaga de estacionamento\n            </DialogDescription>\n          </DialogHeader>\n          <form onSubmit={handleSubmit}>\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"filial\">Filial *</Label>\n                <Select\n                  value={formData.filialId}\n                  onValueChange={(value) => setFormData({ ...formData, filialId: value })}\n                >\n                  <SelectTrigger id=\"filial\" data-testid=\"select-filial\">\n                    <SelectValue placeholder=\"Selecione a filial\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {filiais?.filter(f => f.ativo).map((filial) => (\n                      <SelectItem key={filial.id} value={filial.id}>\n                        {filial.nome}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"numero\">Número da Vaga *</Label>\n                <Input\n                  id=\"numero\"\n                  value={formData.numero}\n                  onChange={(e) => setFormData({ ...formData, numero: e.target.value })}\n                  placeholder=\"Ex: A-01, B-15, 101\"\n                  required\n                  data-testid=\"input-numero\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"descricao\">Descrição (Opcional)</Label>\n                <Textarea\n                  id=\"descricao\"\n                  value={formData.descricao}\n                  onChange={(e) => setFormData({ ...formData, descricao: e.target.value })}\n                  placeholder=\"Ex: Próximo ao portão principal, Vaga coberta\"\n                  data-testid=\"input-descricao\"\n                />\n              </div>\n            </div>\n            <DialogFooter className=\"mt-6\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => setShowNewDialog(false)}\n                data-testid=\"button-cancelar-nova\"\n              >\n                Cancelar\n              </Button>\n              <Button\n                type=\"submit\"\n                disabled={createVagaMutation.isPending || !formData.filialId || !formData.numero}\n                data-testid=\"button-criar-vaga\"\n              >\n                {createVagaMutation.isPending ? (\n                  <>\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                    Criando...\n                  </>\n                ) : (\n                  \"Criar Vaga\"\n                )}\n              </Button>\n            </DialogFooter>\n          </form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Edit Vaga Dialog */}\n      <Dialog open={showEditDialog} onOpenChange={setShowEditDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Editar Vaga</DialogTitle>\n            <DialogDescription>\n              Atualize as informações da vaga\n            </DialogDescription>\n          </DialogHeader>\n          {editingVaga && (\n            <form onSubmit={handleEditSubmit}>\n              <div className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label>Filial</Label>\n                  <Input\n                    value={getFilialNome(editingVaga.filialId)}\n                    disabled\n                    className=\"bg-muted\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"edit-numero\">Número da Vaga *</Label>\n                  <Input\n                    id=\"edit-numero\"\n                    value={editFormData.numero}\n                    onChange={(e) => setEditFormData({ ...editFormData, numero: e.target.value })}\n                    placeholder=\"Ex: A-01, B-15, 101\"\n                    required\n                    data-testid=\"input-edit-numero\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"edit-descricao\">Descrição</Label>\n                  <Textarea\n                    id=\"edit-descricao\"\n                    value={editFormData.descricao}\n                    onChange={(e) => setEditFormData({ ...editFormData, descricao: e.target.value })}\n                    placeholder=\"Ex: Próximo ao portão principal, Vaga coberta\"\n                    data-testid=\"input-edit-descricao\"\n                  />\n                </div>\n              </div>\n              <DialogFooter className=\"mt-6\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setShowEditDialog(false)}\n                  data-testid=\"button-cancelar-edit\"\n                >\n                  Cancelar\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={updateVagaMutation.isPending || !editFormData.numero}\n                  data-testid=\"button-salvar-vaga\"\n                >\n                  {updateVagaMutation.isPending ? (\n                    <>\n                      <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                      Salvando...\n                    </>\n                  ) : (\n                    \"Salvar Alterações\"\n                  )}\n                </Button>\n              </DialogFooter>\n            </form>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/* Delete Confirmation Dialog */}\n      <AlertDialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Confirmar Exclusão</AlertDialogTitle>\n            <AlertDialogDescription>\n              Tem certeza que deseja deletar a vaga <strong>{deletingVaga?.numero}</strong>?\n              Esta ação não pode ser desfeita.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel data-testid=\"button-cancelar-delete\">\n              Cancelar\n            </AlertDialogCancel>\n            <AlertDialogAction\n              onClick={handleDeleteConfirm}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n              data-testid=\"button-confirmar-delete\"\n            >\n              {deleteVagaMutation.isPending ? (\n                <>\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  Deletando...\n                </>\n              ) : (\n                \"Deletar\"\n              )}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","size_bytes":21690}},"version":2}